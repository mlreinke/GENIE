<!-- This file was generated by mk_html_help.pro -->
<html>
 
<head>
<TITLE>GENIE - IMPSPEC</TITLE>
</head>
 
<body>
<H1>GENIE - IMPSPEC</H1>
<P>
This page was created by the IDL library routine 
<CODE>mk_html_help</CODE>.  For more information on 
this routine, refer to the IDL Online Help Navigator 
or type: <P>
<PRE>     ? mk_html_help</PRE><P>
at the IDL command line prompt.<P>
<STRONG>Last modified: </STRONG>Fri Jun  8 16:28:44 2012.<P>
 
<HR>
 
<A NAME="ROUTINELIST">
<H1>List of Routines</H1></A>
<UL>
<LI><A HREF="#ADD_IMPSPEC">ADD_IMPSPEC</A>
<LI><A HREF="#CHROMEX_LOAD_SPEC">CHROMEX_LOAD_SPEC</A>
<LI><A HREF="#GAUSSIAN_FITS">GAUSSIAN_FITS</A>
<LI><A HREF="#IMPSPEC">IMPSPEC</A>
<LI><A HREF="#ISPEC2STRING">ISPEC2STRING</A>
<LI><A HREF="#ISPEC_FIT_LINE">ISPEC_FIT_LINE</A>
<LI><A HREF="#IS_SPEC">IS_SPEC</A>
<LI><A HREF="#READ_ISPEC_FILE">READ_ISPEC_FILE</A>
<LI><A HREF="#READ_ISPEC_PATH">READ_ISPEC_PATH</A>
<LI><A HREF="#READ_ISPEC_TREE">READ_ISPEC_TREE</A>
<LI><A HREF="#RUN_IMPSPEC">RUN_IMPSPEC</A>
<LI><A HREF="#VUV_LOAD_SPEC">VUV_LOAD_SPEC</A>
<LI><A HREF="#WRITE_ISPEC2NODE">WRITE_ISPEC2NODE</A>
<LI><A HREF="#WRITE_ISPEC2TREE">WRITE_ISPEC2TREE</A>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<A NAME="ADD_IMPSPEC">
<H2>ADD_IMPSPEC</H2></A>
<A HREF="#CHROMEX_LOAD_SPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	ADD_IMPSPEC

PURPOSE:
	This procedure adds the nodes to a given shot that allow
	IMPSPEC to be run

CALLING SEQUENCE:
	ADD_IMPSPEC,shot

INPUTS:
	shot	LONG	shot number
	
OPTIONAL INPUTS:
	z	INTARR	of the the atomic numbers to add

KEYWORD PARAMETERS:
	force	/force will delete a given element subnode before writing
	rm	/rm will delete the \SPECTROSCOPY::TOP.IMPSPEC node 

PROCEDURE:
	The default behavior is to simply add the 
	\SPECTROSCOPY::TOP.IMPSPEC node if it is not already there for a
	given shot.  If the z optional input is specified then both
	WRITE_ISPEC2NODE and WRITE_ISPEC2TREE are run for that shot

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="CHROMEX_LOAD_SPEC">
<H2>CHROMEX_LOAD_SPEC</H2></A>
<A HREF="#ADD_IMPSPEC">[Previous Routine]</A>
<A HREF="#GAUSSIAN_FITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CHROMEX_LOAD_SPEC

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="GAUSSIAN_FITS">
<H2>GAUSSIAN_FITS</H2></A>
<A HREF="#CHROMEX_LOAD_SPEC">[Previous Routine]</A>
<A HREF="#IMPSPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GAUSSIAN_FITS

PURPOSE:
	This function calculates the gaussian line profile for the sum of 
	an arbitrary number of gaussians plus an optional DC offset.  The format
	is made to be used with MPFIT

CALLING_SEQUENCE:
	result=GAUSSIAN_FITS(x,p)

INPUTS:
	x	FLTARR	[n_x] of the points for which to calculate the spectra
	p	FLTARR 	[n_gauss*3+nb] where nb will determine the order of the baseline fit

OUTPUTS:
	result:	FLTARR  [n_x] of the sum of all the gaussians at each point

PROCEDURE:
	Gaussians are specified as a*exp(-(x-b)^2/(2*c^2)).  If the parameter values of p
	are a double precision array, then the result is returned as a double.
	
	IF n_elements(p) MOD 3 = 0 then the last three are assume to be a quadraditc baseline
	IF n_elements(p) MOD 3 = 1 then the last three are assume to be a constant baseline
	IF n_elements(p) MOD 3 = 2 then the last three are assume to be a linear baseline

MOFICATION HISTORY:
	Written by: 	copied from hirexsr_fit_spectra.pro in THACO
	3/12		modified the baseline reference to use the
			first element of the x scaling vector

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="IMPSPEC">
<H2>IMPSPEC</H2></A>
<A HREF="#GAUSSIAN_FITS">[Previous Routine]</A>
<A HREF="#ISPEC2STRING">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	IMPSPEC

PURPOSE:
	This is a high level procedure which takes in a shot number
	and an ISPEC file and computes fit and calculates line brightness

CALLING SEQUENCE:
	IMPSPEC,shot,ispec,br,coefs

INPUTS:
	shot		LONG	shot number
	ispec		STRUC	formatted as per READ_ISPEC_FILE
	
OPTIONAL INPUTS:
	kline		INT	select one line from ISPEC to run (use -1 to select 0th line)
	fitz		INTARR	of the Z's to include in fit (sent to IMPSPEC_FIT_LINE)

KEYWORD PARAMETERS:
	plot	/plot sent to IMPSOEC_FIT_LINE to plot results of fit
	verb	/verb not used yet
	debug	/debug stops the code at the end of each line fitting

OUTPUTS:
	br	STRUC	containing the line brightness
		*.LINE#		FLTARR	[ntime,3] of the brightnes [*,0],
					time [*,1] and uncertainty [*,2] 
		*.ELEM		STRING	elemental symbol
		*.Z		INT	atomic number
		*.NLINES	INT	number of lines specified in the file		
	coefs	STRUC	containing the fit coefficients
		*.LINE#		FLTARR	[line.iline*3+2,3] of the
					spectral fit coefficients
		*.ELEM		STRING	elemental symbol
		*.Z		INT	atomic number
		*.NLINES	INT	number of lines specified in the file

OPTIONAL OUTPUTS:
	xeus	STRUC	containing the xeus data, used for repeated calls
	loweus	STRUC	containing the loweus data, used for repeated calls
	
PROCEDURE:
	

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="ISPEC2STRING">
<H2>ISPEC2STRING</H2></A>
<A HREF="#IMPSPEC">[Previous Routine]</A>
<A HREF="#ISPEC_FIT_LINE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	ISPEC2STRING

PURPOSE:
	This function converts the ISPEC ASCII file into a single
	string for storage into the tree.

CALLING SEQUENCE:
	result=ISPEC2STRING(path)

INPUTS:
	path	STRING	of the path to the ISPEC file

OPTIONAL INPUTS:
	z	INT	of the atomic number of interest (calls READ_ISPEC_PATH)

OUTPUTS:
	result	STRING	of the ISPEC files with string(10B) inserted
			for carriage returns.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="ISPEC_FIT_LINE">
<H2>ISPEC_FIT_LINE</H2></A>
<A HREF="#ISPEC2STRING">[Previous Routine]</A>
<A HREF="#IS_SPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	ISPEC_FIT_LINE

PURPOSE:
	This function is a lower level code that actually does the
	fitting of a spectrum based on the LINE information from the ISPEC file

CALLING SEQUENCE:
	result=IMPSPEC_FIT_LINE(spec,lam,sig,line)

INPUTS:
	spec	FLTARR	[nlam] of the spectral brightness vs. wavelength
	lam	FLTARR	[nlam] of the wavelength values
	sig	FLTARR	[nlam] of the photon statistic uncertainties in spec
	line	STRUC	substructure of the ISPEC file (see READ_ISPEC_FILE)
			(*.ilines specifies the # of lines in the fit)

OPTIONAL INPUTS:
	fitz	INTARR	[nz] of the atomic numbers to include in fit DEFAULT: all listed

KEYWORD PARAMETERS:
	plot	/plot will display a graphical output of the data, seed and fit

OUTPUTS:
	result	FLTARR	[ilines*3+2) of the fit coefficients along
			linear background

OPTIONAL OUTPUTS:
	error	FLTARR	[ilines*3+2] of the uncertainty in fit coefficients

PROCEDURE:
	The line.dlam array defines the subset of spectrum that is
	used in the fit.  Non-linear least-squares fitting is done using
	MPFIT using the following constraints.
		line intensitity and DC offset > 0
		line width > 0 and < line.inst
		all line widths are the same
		all lines are tied to the main peak, shifting together
		constrains shift to < 0.5 angstroms
		
	Those impurities which are not specified with the
	fitz optional input have their peaks fixed at 0.0, thus removing them
	from the fit.
	
MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="IS_SPEC">
<H2>IS_SPEC</H2></A>
<A HREF="#ISPEC_FIT_LINE">[Previous Routine]</A>
<A HREF="#READ_ISPEC_FILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	IS_SPEC

PURPOSE:
	This function is used to check if a given shot has been setup
	for a given Z for use with IMPSPEC.

CALLING SEQUENCE:
	result=IS_SPEC(shot,z)
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="READ_ISPEC_FILE">
<H2>READ_ISPEC_FILE</H2></A>
<A HREF="#IS_SPEC">[Previous Routine]</A>
<A HREF="#READ_ISPEC_PATH">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_ISPEC_FILE

PURPOSE:
	This function reads an ASCII file in the "ISPEC" format that
	can be used in the IMPSPEC line-fitting code.

CALLING SEQUENCE:
	result=READ_ISPEC_FILE(path)

INPUTS:
	path	STRING	of the path to the ISPEC file

OPTIONAL INPUTS:
	z	INT	of the atomic number of interest (calls READ_ISPEC_PATH)

OUTPUTS:
	result	STRUC	"ISPEC" file formatted for use in other IMPSPEC codse
		*.LINE#		STRUC	information describing how to fit LINE number "#"
			*.DLAM		FLTARR	[lam0,lam1] to truncate wavelength range
			*.SPEC		STRING	spectrometer identifier ('xeus','loweus','chromex')
			*.INST		FLOAT	maximum line width for (< 0 specifies a lorentzian, > 0 gaussian)
			*.ILINES	INT	number of spectral lines in the group (index=0 is line of interest)
			*.LAM		FLTARR	[ilines] center wavelengths
			*.Z		INTARR	[ilines] atomic number
			*.LABEL		STRARR	[ilines] line label in spectroscopy notation
			*.ISO		STRARR	[ilines] isoelectronic element symbol
		*.ELEM		STRING	elemental symbol
		*.Z		INT	atomic number
		*.NLINES	INT	number of lines specified in the file

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="READ_ISPEC_PATH">
<H2>READ_ISPEC_PATH</H2></A>
<A HREF="#READ_ISPEC_FILE">[Previous Routine]</A>
<A HREF="#READ_ISPEC_TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_ISPEC_PATH

PURPOSE:
	This function returns the path to the ISPEC file for 
	a given impurity, Z.

CALLING SEQUENCE:
	result=READ_ISPEC_PATH(z)
	
INPUTS:
	z	INT	atomic number of impurity 

OUTPUTS:
	result	STRING	path

PROCEDURE:
	Currently, all ISPEC files are kept in /home/mlreinke/idl/vuv/
	during the initial testing and development of IMPSPEC

	If the Z is not on file, then path='none' will be returned

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/2012
	6/8/12		M.L. Reinke - modified the ispec paths to usr /usr/local/cmod/idl/GENIE/IMPSPEC/ispec/

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="READ_ISPEC_TREE">
<H2>READ_ISPEC_TREE</H2></A>
<A HREF="#READ_ISPEC_PATH">[Previous Routine]</A>
<A HREF="#RUN_IMPSPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_ISPEC_TREE

PURPOSE:
	This function reads data stored in the tree to create
	the ISPEC structure

CALLING SEQUECNE:
	result=READ_ISPEC_TREE(shot,z)

INPUTS:
	shot	LONG	shot number
	z	INT	atomic number of element

OUTPUTS:
	result	STRUC	ISPEC structure as described in READ_ISPEC_FILE
			A value of -1 is returned for an error
PROCEDURE:
	This loads the string stored in the tree and creates a ASCII
	file so that READ_ISPEC_FILE can be used.  [/tmp/tmp.ispec]

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/12
	N.L. Reinke 	5/22/12 - added a Z suffix to the tmp.ispec file so parallel z's can be run
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="RUN_IMPSPEC">
<H2>RUN_IMPSPEC</H2></A>
<A HREF="#READ_ISPEC_TREE">[Previous Routine]</A>
<A HREF="#VUV_LOAD_SPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	RUN_IMPSPEC
	
PURPOSE:
	This procedure runs IMPSPEC and stores the data in the tree

CALLING SEQUENCE:
	RUN_IMPSPEC,shot,z

INPUTS:
	shot	LONG 	shot number
	z	INT	atomic number of impurity to look at

OPTIONAL INPUTS:
	fitz	INTARR	of the other impurities to include in the fit (sent to IMPSPEC)

OUTPUTS:
	all data output is stored into the \SPECTROSCOPY::TOP.IMPSPEC tree

PROCEDURE:
	The ISPEC file is loaded from the tree using READ_ISPEC_TREE

MODIFICAION HISTORY:
	Written by:	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="VUV_LOAD_SPEC">
<H2>VUV_LOAD_SPEC</H2></A>
<A HREF="#RUN_IMPSPEC">[Previous Routine]</A>
<A HREF="#WRITE_ISPEC2NODE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	VUV_LOAD_SPEC

PURPOSE:
	This procedure loads the XEUS and LoWEUS data from the tree
	for a given shot

CALLING SEQUENCE:
	VUV_LOAD_SPEC,shot,specbr,lam,time (/xeus or /loweus required)

INPUTS:
	shot	LONG 	shot number

KEYWORD PARAMETERS:
	/xeus or /loweus required to specifiy which dataset to load

OUTPUTS:
	specbr	FLTARR	[nlam,ntime] of the spectral brightnes [ph/s/m^2/Ang] 
	lam	FLTARR	[nlam] of the wavelengths [Angstroms]	
	time	FLTARR	[ntime] of the time points [seconds]

OPTIONAL OUTPUTS:
	sigbr	FLTARR	[nlam,ntime] of the photon statistics error in specbr

MODIFICATION HISTORY:
	Written by:	M.L. Reinke (taken from VUV_TREE_ANALYSIS.PRO)

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="WRITE_ISPEC2NODE">
<H2>WRITE_ISPEC2NODE</H2></A>
<A HREF="#VUV_LOAD_SPEC">[Previous Routine]</A>
<A HREF="#WRITE_ISPEC2TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	WRITE_ISPEC2NODE

PURPOSE:
	This procedure takes an ISPEC file and creates a subnode under
	\SPECTROSCOPY::TOP.IMPSPEC for that element, allowing
	RUN_IMPSPEC to be used on that shot.

CALLING SEQUENCE:
	WRITE_ISPEC2NODE
	
INPUTS:
	shot	LONG	shot number
	path	STRING	of the path to the ISPEC file (sent to READ_ISPEC_FILE)
		LONG	of the shot number copy from (sent to READ_ISPEC_TREE)

OPTIONAL INPUTS:
	z	INT	of the atomic number of interest (sent READ_ISPEC_PATH)		

OUTPUTS:
	Nodes are added to the tree based on the data in the ISPEC
	file.  A subnode \SPECTROSCOPY::TOP.IMPSPEC.LINE# is added for each
	line specified where the brightness, coefficients and information for
	the IMPSPEC scope are located.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
<A NAME="WRITE_ISPEC2TREE">
<H2>WRITE_ISPEC2TREE</H2></A>
<A HREF="#WRITE_ISPEC2NODE">[Previous Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	WRITE_ISPEC2TREE

PURPOSE:
	This procedure writes and ISPEC file for a specified atomic number
	to the tree for given shot.

CALLING SEQUENCE:
	WRITE_ISPEC2TREE,shot,path

INPUTS:
	shot	LONG	shot number
	path	STRING	of the path to the ISPEC file (sent to READ_ISPEC_FILE)
		LONG	of the shot number copy from (sent to READ_ISPEC_TREE)

OPTIONAL INPUTS:
	z	INT	of the atomic number of interest (sent READ_ISPEC_PATH)		

MODIFICATION HISTORY:
	Written by	M.L. Reinke - 3/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE//IMPSPEC/impspec.pro)</STRONG><P>
<HR>
 
</body>
</html>
