<!-- This file was generated by mk_html_help.pro -->
<html>
 
<head>
<TITLE>GENIE - GENTRAN</TITLE>
</head>
 
<body>
<H1>GENIE - GENTRAN</H1>
<P>
This page was created by the IDL library routine 
<CODE>mk_html_help</CODE>.  For more information on 
this routine, refer to the IDL Online Help Navigator 
or type: <P>
<PRE>     ? mk_html_help</PRE><P>
at the IDL command line prompt.<P>
<STRONG>Last modified: </STRONG>Tue Nov 11 11:01:50 2014.<P>
 
<HR>
 
<A NAME="ROUTINELIST">
<H1>List of Routines</H1></A>
<UL>
<LI><A HREF="#CALC_CSDEN_ERROR">CALC_CSDEN_ERROR</A>
<LI><A HREF="#CALC_FRACABUND">CALC_FRACABUND</A>
<LI><A HREF="#CALC_NEUTSTR">CALC_NEUTSTR</A>
<LI><A HREF="#CALC_VOLTERM_PROFILE">CALC_VOLTERM_PROFILE</A>
<LI><A HREF="#FORM_SOURCE_VECTOR">FORM_SOURCE_VECTOR</A>
<LI><A HREF="#FORM_TRANSPORT_MATRIX">FORM_TRANSPORT_MATRIX</A>
<LI><A HREF="#FQ">FQ</A>
<LI><A HREF="#FQPLT">FQPLT</A>
<LI><A HREF="#GENTRAN">GENTRAN</A>
<LI><A HREF="#GENTRAN_DIFFCONV_PROFILES">GENTRAN_DIFFCONV_PROFILES</A>
<LI><A HREF="#GENTRAN_FQ">GENTRAN_FQ</A>
<LI><A HREF="#GENTRAN_NEUT_TRANSP">GENTRAN_NEUT_TRANSP</A>
<LI><A HREF="#GENTRAN_PLOT">GENTRAN_PLOT</A>
<LI><A HREF="#GENTRAN_PROFILES">GENTRAN_PROFILES</A>
<LI><A HREF="#GENTRAN_TENE_QUICKFITS">GENTRAN_TENE_QUICKFITS</A>
<LI><A HREF="#GENTRAN_TENE_WIDGETFITS">GENTRAN_TENE_WIDGETFITS</A>
<LI><A HREF="#MAKE_CMOD_GRID">MAKE_CMOD_GRID</A>
<LI><A HREF="#MAKE_CMOD_PARAM">MAKE_CMOD_PARAM</A>
<LI><A HREF="#MAKE_CMOD_PP">MAKE_CMOD_PP</A>
<LI><A HREF="#READ_FQ_DATA">READ_FQ_DATA</A>
<LI><A HREF="#READ_ION_DATA">READ_ION_DATA</A>
<LI><A HREF="#READ_REC_DATA">READ_REC_DATA</A>
<LI><A HREF="#RUN_CMOD_STRAHL">RUN_CMOD_STRAHL</A>
<LI><A HREF="#WRITE_IONREC_COEFS_TABLE">WRITE_IONREC_COEFS_TABLE</A>
<LI><A HREF="#WRITE_TRANSPORT_COEFS_TABLE">WRITE_TRANSPORT_COEFS_TABLE</A>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<A NAME="CALC_CSDEN_ERROR">
<H2>CALC_CSDEN_ERROR</H2></A>
<A HREF="#CALC_FRACABUND">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CALC_CSDEN_ERROR

PURPOSE:
	This function calculates the uncertainty in the charge state density profile
	due to uncertainties in electron temperature and electron and neutral density.

CALLING SEQUENCE:
	result=CALC_CSDEN_ERROR(csden)

INPUTS:
	csden	FLTARR	[z,nrho] of the charge state density profiles 

OPTIONAL INPUTS:
	trans_path	STRING	path to save file where the transport coefficients are stored DEFAULT: '/tmp/transport_coefs.dat'
	ionrec_path	STRING	path to save file where the ion/rec coefficients are stored DEFAULT: '/tmp/ionrec_coefs.dat'

KEYWORD PARAMETERS:
	double		/double inverts the error matrix using double precession (sent to LA_INVERT)
	debu		/debug stops the code before the RETURN statement

OUTPUTS:
	result	FLTARR	[z,nrho] of the uncertainty in the csden values

PROCEDURE:
	See M.L. Reinke APiP 2009 talk/paper

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009
	6/7/12		M.L. Reinke - modified paths to usr /tmp/

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="CALC_FRACABUND">
<H2>CALC_FRACABUND</H2></A>
<A HREF="#CALC_CSDEN_ERROR">[Previous Routine]</A>
<A HREF="#CALC_NEUTSTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CALC_FRACABUND

PURPOSE:
	This function calculates the temperature dependent fractional abundance of impurities 
	given an ionization and recombination rate structure

CALLING SEQUECTION:
	result=CALC_FRACABUND(ion,rec)
	
INPUTS:
	ion:	STRUC	ionization rate structure (see READ_ION_DATA for format)
	rec:	STRUC	recombination rate structure (see READ_REC_DATA for format)

OPTIONAL INPUTS:
	te:	FLTARR	[nt] of the temperature values at which to calculate the data [eV] DEFAULT: rec.temp
	nel	FLT	of the electron density to use for the rates if density dependent [m^-3] DEFAULT: 1.0e20

OUTPUTS:
	result:	STRUC	containing the fractional abundance data
		*.fq	FLTARR	[z+1,nt] of the fractional abundances [i,*] for ionization stage i
		*.temp	FLTARR	[nt] of the electron temperatures [eV]
		*.dens	FLTARR 	[1] of the electron density [m^-3]
		*.z	INT	it's just the z folks
		*.rec	STR	path from rec.path
		*.ion	STR	path from ion.path

MODIFICATION HISTORY:
	Written by:	ML Reinke - 2/09

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="CALC_NEUTSTR">
<H2>CALC_NEUTSTR</H2></A>
<A HREF="#CALC_FRACABUND">[Previous Routine]</A>
<A HREF="#CALC_VOLTERM_PROFILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CALC_NEUTSTR

PURPOSE:
	This function computs the neutral density structure using experimental
	hydrogenic emission data and recombination equilibrium.

CALLING SEQUENCE:
	result=CALC_NEUTSTR(shot,t1,t2,temp,dens)

INPUTS:
	shot	LONG 	shot number
	t	FLTARR	start of time bins [sec]
	dt	FLTARR	duration of time bins [sec]
	temp	STRUC	structure with electron temperature data (see GENTRAN)
	dens	STRUC	structure with electron density data (see GENTRAN)

OPTIONAL INPUTS:
	eno	FLTARR	[nrho] of the uncertainty in the neutral density.  If eno is FLOAT it is assume
			to be the fractional error.	

KEYWORD PARAMETERS:
	debug	/debug stops the code before the RETURN statement

OUTPUTS:
	result	STRUC	structure of the neutral density data
		*.dens	[nrho]	of the neutral density [m^-3]
		*.rho	[nrho]	of the r/a values
		*.err	[nrho]	of the absolute error [m^-3]
		*.bal
		*.balrho
		*.ly
		*.lyrho

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009
	6/6/12		M.L. Reinke - modified path to hydrogen ion/rec data to use /usr/local/cmod/idl/atomic_physics/
       7/5/12		M.L. Reinke - modified to use t and dt instead of t1, t2 in order to get multiple time slices

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="CALC_VOLTERM_PROFILE">
<H2>CALC_VOLTERM_PROFILE</H2></A>
<A HREF="#CALC_NEUTSTR">[Previous Routine]</A>
<A HREF="#FORM_SOURCE_VECTOR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CALC_VOLTERM_PROFILE

PURPOSE:
	This function computes the volume weighting term from EFIT reconstruction

CALLING SEQUENCE:
	result=CALC_VOLTERM_PROFILE(shot,rhovec)

INPUTS:
	shot	LONG	shot number
	rhovec	FLTARR	[nrho,ntau] of the radial grid points to compute volume weighting [r/a]

OPTIONAL INPUTS:
	tr	FLTARR	[t1,t2] to truncate the time range of the calculation DEFAULT: EFIT time base
	tree	STRING	identifies EFIT tree to use DEFAULT: 'ANALYSIS'

KEYWORD PARAMETERS"
	circular	/circular will assume circular flux surfaces, returning result=1/rhovec

OUTPUTS:
	result	FLTARR [nrho,ntau] of the "volume weighting term" (see PROCEDURE)	

OPTIONAL OUTPUTS:
	etree	STRING	will be filled with 'ANALYSIS' if left unspecified

PROCEDURE:
	Changes in radial particle flux occur due to changes in the area as function of minor radius.
	In the continuity equation (dV/drho)^-1*d/drho(dV/drho*FLUX) term reduces to dFLUX/drho+(d2V/drho2)/(dV/drho)*FLUX
	The "volume weighting term calculated here is (d2V/drho2)/(dV/drho), which for a cylinder is simply 1/rho.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - spring 2009
	6/6/12		M.L. Reinke - added the ability to specify the EFIT tree

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="FORM_SOURCE_VECTOR">
<H2>FORM_SOURCE_VECTOR</H2></A>
<A HREF="#CALC_VOLTERM_PROFILE">[Previous Routine]</A>
<A HREF="#FORM_TRANSPORT_MATRIX">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	FORM_SOURCE_VECTOR

PURPOSE:
	This function computes the radial profile of the impurity source

CALLING SEQUENCE:
	result=FORM_SOURCE_VECTOR()

OPTIONAL INPUTS:
	ionrec_path	STRING	path to save file where the ion/rec coefficients are stored DEFAULT: '/tmp/ionrec_coefs.dat'
	t_neut		FLOAT	temperature of the neutral species [eV] DEFAULT=1.0
	ptsource	FLOAT	of the r/a value to place a point source

KEYWORD PARAMETERS:
	double		/double forms the source vector as a double preceision array (DEFAULT: single)
	debug		/debug stops the code before the RETURN statement

OPTIONAL OUTPUTS:
	no		FLTARR	[nrho] of the impurity neutral density profile normalized to its peak.

PROCEDURE:
	If the ptsource optional input is not used, then the radial impurity neutral density profile is computed by 
	launching neutrals from the edge boundary at the thermal velocity of t_neut.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009	
	6/7/12		M.L. Reinke - modified path to use /tmp/ionrec_coefs.dat 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="FORM_TRANSPORT_MATRIX">
<H2>FORM_TRANSPORT_MATRIX</H2></A>
<A HREF="#FORM_SOURCE_VECTOR">[Previous Routine]</A>
<A HREF="#FQ">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	FORM_TRANSPORT_MATRIX

PURPOSE:
	This function computes the transport matrix from the interpolated ion/rec rates and the
	defined transport (diff/conv) profiles.

CALLING SEQUENCE:
	result=FORM_TRANSPORT_MATRIX()

OPTIONAL INPUTS:
	trans_path	STRING	path to save file where the transport coefficients are stored DEFAULT: '/tmp/transport_coefs.dat'
	ionrec_path	STRING	path to save file where the ion/rec coefficients are stored DEFAULT: '/tmp/ionrec_coefs.dat'

OUTPUTS:
	result	DBLARR	[z*nrho,z*nrho]

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009
	6/7/12		M.L. Reinke - modified to use /tmp for temporary files

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="FQ">
<H2>FQ</H2></A>
<A HREF="#FORM_TRANSPORT_MATRIX">[Previous Routine]</A>
<A HREF="#FQPLT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	FQ

PURPOSE:
	This function reads data from the frac abund tables using READ_FQ_DATA and reformats it into easy
	to manage arrays

CALLING SEQUENCE:
	FQ,z,frac,te

INPUTS:
	z	INT	If you can't figure this out, go directly to jail and do not pass go (

OUTPUTS:
	frac:	FLTARR	[z+1,n_te] of the fractional abundance.  frac[i,*] is for the ionization state so
			frac[0,*] is neutral and frac[z,*] is fully stripped.
	te:	FLTARR	[n_te] of the electron temperature values from the table [eV]

OPTIONAL OUTPUTS:
	If z is outside the range of READ_FQ_DATA then frac and te will be returned as -1

MODIFICATION HISTORY:
	Written by:	ML Reinke - 8/16/07 (why the hell didn't I write this sooner?)
	6/2/08:		ML Reinke - made the Fournier tables read out seperately from the Mazzotta data
					for better Te gridding

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/read_fracabund_tables.pro)</STRONG><P>
<HR>
 
<A NAME="FQPLT">
<H2>FQPLT</H2></A>
<A HREF="#FQ">[Previous Routine]</A>
<A HREF="#GENTRAN">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	FQPLT

PURPOSE:
	This procedure will use READ_FQ_DATA to create a plot of fractional abundance
	versus electron temperature for 1 <= Z <= 28.  The resolution of the plots are
	limited to the Te meshing of 'table2.dat' so these plots aren't prime-time plots
	but are good for looking at what charge state would dominate in a particular
	Te range.  Noble gas-like charge states are easily observable.

CALLING SEQUENCE:
	FQPLT,z

INTPUS:
	z:	nuclear charge of the element of interest

OPTIONAL INPUTS:
	tr:	FLTARR te=[te0, te1] sets the te plotting range [DEFAULT [min,max]]

KEYWORD PARAMETERS:
	ps:	/ps to use the postscript defice (setup using ps_plot_3 in MLR_FUNCTIONS)
		file is saved to /home/username/idl/plots

OUTPUTS
	This procedure, when /ps isn't invoked, will take over window 20 

SIDE EFFECTS:
	Your PS and X-Win devices will be reconfigured as determined by the scripts XWPLOT
	and PS_PLOT_3 in /home/mlreinke/idl/general/mlr_functions.  Once again, I am the color
	table tyrant.

RESTRICTIONS:
	All restrictions of READ_FQ_DATA apply here as well.

MODIFICATION HISTORY:
	Written by: 	ML Reinke, 9-03-05
	6/2/08:		ML Reinke - forced a default tr and made data load through the FQ procedure,added Kr
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/read_fracabund_tables.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN">
<H2>GENTRAN</H2></A>
<A HREF="#FQPLT">[Previous Routine]</A>
<A HREF="#GENTRAN_DIFFCONV_PROFILES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN
	
PURPOSE:
	Solves the time-independent impurity transport equation given temperature and denisty data
	as well transport coefficients.

CALLING SEQUENCE:
	result=GENTRAN(shot,t,z,diff,conv,temp,dens,neut)

INPUTS:
	shot:	LONG	shot number to use for EFIT data
	t:	FLT	of the time point to use for EFIT [sec]
	diff:	STRUC	diffusion structure
		*.diff	[nrho]	of the assumed diffusivity [m^2/s]
		*.rho	[nrho] 	of the r/a values
	conv:	STRUC	convective structure
		*.diff	[nrho]	of the assumed convective velocity [m/s]
		*.rho	[nrho] 	of the r/a values
	temp:	STRUC	electron temperature structure
		*.temp	[nrho]	of the electron temperature [eV]
		*.rho	[nrho]	of the r/a values
		*.err	[nrho]	of the absolute error [eV]
	dens:	STRUC	electron density structure
		*.dens	[nrho]	of the electron density [m^-3]
		*.rho	[nrho]	of the r/a values
		*.err	[nrho]	of the absolute error [m^3]
	neut:	STRUC	neutral density structure
		*.dens	[nrho]	of the neutral density [m^-3]
		*.rho	[nrho]	of the r/a values
		*.err	[nrho]	of the absolute error [m^-3]

OPTIONAL INPUTS:
	rhomax:	FLT	maximum r/a values DEFAULT: (0.905-ro)/a = limiter radius
	nrho:	INT	number of rho points for which to calculate solution DEFAULT: 50
	k:	INT	meshing control, k=1 is even mesh k>1 increases density in edge DEFAULT: 2.0
	rff:	FLT	"recombination fudge factor" to multiply all the recombination rates by DEFAULT: 1.0
	iff:	FLT	"ionization fudge factor" to multiply all the ionization rates by DEFAULT: 1.0

KEYWORD PARAMETERS:
	adas:		/adas sends the command to load ADAS rates
	double:		/double uses double precision variables 
	verb:		/verb prints status output to console
	debug:		/debug stops the code just prior to the RETURN statment
	nodel:		/nodel will skip the step where the temporary transport/ion_rec savesets are removed
	norates:	/norates will skip computing the profile structures, saving time if running repeatedly and changing transport
	
OUTPUTS:
	result:	STRUC	contains the charge state density information and more
		*.csden		FLTARR	[z+1,nrho] of the charge state density [i,*] of ionization stage i
		*.cserr		FLTARR	[z+1,nrho] of the error in the charge state density calculated from temp.err, dens.err and neut.err
		*.rho		FLTARR	[nrho] of the r/a values of *.csden
		*.rmaj		FLTARR	[nrho] of the major radius values of *.csden [m]
		*.source	FLTARR	[nrho] of the normalized impurity source used
		*.ntot_th	FLTARR	[nrho] of the theoretical total impurity density from integrating the conv/diff profile
		*.irpath	STR	of the path to the interpolated ion/rec data (output of WRITE_IONREC_COEFS_TABLE)
		*.tpath		STR	of the path to the interpolated transport data (output of WRITE_TRANSPORT_COEFS_TABLE)
		*.vol		FLTARR	[nrho] of the volterm calculated using CALC_VOLTERM_PROFILE

MODIFICATION HISTORY:
	Written by: 	ML Reinke 2/09 (adapated from math in Dux 10/29)
	1/18/13		M.L. Reinke - added the /norates and /circ keywords

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_DIFFCONV_PROFILES">
<H2>GENTRAN_DIFFCONV_PROFILES</H2></A>
<A HREF="#GENTRAN">[Previous Routine]</A>
<A HREF="#GENTRAN_FQ">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_DIFFCONV_PROFILES

PURPOSE:
	This procedure creates diffusion and convection profiles
	structures by scaling a list of profile types (index'd by exp)

CALLING SEQUENCE:
	GENTRAN_DIFFCONV_PROFILES,exp,rhomax,diff_str,conv_str

INPUTS:
	exp	INT	indexes the transport "experiment" to use

OPTIONAL INPUTS:
	dff	FLOAT	scaling factor for diffusion profile DEFAULT=1.0
	cff	FLOAT	scaling factor for convection profile DEFAULT=1.0
	doff	FLOAT	DC offset, used in some exp, applied prior to
			multiplying by dff DEFAULT=0.01 [m^2/s]
	rhomax	FLOAT	maximum value of the radial grid (in r/a) DEFAULT=1.0

OUTPUTS:
	diff_str	STRUC of the diffusion profile
			*.diff FLTARR [npts]	of diffusion [m^2/s]
			*.rho  FLTARR [npts]	normalized minor radius (r/a)
	conv_str	STRUC of the convection profile
			*.diff FLTARR [npts]	of convection [m/s]
			*.rho  FLTARR [npts]	normalized minor radius (r/a)	

PROCEDURE:

MODIFICATION HISTORY:
	Written by	M.L. Reinke (extracted from GENTRAN_PROFILES) 1/6/13
	1/8/13		M.L. Reinke - made rhomax an optional input 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_FQ">
<H2>GENTRAN_FQ</H2></A>
<A HREF="#GENTRAN_DIFFCONV_PROFILES">[Previous Routine]</A>
<A HREF="#GENTRAN_NEUT_TRANSP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_FQ

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 2/10/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_NEUT_TRANSP">
<H2>GENTRAN_NEUT_TRANSP</H2></A>
<A HREF="#GENTRAN_FQ">[Previous Routine]</A>
<A HREF="#GENTRAN_PLOT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_NEUT_TRANSP

PURPOSE:
	This procedure loads the neutral density profile from a TRANSP run

CALLING SEQUENCE:
	GENTRAN_NEUT_TRANSP,shot,trshot,t,dt,neut

INPUTS:
	shot	LONG	shot number
	trshot	INT	path to a TRANSP run corresponding to SHOT
	t	FLTARR	of the lower time point [sec]	
	dt	FLTARR	of the the averaging time [sec]

OPTIONAL INPUTS:
	rho	FLTARR	[nrho] of a fixed radial grid on which to interpolate the dens and temp profiles
	en0	FLOAT	of the neutral density error [m^-3].  If set as a FLOAT then
			it is assumed to specify the fractional error of the entire profile.

KEYWORD PARAMETERS
	psin	/psin 	will give the rho vector is units of normalized
			poloidal flux by interpolating  RMAJ with EFIT_RMID
	center	/center	will take the center time point rather than
			averaging over the t+dt time inverval

OUTPUTS:
	neut_str	STRUC	of the neutral density data in the GENTRAN structure formation


MODIFICATION HISTORY:
	Written by:	M.L. Reinke - December 2013
 	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_PLOT">
<H2>GENTRAN_PLOT</H2></A>
<A HREF="#GENTRAN_NEUT_TRANSP">[Previous Routine]</A>
<A HREF="#GENTRAN_PROFILES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_PLOT

PURPOSE:
	This procedure is used to generate a plots from impurity
	transport simulations 

CALLING SEQUENCE:
	GENTRAN_PLOT,data

INPUTS:
	data	STRUC format (see RUN_CMOD_STRAHL or GENTRAN_PROFILES)

MODIFICATION HISTORY:
	Written by:	M.L. Reinke January 2013 - adapted from GENTRAN_PROFILES /plot option

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_PROFILES">
<H2>GENTRAN_PROFILES</H2></A>
<A HREF="#GENTRAN_PLOT">[Previous Routine]</A>
<A HREF="#GENTRAN_TENE_QUICKFITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_PROFILES
	
PURPOSE:
	This upper-level procedure runs GENTRAN for a given shot and impurity averaged
	over a time window.  Links to GENRAD utitlies are included to compute various
	radiation profiles.  

CALLING SEQUENCE:
	GENTRAN_PROFILES,shot,z,t1,t2
	
INPUTS:
	shot	LONG	shot number
	z	INT	impurity element number
	t1	FLOAT	lower time point for binning [sec]
	t2	FLOAT	upper time point for binning [sec]

OPTIONAL INPUTS:
	k	FLOAT	control of non-uniform radial gridding
	nrho	INT	number of radial grid points to compute 
	exp	INT	selects from a list of different types of impurity confinement (see PROCEDURE)
	nz	FLOAT	of the absolute impurity density to be used in radiation comparisons
	zeff	FLTARR	[nrad] of the zeff profile to be used when computing continuum (contant Zeff use FLOAT)
	tht	INT	specifies THACO tree number for HIREXSR comparisons
	ete	FLTARR	[nrad] specify the Te uncertainty (fractional error use FLOAT)
	ene	FLTARR	[nrad] specify the ne uncertainty (fractional error use FLOAT)
	eno	FLTARR	[nrad] specify the n0 uncertainty (fractional error use FLOAT)
	t_neut	FLOAT	temperature of the impurity neutral species [eV] (see GENTRAN)
	dff	FLOAT	"fudge-factor" multiplied into the diffusion profile DEFAULT=1.0
	doff	FLOAT	"offset" added to the diffusion profile DEFAULT=0.001 [m^2/s]
	cff	FLOAT	"fudge-factor" multiplied into the convection profile DEFAULT=1.0
	xff	FLOAT	"fudge-factor" multiplied into the C-X rates DEFAULT=1.0, 
			-1.0 turns off charge exchange by zero'ing the n0 profile
	rff	FLOAT	"fudge-factor" multiplied into REC rates (all charge states) DEFAULT=1.0
	iff	FLOAT	"fudge-factor" multiplied into ION rates (all charge states) DEFAULT=1.0
	tpt	FLOAT
	xph	FLOAT
	tph	FLOAT

KEYWORD PARAMETERS:
	qfit		/qfit runs GENIE/qfit.pro "quick fits" for Te and ne profiles 
	apip		/apip (legacy) - not for general use
	adas		/adas loads ADAS atomic physics data
	ptsource	/ptsource assumes a point impurity source at r/a=1
	plot		/plot outputs the radial n_e,Te,n_0,n_z0,D,v and csden profiles to the active device
	debug		/debug stops the code at the end of GENTRAN_PROFILES
	ave

	GENRAD MODELING KEYWORDS	
	axuv		/axuv will launch AXUV_GENRAD_PROFILES using the simulation output
	foil		/foil will launch AXUV_GENRAD_PROFILES using the simulation output
	hirexsr		/hirexsr will launch HIREXSR_GENRAD_THACO_PROFILES using the simulation output
	mcp		/mcp will launch MCP_GENRAD_PROFILES using the simulation output
	xtomo		/xtomo will launch XTOMO_GENRAD_PROFILES using the simulation output

OPTIONAL OUTPUTS:
	csden	FLTARR	[z+1,nr] of the normalized charge state density profile
	rhovec	FLTARR	[nr] of the r/a values for csden
	data	STRUC	input data used in the simulation and results
		*.shot	LONG	shot number
		*.time	FLOAT	average time point [sec] 0.5*(t1+t2)
		*.temp	FLTARR	[nr] electron temperature [keV]
		*.terr	FLTARR	[nr] of the unc. in temp [keV]
		*.dens	FLTARR	[nr] of the electron density [m^3]
		*.derr	FLTARR	[nr] of the unc. in the dens [m^3]
		*.neut	FLTARR	[nr] of the neutral density [m^3]
		*.nerr	FLTARR	[nr] of the unc. in neut [m^3]
		*.rho	FLTARR	[nr] of the r/a values
		*.rmaj	FLTARR	[nr] of the outboard midplane major radius values [m]
		*.csden	FLTARR	[z+1,nr] of the normalized charge state density profiles
		*.cserr	FLTARR	[z+1,nr[ of the unc. in csden
	outa	STRUC	measured and modeled AXUV emissivity data	
	outf	STRUC	measured and modeled resistive bolometer emissivity data
	outh	STRUC	measured and modeled HIREXSR emissivity data
	outm	STRUC	measured and modeled McPherson emissivity data
	outx	STRUC	measured and modeled XTOMO emissivity data
	
MODIFICATION HISTORY:
	Written by	M.L. Reinke - Spring 2009
	6/7/12		M.L. Reinke - modified the density loading
	6/12/12		M.L. Reinke - added documentation, removed dead I/O flags and added the
				      AXUV data output (outa)
	1/4/13		M.L. Reinke - modified the pcase=0 (fiTS) to have t,dt time input form
	1/6/13		M.L. Reinke - extracted the diff/conv structure code to
                                     GENTRAN_DIFFCONV_PROFILES so I could used in STRAHL as well
	12/6/13		M.L. Reinke - added the ability to read the TRANSP neutral density profile via trshot
	12/12/13	M.L. Reinke - added ability to output/input the DIFF, CONV, TEMP, DENS and
					NEUT structures to speed up repeated calls in minimization routines.
	9/14/14		M.L. Reinke - added ability to GPFIT for Te,ne
	10/12/2014   	M.L. Reinke - modified use of gpfit keyword to allow it carry path information	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_TENE_QUICKFITS">
<H2>GENTRAN_TENE_QUICKFITS</H2></A>
<A HREF="#GENTRAN_PROFILES">[Previous Routine]</A>
<A HREF="#GENTRAN_TENE_WIDGETFITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_TENE_QUICKFITS

PURPOSE:
	This procedure runs qfit.pro and creates the temperature and density 
	structures for use with GENTRAN

CALLING SEQUENCE:
	GENTRAN_TENE_QUICKFITS,shot,t1,t2,temp,dens
INPUTS:
	shot	LONG	shot number
	t	FLTARR	[ntime] of the start time of the bins [sec]
	dt	FLTARR	[ntime] of the length of the time bins [sec]

OPTIONAL INPUTS:
	rho	FLTARR	[nrho] of a fixed radial grid on which to interpolate the dens and temp profiles
	ete	FLTARR	[ntemp] of the electron temperature error [eV].  If set as a FLOAT then
			it is assumed to specify the fractional error of the entire profile.
	ene	FLTARR	[ndens] of the electron density error [m^-3].  If set as a FLOAT then
			it is assumed to specify the fractional error of the entire profile.

KEYWORD PARAMETERS
	psin	/psin 	will give the rho vector is units of normalized
			poloidal flux by interpolating  RMAJ with EFIT_RMID
	center	/center	will take the center time point rather than
			averaging over the t+dt time inverval

OUTPUTS:
	dens	STRUC	of the electron density data in the GENTRAN structure formation
	temp	STRUC	of the electron temperature data in the GENTRAN structure formation

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 6/7/12
	7/3/12		M.L. Reinke - modified to use the t and dt FLTARRs for specifying multiple
				      time points.
	1/4/13		M.L. Reinke - added the /psin keyword and rho optional input
	1/16/13		M.L. Reinke - added the /center keyword 		
	11/6/14		M.L. Reinke - added the time and dt arrays to the output structure 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="GENTRAN_TENE_WIDGETFITS">
<H2>GENTRAN_TENE_WIDGETFITS</H2></A>
<A HREF="#GENTRAN_TENE_QUICKFITS">[Previous Routine]</A>
<A HREF="#MAKE_CMOD_GRID">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GENTRAN_TENE_WIDGETFITS

PURPOSE:
	This procedure loads a fiTS save file and creates the temperature and
	density structures for use with GENTRAN

CALLING SEQUENCE:
	GENTRAN_TENE_WIDGETFITS,path,t1,t2,temp,dens

INPUTS:
	path	STRING	path to the fiTS save file
	t	FLTARR	of the lower time point [sec]	
	dt	FLTARR	of the the averaging time [sec]

OPTIONAL INPUTS:
	rho	FLTARR	[nrho] of a fixed radial grid on which to interpolate the dens and temp profiles
	ete	FLOAT	of the electron temperature error [eV].  If set as a FLOAT then
			it is assumed to specify the fractional error of the entire profile.
	ene	FLOAT	of the electron density error [m^-3].  If set as a FLOAT then
			it is assumed to specify the fractional error of the entire profile.

KEYWORD PARAMETERS
	psin	/psin 	will give the rho vector is units of normalized
			poloidal flux by interpolating  RMAJ with EFIT_RMID
	center	/center	will take the center time point rather than
			averaging over the t+dt time inverval

OUTPUTS:
	dens	STRUC	of the electron density data in the GENTRAN structure formation
	temp	STRUC	of the electron temperature data in the GENTRAN structure formation

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009
 	1/4/13		M.L. Reinke - added the /psin keyword, rho optional input and allowed for
                                     multiple time points via t,dt
	1/16/13		M.L. Reinke - added the /center keyword to facilitate long time domain simulations
				      and fixed the rmaj temporal indexing
	11/6/14		M.L. Reinke - added the time and dt arrays to the output structure 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="MAKE_CMOD_GRID">
<H2>MAKE_CMOD_GRID</H2></A>
<A HREF="#GENTRAN_TENE_WIDGETFITS">[Previous Routine]</A>
<A HREF="#MAKE_CMOD_PARAM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	MAKE_CMOD_GRID
	
PURPOSE:
	This procedure constructs the grid input file for STRAHL and
	produces graphical output.  This works for steady-state equilibria

CALLING SEQUENCE:
	MAKE_CMOD_GRID,shot,grid_time
	
INPUTS:
	shot		LONG	shot number
	grid_time	FLOAT	time point

KEYWORD PARAMETERS
	plot	/plot will graphically output equilibrium data
	ps	/ps will force graphical output to the PS device (if /plot)

OUTPUTS:
	ASCII file (/home/username/strahl/cmod/grid_shotnumber.0)
	XWIN/PS of the EFIT equilibrium, the interpolated equilibrium
		and the neoclassical transport parameters

OPTIONAL OUTPUTS:
	filepath	STRING gives the path to the ASCII file

MODIFICATION HISTORY:
	Written by:	T. Putterich 5/2010
	3/5/12		M.L. Reinke - modified the default ASCII file path
	1/14/12		M.L. Reinke - modified path to match Mercurial strahl version

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN//strahl/make_cmod_grid.pro)</STRONG><P>
<HR>
 
<A NAME="MAKE_CMOD_PARAM">
<H2>MAKE_CMOD_PARAM</H2></A>
<A HREF="#MAKE_CMOD_GRID">[Previous Routine]</A>
<A HREF="#MAKE_CMOD_PP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	MAKE_CMOD_PARAM

PURPOSE:
	This procedure to generate the setup file for use
	with the STRAHL impurity transport code

CALLING SEQUENCE:
	MAKE_CMOD_PARAM,shot,z,t1,t2
	
INPUTS:
	shot	LONG	shot number
	z	INT	atomic number of impurity 
	t1	FLOAT	time to start simulation
	t2	FLOAT 	time to end simulation

OPTIONAL INPUTS:
	dt	FLOAT	time step DEFAULT: 0.1 ms
	ncyc	INT	number of time steps per cycle DEFAULT: 10
	ion	STRING	of the background ion DEAFULT 'D' (deuterium)
	tneut	FLOAT	temperature at which the neutrals enter the domain DEFAULT 1 eV
	niter	INT	number of iterations DEFAULT=2000
	fiter	FLOAT	stop condition for frac. change DEFAULT=0.02
	start	STRUC	of shot/time to use as a starting point for simulation DEFAULT not used
		*.shot	shot number of reference
		*.time	time at which to start
		
	******* RADIAL GRID OPTIONS *********
	k	INT	equally spaced points in rho^k DEFAULT=1.5
	nrho	INT	number of points in radial grid DEFAULT=100
	dr	FLTARR	[dr_cent,dr_edge] if > 0 enables alternate
			gridding as described in (1.37) in STRAHL Manual (IPP-10/30) DEFAULT [-1.0,-1.0]

	******* PLASMA TRANSPORT OPTIONS *********	
	### See GENTRAN_DIFFCONV_PROFILES for details ###
	exp	INT	of the pre-determined transport "experiments" to use for diff/conv profiles DEFAULT = 1
	dff	FLOAT	"fudge-factor" used to multiply diffusion profiles DEFAULT=0.5
	cff	FLOAT	"fudge-factor" used to multiply convection profiles DEFAULT=1.0
	doff	FLOAT	DC offset in diffusion profile DEFAULT=0.01 [m^2/s]
	
	### Directly specify the profiles ###
	diff	STRUC	of the diffusion profile
		*.diff	[nrho,ntransp]	of the diffusion profile [m^2/s]
		*.rho	[nrho] of the radial grid [norm. pol. flux]
		*.time	[ntransp] of time grid [sec]
	conv	STRUC	of the convection profile
		*.conv	[nrho,ntransp]	of the convection profile [m/s]
		*.rho	[nrho] of the radial grid [norm. pol. flux]
		*.time	[ntransp] of time grid [sec]

	If these profiles are fixed in time *.time can be ommitted and *.diff (*.conv) need only be [nrho]

	### Sawtooth Modeling ###
	saw	STRUC	of the 

	******* IMPURITY SOURCE OPTIONS *********	
	fz	FLOAT	scaling of the source rate DEFAULT=1.0
	source	FLOAT/STRING/STRUC that sets the time evolving impurity source	
	
	source	FLOAT	source=0.0 means fz*10^17 1/s is on continuously from start to finish DEFAULT
			source > 0 means fz*10^17 1/s is on and stays on after t=source
			source < 0 means fz*10^17 1/s is on for 1 ms, simulating an injection
	source	STRING	assumed to be a path to file properly formatted for STRAHL, and is merely copied to spath
	source	STRUC	structure of the time-evolving source
		*.(0)	[ntau] time evolving source [1/s]
		*.(1)	[ntau] time vector of the source [sec]

OUTPUTS:
	All data are written to an ASCII file formatted as per the instructions in the STRAHL manual.  This file written to the
	users home directory in ~/strahl/cmod/run_SHOTNUMBER.0 and, if necessary, the source file is also written to the same
	directory as ZzflxSHOTNUMBER.dat

OPTIONAL OUTPUTS:
	filepath	STRING	of the path to the parameter file
	spath		STRING	of the path to the source file (if generated )
	diff		STRUC 	(see above) available as an output if not set as input
	conv		STRUC 	(see above) available as an output if not set as input
		

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - January 2013 (adapted from N.T. Howards's WRITE_STRAHL_FILES.PRO)
	1/14/13		M.L. Reinke - modified the transport profiles to accept time-evolving diff/conv data
	1/16/13		M.L. Reinke - added the fz optional input, changed PSIN max to 0.99 for
                                     neoclassical computation and made NEOART=2 the default option
	10/12/14	M.L. Reinke - modified the steady-state source to allow for lower rates, 
       11/11/14	M.L. Reinke - added a check to interpolate diff/conv onto a 100-pt radial grid to avoid a bug in STRAHL                             

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN//strahl/make_cmod_param.pro)</STRONG><P>
<HR>
 
<A NAME="MAKE_CMOD_PP">
<H2>MAKE_CMOD_PP</H2></A>
<A HREF="#MAKE_CMOD_PARAM">[Previous Routine]</A>
<A HREF="#READ_FQ_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	MAKE_CMOD_PP

PURPOSE:
	This procedure is used to generate the spatial profile input
	file for use with the STRAHL impurity transport code

CALLING SEQUENCE:
	MAKE_CMOD_PP,shot,time,dt (must specify either /fits or /qfit)

INPUTS:
	shot	LONG	shot number
	time	FLTARR	of the time points (lower bound)
	dt	FLTARR	of the (boxcar) averaging interval
	*** This makes the center time points time+dt/2.0 ***

OPTIONAL INPUTS:
	ln_sol	FLOAT	the n_e scale length [cm] for the SOL (DEFAULT uses specified radial profile)
	lt_sol	FLOAT	the T_e scale length [cm] for the SOL (DEFAULT uses specified radial profile)
	rho	FLTARR	of the r/a grid points DEFAULT is 100 pts (evenly spaced) between 0 < r/a 1.0 
	nfrac	FLOAT	sets the neutral density to be nfrac*elec. density
	trshot	LONG	loads the neutral density profile from TRANSP run under trshot
	fte	FLOAT	'fudge factor' multipled into the Te profile, used for sensitivity analysis
	fne	FLOAT	'fudge factor' multipled into the ne profile, used for sensitivity analysis
	fn0	FLOAT	'fudge factor' multipled into the n0 profile, used for sensitivity analysis
	temp	STRUC	of the time-evolving electron temperature
		*.temp	FLTARR 	[xrho,xtime] of the electron temperature [eV]
		*.rho	FLTARR 	[xrho] of the radial grid [norm. pol. flux]
		*.time	FLTARR	[xtime] of the time points [sec]
 	dens	STRUC	of the time-evolving electron temperature
		*.temp	FLTARR 	[yrho,ytime] of the electron density
		*.rho	FLTARR 	[yrho] of the radial grid [norm. pol. flux]
		*.time	FLTARR	[ytime] of the time points [sec]
 	
KEYWORD PARAMETERS
	qfit	/qfit will use the "quick_fits" program in /usr/local/cmod/idl/ to compute the T_e and n_e profiles
	gpfit	/gpfit will load using GPFIT results for T_e and n_e from /home/USERNAME/gpfit/gpfit_XX_shot_0
		STRING will look for gpfit_XX_SHOT_0 in path given by gpfit STRING
	fits	/fits will look in the usrs ~/fits/ directory for fits_SHOTNUMBER.save
	
OUTPUTS:
	The file "ppSHOTNUMBER.0" is written in the ~/strahl/cmod/ directory

OPTIONAL OUTPUTS:
	filepath	STRING of the path of the output file 

PROCEDURE:
	This procedure uses the GENTRAN codes GENTRAN_TENE_WIDGETFITS (/fits), GENTRAN_TENE_GPFIT or GENTRAN_TENE_QUICKFITS (/qfit) to produce smooth
	te & ne profiles for use in STRAHL.  The ln_sol and lt_sol will toggle the 'interp' and 'interpa' flags as per instructions in the
	STRAHL manual.  GENTRAN code GENTRAN_NEUT_TRANSP specifies the neutral density profile if given TRSHOT

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - January 2013 (adapted from N.T. Howards's WRITE_STRAHL_FILES.PRO)
	M.L. Reinke	12/2/2013 - added TRSHOT and fXX optional inputs to specify neutral density profile from TRANSP
	M.L. Reinke	9/14/2014 - added the /gpfit keyword
       M.L. Reinke	10/12/2014 - modified use of gpfit keyword to allow it carry path information
	M.L. Reinke	11/7/14 - added the ability to specify TEMP and DENS structures.

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN//strahl/make_cmod_pp.pro)</STRONG><P>
<HR>
 
<A NAME="READ_FQ_DATA">
<H2>READ_FQ_DATA</H2></A>
<A HREF="#MAKE_CMOD_PP">[Previous Routine]</A>
<A HREF="#READ_ION_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_FQ_DATA

PURPOSE:
	The purpose of this function is load fractional abundance data for 1 <= Z <= 28
	for Te > 1.0 (to fully stripped).  Data is loaded directly from 'table2.dat'
	referenced in Mazzotta 'Astronomy & Astrophysics Supplement Series' v133 p403
	1998 without interpolation.  The closest value Te is used.  Fournier tables are used
	for Z=18,36,42

CALLING SEQUENCE:
	result=READ_FQ_DATA(z,te)

INPUTS:
	z:	INT nuclear charge to identify the element
	te:	FLT electron temperature in [eV]

KEYWORD PARAMETERS:
	quiet:	/quiet to supress error messages to terminal
	debug:	/debug to stop after the line has been identified and decompiled 
		(use print, line to print the line from the table that was used)
	
OUTPUTS:
	result:	STRUC that holds the data read from tables
		*.q 	INTARR of ionization states
		*.fq	FLTARR of fractional abundances
		*.te	FLT the actual Te that was given in the table [eV]

OPTIONAL OUTPUTS:
	result=-1	Z(> 28 or < 1 if you're a tool) Te (< 1 eV) is out of range
	result=-2	Te requested above the upper range of the table, assume fully stripped

RESTRICTIONS:
	This code requiers MLR_FUNCTIONS and READ_ATOMIC_NAME.  Use @genie_ini.bat to load the
	correct depenencies.

MODIFICATION HISTORY
	Written by: 	ML Reinke, 9-03-05, I can't believe I didn't do this sooner
	6/2/08:		ML Reinke - Added Fournier's Ar,Kr data and changed the formatting of the Mo data.
	6/8/12:		ML Reinke - moved the data and pathing to /usr/local/cmod/idl/atomic_physics	

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/read_fracabund_tables.pro)</STRONG><P>
<HR>
 
<A NAME="READ_ION_DATA">
<H2>READ_ION_DATA</H2></A>
<A HREF="#READ_FQ_DATA">[Previous Routine]</A>
<A HREF="#READ_REC_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_ION_DATA

PURPOSE:
	This function loads the ION stucture by calling z-specific routines.

CALLING SEQUENCE:
	result=READ_ION_DATA(z)

INPUTS:
	z:	INT	the atomic number for the rates of interest

KEYWORD PARAMETERS:
	adas:	/adas loads the data from adas tables

OUTPUTS:
	result:	STRUC	containing the ionization rates
		*.rates	FLTARR 	[z+1,nt,nd] of the ionization rates [i,*,*] for ionization stage [i] for temperature and density [m^3/s]
		*.temp	FLTARR 	[nt] of the electron temperatures for the rates [eV]
		*.dens	FLTARR	[nd] of the electron densities for the rates [m^-3]
		*.z	INT	z input to the function
		*.path	STR	of the path to the datafile where the rates were loaded

MODIFICATION HISTORY:
	Written by: 	ML Reinke - 3/09
	6/7/12		ML Reinke - modified pathing for tungsten ADAS file to /usr/local/cmod/idl/atomic_physics/
	6/11/12		ML Reinke - modified to force a /load going into READ_LOCH_ION_DATA
	6/12/12		ML Reinke - removed READ_LOCH_REC_DATA /load

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/ionrec.pro)</STRONG><P>
<HR>
 
<A NAME="READ_REC_DATA">
<H2>READ_REC_DATA</H2></A>
<A HREF="#READ_ION_DATA">[Previous Routine]</A>
<A HREF="#RUN_CMOD_STRAHL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_REC_DATA

PURPOSE:
	This function loads the REC stucture by calling z-specific routines.

CALLING SEQUENCE:
	result=READ_REC_DATA(z)

INPUTS:
	z:	INT	the atomic number for the rates of interest

KEYWORD PARAMETERS:
	adas:	/adas loads the data from adas tables

OUTPUTS:
	result:	STRUC	containing the recombination rates
		*.rates	FLTARR 	[z+1,nt,nd] of the recombination rates [i,*,*] for ionization stage [i] for temperature and density [m^3/s]
		*.temp	FLTARR 	[nt] of the electron temperatures for the rates [eV]
		*.dens	FLTARR	[nd] of the electron densities for the rates [m^-3]
		*.z	INT	z input to the function
		*.path	STR	of the path to the datafile where the rates were loaded

OPTIONAL OUTPUTS:
	cxr:	STRUC	containing the charge exchange recombination rates [same format as result]

MODIFICATION HISTORY:
	Written by: 	ML Reinke - 3/09
	6/7/12		ML Reinke - modified pathing for tungsten ADAS file to /usr/local/cmod/idl/atomic_physics/
	6/11/12		ML Reinke - modified to force a /load going into READ_LOCH_REC_DATA
	6/12/12		ML Reinke - removed READ_LOCH_REC_DATA /load

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/ionrec.pro)</STRONG><P>
<HR>
 
<A NAME="RUN_CMOD_STRAHL">
<H2>RUN_CMOD_STRAHL</H2></A>
<A HREF="#READ_REC_DATA">[Previous Routine]</A>
<A HREF="#WRITE_IONREC_COEFS_TABLE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	RUN_CMOD_STRAHL

PURPOSE:
	This is a higher level procedure which generates input files for the STRAHL impurity transport code, 
	executes the code and then outputs selected data from the netCDF file.

CALLING SEQUENCE:
	RUN_CMOD_STRAHL,shot,z,ta,tb,csden,rho,time

INPUTS:
	shot	LONG	shot number
	z	INT	atomic number of impurity to simulate
	ta	FLOAT	start time of simulation (see optional inputs)
	tb	FLOAT	stop time of simulation (see optional inputs)
	
OPTIONAL INPUTS:
	ta	FLTARR	[ntau] start times of time bins
	tb	FLTARR  [ntau] delta times of time bins
	MAKE_CMOD_GRID Options: /gps (/ps) and /gplots (/plots)
	MAKE_CMOD_PP Options: ln_sol, lt_sol, fits, gpfit, temp, dens (/qfits is default)
	MAKE_CMOD_PARAM Options: k,nrho,source,tau,fz,exp,dff,cff,doff,diff,conv,saw
	GENTRAN_PLOT Options: xr,qhigh,qlow,time (tplot)

	plot	INT	use /plot to plot only the radial profiles using GENTRAN_PLOT and use plot=q to plot both GENTRAN_PLOT
			and a GENPLT of that time-evolving csden[*,q,*] profile
	path	STRING	location of STRAHL output file, if set as input skips running of STRAHL and reads the output file

KEYWORD PARAMETERS:
	nogrid		/nogrid skips MAKE_CMOD_GRID and does not copy the output file from ~/strahl/cmod to ~/strahl/nete
	nopp		/nopp skips MAKE_CMOD_PP and does not copy the output file from ~/strahl/cmod to ~/strahl/nete
	noparam		/noparam skips MAKE_CMOD_PARAM and does not copy the output file from ~/strahl/cmod to ~/strahl/param_files
	nostrahl	/nostrahl skips executing STRAHL as well as the MAKE_CMOD*, useful for viewing already run data
	debug		/debug stops the code before and after the execution of STRAHL
	list		/list will list the possible variables that can be retrieved from the STRAHL CDF file
	quiet		/quiet will suppress terminal notifications 

OUTPUTS:
	csden	FLTARR	[nrho,z+1,ntime] of the charge state density profiles output from STRAHL
	rho	FLTARR 	[nrho] of the radial grid in r/a
	time	FLTARR	[ntime] of the time scale [sec]

OPTIONAL OUTPUTS:
	path	STRING	of the location of the output file, if set as input leads to different behavior (see INPUTS)
	term	STRARR	of the terminal output from running STRAHL
	data	STRUC	of relevant data I/O from the STRAHL run
		*.shot	LONG	shot number
		*.time	DBLARR	[ntime] time points [sec]
		*.temp	DBLARR	[nrho,ntime] of the electron temp. [eV]
		*.terr	DBLARR	[nrho,ntime] of the unc. in temp. DEFAULT=0.0
		*.dens	DBLARR	[nrho,ntime] of the electron dens. [m^-3]
		*.derr	DBLARR	[nrho,ntime] of the unc. in dens. DEFAULT=0.0
		*.neut	DBLARR	[nrho,ntime] of the neutral dens. [m^-3]
		*.nerr	DBLARR	[nrho,ntime] of the unc. in neutral dens. DEFAULT=0.0
		*.psin	DBLARR	[nrho] of the radial grid in norm. pol. flux
		*.rho	DBLARR	[nrho] of the radial grid in r/a
		*.rmaj	DBLARR	[nrho] of the radial in LFS midplane major radius [m]
		*.csden	DBLARR	[nrho,z+1,ntime] of the charge state densities [m^-3]
		*.cserr	DBLARR	[nrho,z+1,ntime] of the unc. in the charge state densities [m^-3] DEFAULT=0.0
		*.diff	DBLARR	[nrho,ntime] of the specified diffusion profile [m^2/s]
		*.conv	DBLARR	[nrho,ntime] of the specified convection profile [m/s]
		*.dneo	DBLARR	[nrho,ntime] the neoclassical diffusion computed using NEOART [m^2/s]
		*.vneo	DBLARR	[nrho,ntime] the neoclassical convection computed using NEOART [m/s]

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - January 2013
	M.L. Reinke	12/2/2013 - added the TRSHOT and FXX keywords into MAKE_CMOD_PP
	M.L. Reinke	12/13/2013 - added the PATH keyword to enable read-only operation and output offile location
	M.L. Reinke 	9/14/2014 - added the GPFIT keyword
	M.L. Reinke	11/6/2014 - modified how time data is specified to allow for time-evolving kinetic profiles

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN//strahl/run_cmod_strahl.pro)</STRONG><P>
<HR>
 
<A NAME="WRITE_IONREC_COEFS_TABLE">
<H2>WRITE_IONREC_COEFS_TABLE</H2></A>
<A HREF="#RUN_CMOD_STRAHL">[Previous Routine]</A>
<A HREF="#WRITE_TRANSPORT_COEFS_TABLE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	WRITE_IONREC_COEFS_TABLE

PURPOSE:
	This procedure computes the ion/rec rate coefficients and the kinetic profiles on the radial grid
	defined for the simulation and saves it to a temporary file.

CALLING SEQUENCE:
	WRITE_IONREC_COEFS_TABLE,rho,ion,rec,cxr,temp,dens,neut,a

INPUTS:
	rho	FLTARR	[nrho] of the r/a points used in the simulation
	ion	STRUC	ionization rate structure (see READ_ION_DATA)
	rec	STRUC	recombination rate structure (see READ_REC_DATA)
	cxr	STRUC	charge exchange rate structure (see READ_REC_DATA)
	temp	STRUC	electron temperature structure (see GENTRAN)
	dens	STRUC	electron density structure (see GENTRAN)
	neut	STRUC	neutral density structure (see GENTRAN)
	a	FLOAT	minor radius

OPTIONAL INPUTS:
	path	path to save IDL savesets computed by this function DEFAULT: '/tmp/ionrec_coefs.dat'

OUTPUTS:
	The ionrec_coefs structure is saved to the file defined by PATH.  The format is for [0,*] to be the neutral
	species and [z,*] to be the full stripped.  Ionization rates for [z,*]=0 and recombination rates for [0,*]=0.
		ionrec_coefs	STRUC	interpolated rate and kinetic profile data to be used in GENTRAN
				*.i	[z+1,nrho] ionization rate coeff for each charge state [m^3/s]
				*.di	[z+1,nrho] uncertainty in the ionization rate coeff [m^3/s]
				*.r	[z+1,nrho] recombination rate coeff for each charge state [m^3/s]
				*.dr	[z+1,nrho] uncertainty in the recombination rate coeff [m^3/s]
				*.c	[z+1,nrho] charge exchange rate coeff for each charge state [m^3/s]
				*.dc	[z+1,nrho] uncertainty in the charge exchange rate coeff [m^3/s]
				*.d	[nrho] electron density [m^-3]
				*.derr	[nrho] uncertainty in the electron density [m^-3]
				*.t	[nrho] electron temperature [eV]
				*.terr	[nrho] uncertainty in the electron temperature [eV]
				*.n	[nrho] neutral density [m^-3]
				*.nerr	[nrho] uncertainty in the neutral density [m^-3]

MODIFICATION HISTORY:
	Written by:	ML Reinke - Spring 2009
	6/7/12		ML Reinke - modified the path to save to /tmp/

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
<A NAME="WRITE_TRANSPORT_COEFS_TABLE">
<H2>WRITE_TRANSPORT_COEFS_TABLE</H2></A>
<A HREF="#WRITE_IONREC_COEFS_TABLE">[Previous Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	WRITE_TRANSPORT_COEFS_TABLE
	
PURPOSE:
	This procedure composes the transport coefficient structure and saves it to a temporary file

CALLING SEQUENCE:
	WRITE_TRANSPORT_COEFS_TABLE,rho,x,dxdrho,d2xdrho2,diff,conv,volterm,a,r

INPUTS:
	rho		FLTARR	[nrho] of the r/a 
	x		FLTARR	[nrho]
	dxdrho		FLTARR	[nrho]
	d2xdrho2	FLTARR	[nrho]
	diff		STRUC   
	conv		STRUC
	volterm		FLTARR	[nrho]
	a		FLOAT	minor radius [m]
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENTRAN/gentran.pro)</STRONG><P>
<HR>
 
</body>
</html>
