<!-- This file was generated by mk_html_help.pro -->
<html>
 
<head>
<TITLE>THACO</TITLE>
</head>
 
<body>
<H1>THACO</H1>
<P>
This page was created by the IDL library routine 
<CODE>mk_html_help</CODE>.  For more information on 
this routine, refer to the IDL Online Help Navigator 
or type: <P>
<PRE>     ? mk_html_help</PRE><P>
at the IDL command line prompt.<P>
<STRONG>Last modified: </STRONG>Thu Jan 17 09:56:59 2013.<P>
 
<HR>
 
<A NAME="ROUTINELIST">
<H1>List of Routines</H1></A>
<UL>
<LI><A HREF="#ELLIPSE_XPT">ELLIPSE_XPT</A>
<LI><A HREF="#EQ_ELLIPSE">EQ_ELLIPSE</A>
<LI><A HREF="#GAUSSIAN_FITS">GAUSSIAN_FITS</A>
<LI><A HREF="#HIREXR_WRITE_RAYTRC">HIREXR_WRITE_RAYTRC</A>
<LI><A HREF="#HIREXSR_ADDNEW_ANALYSIS">HIREXSR_ADDNEW_ANALYSIS</A>
<LI><A HREF="#HIREXSR_AR_EXIST">HIREXSR_AR_EXIST</A>
<LI><A HREF="#HIREXSR_AUTOBIN">HIREXSR_AUTOBIN</A>
<LI><A HREF="#HIREXSR_AUTOCHMAP">HIREXSR_AUTOCHMAP</A>
<LI><A HREF="#HIREXSR_AUTOTMAP">HIREXSR_AUTOTMAP</A>
<LI><A HREF="#HIREXSR_AUTO_TMAP">HIREXSR_AUTO_TMAP</A>
<LI><A HREF="#HIREXSR_AVESPEC2TREE">HIREXSR_AVESPEC2TREE</A>
<LI><A HREF="#HIREXSR_AVESPEC_ARR2PTR">HIREXSR_AVESPEC_ARR2PTR</A>
<LI><A HREF="#HIREXSR_AVESPEC_PTR2ARR">HIREXSR_AVESPEC_PTR2ARR</A>
<LI><A HREF="#HIREXSR_AVE_SPEC">HIREXSR_AVE_SPEC</A>
<LI><A HREF="#HIREXSR_BIN_BOUNDS">HIREXSR_BIN_BOUNDS</A>
<LI><A HREF="#HIREXSR_BIN_IMAGE">HIREXSR_BIN_IMAGE</A>
<LI><A HREF="#HIREXSR_BIN_INST">HIREXSR_BIN_INST</A>
<LI><A HREF="#HIREXSR_BIN_POS">HIREXSR_BIN_POS</A>
<LI><A HREF="#HIREXSR_BIN_SPEC">HIREXSR_BIN_SPEC</A>
<LI><A HREF="#HIREXSR_BIN_TIME">HIREXSR_BIN_TIME</A>
<LI><A HREF="#HIREXSR_CALC_DATA">HIREXSR_CALC_DATA</A>
<LI><A HREF="#HIREXSR_CALC_MOMENTS">HIREXSR_CALC_MOMENTS</A>
<LI><A HREF="#HIREXSR_CALC_PROFILES">HIREXSR_CALC_PROFILES</A>
<LI><A HREF="#HIREXSR_CALC_RESID">HIREXSR_CALC_RESID</A>
<LI><A HREF="#HIREXSR_CALC_RHOTANG">HIREXSR_CALC_RHOTANG</A>
<LI><A HREF="#HIREXSR_CHANGE_CRYSTAL_BETA">HIREXSR_CHANGE_CRYSTAL_BETA</A>
<LI><A HREF="#HIREXSR_CHANGE_CRYSTAL_DECL">HIREXSR_CHANGE_CRYSTAL_DECL</A>
<LI><A HREF="#HIREXSR_CHECK_ANALYSIS">HIREXSR_CHECK_ANALYSIS</A>
<LI><A HREF="#HIREXSR_CHECK_CALIB">HIREXSR_CHECK_CALIB</A>
<LI><A HREF="#HIREXSR_CHECK_SIZE">HIREXSR_CHECK_SIZE</A>
<LI><A HREF="#HIREXSR_CLONE_ANALYSIS">HIREXSR_CLONE_ANALYSIS</A>
<LI><A HREF="#HIREXSR_COEFS2LAM">HIREXSR_COEFS2LAM</A>
<LI><A HREF="#HIREXSR_COEFS_ARR2PTR">HIREXSR_COEFS_ARR2PTR</A>
<LI><A HREF="#HIREXSR_COEFS_PTR2ARR">HIREXSR_COEFS_PTR2ARR</A>
<LI><A HREF="#HIREXSR_CONSTRAINED_INFO">HIREXSR_CONSTRAINED_INFO</A>
<LI><A HREF="#HIREXSR_COPY_BINNING">HIREXSR_COPY_BINNING</A>
<LI><A HREF="#HIREXSR_COPY_CALIB">HIREXSR_COPY_CALIB</A>
<LI><A HREF="#HIREXSR_COPY_COMMENT">HIREXSR_COPY_COMMENT</A>
<LI><A HREF="#HIREXSR_COPY_INFO">HIREXSR_COPY_INFO</A>
<LI><A HREF="#HIREXSR_COPY_SETUP">HIREXSR_COPY_SETUP</A>
<LI><A HREF="#HIREXSR_EXTRACT_CHECK">HIREXSR_EXTRACT_CHECK</A>
<LI><A HREF="#HIREXSR_FILL_RESID">HIREXSR_FILL_RESID</A>
<LI><A HREF="#HIREXSR_FIND_DEC">HIREXSR_FIND_DEC</A>
<LI><A HREF="#HIREXSR_FITSPEC2TREE">HIREXSR_FITSPEC2TREE</A>
<LI><A HREF="#HIREXSR_FIT_CA_WN3">HIREXSR_FIT_CA_WN3</A>
<LI><A HREF="#HIREXSR_FIT_H">HIREXSR_FIT_H</A>
<LI><A HREF="#HIREXSR_FIT_HE">HIREXSR_FIT_HE</A>
<LI><A HREF="#HIREXSR_FIT_HE_CA">HIREXSR_FIT_HE_CA</A>
<LI><A HREF="#HIREXSR_FIT_H_CA">HIREXSR_FIT_H_CA</A>
<LI><A HREF="#HIREXSR_FIT_IMAGE">HIREXSR_FIT_IMAGE</A>
<LI><A HREF="#HIREXSR_FIT_LYA">HIREXSR_FIT_LYA</A>
<LI><A HREF="#HIREXSR_FIT_SPECTRA">HIREXSR_FIT_SPECTRA</A>
<LI><A HREF="#HIREXSR_FIT_TJ">HIREXSR_FIT_TJ</A>
<LI><A HREF="#HIREXSR_FIT_WN3">HIREXSR_FIT_WN3</A>
<LI><A HREF="#HIREXSR_FIT_XY">HIREXSR_FIT_XY</A>
<LI><A HREF="#HIREXSR_FIT_ZJK">HIREXSR_FIT_ZJK</A>
<LI><A HREF="#HIREXSR_GET_LINT_PROFILE">HIREXSR_GET_LINT_PROFILE</A>
<LI><A HREF="#HIREXSR_GET_PROFILE">HIREXSR_GET_PROFILE</A>
<LI><A HREF="#HIREXSR_INVERT2TREE">HIREXSR_INVERT2TREE</A>
<LI><A HREF="#HIREXSR_INVERT_DATA">HIREXSR_INVERT_DATA</A>
<LI><A HREF="#HIREXSR_INVERT_MOMENTS">HIREXSR_INVERT_MOMENTS</A>
<LI><A HREF="#HIREXSR_IS2IV">HIREXSR_IS2IV</A>
<LI><A HREF="#HIREXSR_IS_ANALYSIS">HIREXSR_IS_ANALYSIS</A>
<LI><A HREF="#HIREXSR_IS_PLASMA">HIREXSR_IS_PLASMA</A>
<LI><A HREF="#HIREXSR_ITI2IW">HIREXSR_ITI2IW</A>
<LI><A HREF="#HIREXSR_IV2IS">HIREXSR_IV2IS</A>
<LI><A HREF="#HIREXSR_IW2ITI">HIREXSR_IW2ITI</A>
<LI><A HREF="#HIREXSR_LINE_SUBTRACT">HIREXSR_LINE_SUBTRACT</A>
<LI><A HREF="#HIREXSR_LOAD_ANALYSIS_COMMENT">HIREXSR_LOAD_ANALYSIS_COMMENT</A>
<LI><A HREF="#HIREXSR_LOAD_AVESPEC">HIREXSR_LOAD_AVESPEC</A>
<LI><A HREF="#HIREXSR_LOAD_BINNING">HIREXSR_LOAD_BINNING</A>
<LI><A HREF="#HIREXSR_LOAD_BREAK">HIREXSR_LOAD_BREAK</A>
<LI><A HREF="#HIREXSR_LOAD_CALIBFITS">HIREXSR_LOAD_CALIBFITS</A>
<LI><A HREF="#HIREXSR_LOAD_CALIB_INST">HIREXSR_LOAD_CALIB_INST</A>
<LI><A HREF="#HIREXSR_LOAD_CHECK">HIREXSR_LOAD_CHECK</A>
<LI><A HREF="#HIREXSR_LOAD_CONST">HIREXSR_LOAD_CONST</A>
<LI><A HREF="#HIREXSR_LOAD_DETALIGN">HIREXSR_LOAD_DETALIGN</A>
<LI><A HREF="#HIREXSR_LOAD_DT">HIREXSR_LOAD_DT</A>
<LI><A HREF="#HIREXSR_LOAD_ECOEFS">HIREXSR_LOAD_ECOEFS</A>
<LI><A HREF="#HIREXSR_LOAD_ELLIPSE">HIREXSR_LOAD_ELLIPSE</A>
<LI><A HREF="#HIREXSR_LOAD_ETENDUE">HIREXSR_LOAD_ETENDUE</A>
<LI><A HREF="#HIREXSR_LOAD_FITS">HIREXSR_LOAD_FITS</A>
<LI><A HREF="#HIREXSR_LOAD_IMAGE">HIREXSR_LOAD_IMAGE</A>
<LI><A HREF="#HIREXSR_LOAD_INFO">HIREXSR_LOAD_INFO</A>
<LI><A HREF="#HIREXSR_LOAD_INFO2TREE">HIREXSR_LOAD_INFO2TREE</A>
<LI><A HREF="#HIREXSR_LOAD_INST">HIREXSR_LOAD_INST</A>
<LI><A HREF="#HIREXSR_LOAD_INVGOOD">HIREXSR_LOAD_INVGOOD</A>
<LI><A HREF="#HIREXSR_LOAD_LAMBDA">HIREXSR_LOAD_LAMBDA</A>
<LI><A HREF="#HIREXSR_LOAD_LINE_POS">HIREXSR_LOAD_LINE_POS</A>
<LI><A HREF="#HIREXSR_LOAD_LINTPTR">HIREXSR_LOAD_LINTPTR</A>
<LI><A HREF="#HIREXSR_LOAD_MLINTPTR">HIREXSR_LOAD_MLINTPTR</A>
<LI><A HREF="#HIREXSR_LOAD_MOMENTS">HIREXSR_LOAD_MOMENTS</A>
<LI><A HREF="#HIREXSR_LOAD_POS">HIREXSR_LOAD_POS</A>
<LI><A HREF="#HIREXSR_LOAD_PROCONFIG">HIREXSR_LOAD_PROCONFIG</A>
<LI><A HREF="#HIREXSR_LOAD_PROFILE">HIREXSR_LOAD_PROFILE</A>
<LI><A HREF="#HIREXSR_LOAD_RAYTRC">HIREXSR_LOAD_RAYTRC</A>
<LI><A HREF="#HIREXSR_LOAD_RHOGRID">HIREXSR_LOAD_RHOGRID</A>
<LI><A HREF="#HIREXSR_LOAD_TRANS">HIREXSR_LOAD_TRANS</A>
<LI><A HREF="#HIREXSR_LOAD_VOXEL">HIREXSR_LOAD_VOXEL</A>
<LI><A HREF="#HIREXSR_LOAD_WAVELENGTHS">HIREXSR_LOAD_WAVELENGTHS</A>
<LI><A HREF="#HIREXSR_LOAD_WHITE">HIREXSR_LOAD_WHITE</A>
<LI><A HREF="#HIREXSR_MAKE_RHOVEC">HIREXSR_MAKE_RHOVEC</A>
<LI><A HREF="#HIREXSR_MOMENTS_COMPARE">HIREXSR_MOMENTS_COMPARE</A>
<LI><A HREF="#HIREXSR_MOMENT_CONV">HIREXSR_MOMENT_CONV</A>
<LI><A HREF="#HIREXSR_POS2VOXEL">HIREXSR_POS2VOXEL</A>
<LI><A HREF="#HIREXSR_PROFILE_ARR2PTR">HIREXSR_PROFILE_ARR2PTR</A>
<LI><A HREF="#HIREXSR_PROFILE_PTR2ARR">HIREXSR_PROFILE_PTR2ARR</A>
<LI><A HREF="#HIREXSR_PTR_IMAGE">HIREXSR_PTR_IMAGE</A>
<LI><A HREF="#HIREXSR_READ_BETA">HIREXSR_READ_BETA</A>
<LI><A HREF="#HIREXSR_READ_TREEINFO">HIREXSR_READ_TREEINFO</A>
<LI><A HREF="#HIREXSR_REBIN_AFTERKILL">HIREXSR_REBIN_AFTERKILL</A>
<LI><A HREF="#HIREXSR_REMOVE_ANALYSIS">HIREXSR_REMOVE_ANALYSIS</A>
<LI><A HREF="#HIREXSR_RHO_ARR2PTR">HIREXSR_RHO_ARR2PTR</A>
<LI><A HREF="#HIREXSR_RHO_PTR2ARR">HIREXSR_RHO_PTR2ARR</A>
<LI><A HREF="#HIREXSR_RUN_THACO">HIREXSR_RUN_THACO</A>
<LI><A HREF="#HIREXSR_SPEC2MOMENTS">HIREXSR_SPEC2MOMENTS</A>
<LI><A HREF="#HIREXSR_TREE_ACTIONS">HIREXSR_TREE_ACTIONS</A>
<LI><A HREF="#HIREXSR_UPDATE_TREE">HIREXSR_UPDATE_TREE</A>
<LI><A HREF="#HIREXSR_UPDATE_VOXEL">HIREXSR_UPDATE_VOXEL</A>
<LI><A HREF="#HIREXSR_WRITE_ANALYSIS_COMMENT">HIREXSR_WRITE_ANALYSIS_COMMENT</A>
<LI><A HREF="#HIREXSR_WRITE_AVESPEC">HIREXSR_WRITE_AVESPEC</A>
<LI><A HREF="#HIREXSR_WRITE_BINNING">HIREXSR_WRITE_BINNING</A>
<LI><A HREF="#HIREXSR_WRITE_BREAK">HIREXSR_WRITE_BREAK</A>
<LI><A HREF="#HIREXSR_WRITE_CALIBFITS">HIREXSR_WRITE_CALIBFITS</A>
<LI><A HREF="#HIREXSR_WRITE_CALIB_INST">HIREXSR_WRITE_CALIB_INST</A>
<LI><A HREF="#HIREXSR_WRITE_CHECK">HIREXSR_WRITE_CHECK</A>
<LI><A HREF="#HIREXSR_WRITE_DETALIGN">HIREXSR_WRITE_DETALIGN</A>
<LI><A HREF="#HIREXSR_WRITE_ELLIPSE">HIREXSR_WRITE_ELLIPSE</A>
<LI><A HREF="#HIREXSR_WRITE_ETENDUE">HIREXSR_WRITE_ETENDUE</A>
<LI><A HREF="#HIREXSR_WRITE_FITS">HIREXSR_WRITE_FITS</A>
<LI><A HREF="#HIREXSR_WRITE_INST">HIREXSR_WRITE_INST</A>
<LI><A HREF="#HIREXSR_WRITE_LAMBDA">HIREXSR_WRITE_LAMBDA</A>
<LI><A HREF="#HIREXSR_WRITE_MOMENTS">HIREXSR_WRITE_MOMENTS</A>
<LI><A HREF="#HIREXSR_WRITE_MORDER">HIREXSR_WRITE_MORDER</A>
<LI><A HREF="#HIREXSR_WRITE_POS">HIREXSR_WRITE_POS</A>
<LI><A HREF="#HIREXSR_WRITE_PROCONFIG">HIREXSR_WRITE_PROCONFIG</A>
<LI><A HREF="#HIREXSR_WRITE_PROFILE">HIREXSR_WRITE_PROFILE</A>
<LI><A HREF="#HIREXSR_WRITE_TRANS">HIREXSR_WRITE_TRANS</A>
<LI><A HREF="#HIREXSR_WRITE_VOXEL">HIREXSR_WRITE_VOXEL</A>
<LI><A HREF="#HIREXSR_WRITE_WAVELENGTHS">HIREXSR_WRITE_WAVELENGTHS</A>
<LI><A HREF="#HIREXSR_WRITE_WHITE">HIREXSR_WRITE_WHITE</A>
<LI><A HREF="#HIXERSR_LOAD_MOMENTPTR,SHOT,LINE">HIXERSR_LOAD_MOMENTPTR,SHOT,LINE
</A>
<LI><A HREF="#HIXEXSR_VOXEL_ARR2PTR">HIXEXSR_VOXEL_ARR2PTR</A>
<LI><A HREF="#HIXEXSR_VOXEL_PTR2ARR">HIXEXSR_VOXEL_PTR2ARR</A>
<LI><A HREF="#LINLSQ_FIT_ELLIPSE">LINLSQ_FIT_ELLIPSE</A>
<LI><A HREF="#
MULTI_INTERPOL PROJECTS NE_TSC (WITH R_TSC, T_TSC) ONTO THE R_MAJOR, TIMES GRID
">
MULTI_INTERPOL PROJECTS NE_TSC (WITH R_TSC, T_TSC) ONTO THE R_MAJOR, TIMES GRID
</A>
<LI><A HREF="#NONLIN_FIT_ELLIPSE">NONLIN_FIT_ELLIPSE</A>
<LI><A HREF="#OPTIMIZE_BINNING">OPTIMIZE_BINNING</A>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<A NAME="ELLIPSE_XPT">
<H2>ELLIPSE_XPT</H2></A>
<A HREF="#EQ_ELLIPSE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	ELLIPSE_XPT

PURPOSE:
	This function calculates the x values of an ellipse given the y values the parameters of a quadratic curve [a,b,c,d,f,g]
	according to the function a*x^2+2*b*x*y+c*y^2+2*d*x+2*f*y+g=0

CALLING SEQUENCE:
	result=ellipse_xpt(vec,ypt)

INPUTS:
	vec	FLTARR [5] of the quadradic curve coefficients [a,b,c,d,f,g]
	ypt	FLTARR [n] of the y values

OPTIONAL INPUTS:
	noise	FLOAT that is used to add noise to the xpoint (xpt=xpt+noise) using randomn

KEYWORD PARAMETERS:
	/neg uses the negative root to solve the equation

OUTPUTS:
	result	FLTARR [n] of the x values on the ellipse

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_ellipse.pro)</STRONG><P>
<HR>
 
<A NAME="EQ_ELLIPSE">
<H2>EQ_ELLIPSE</H2></A>
<A HREF="#ELLIPSE_XPT">[Previous Routine]</A>
<A HREF="#GAUSSIAN_FITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	EQ_ELLIPSE

PURPOSE:
	This function calculates the x values of an ellipse given the y values
	and the parameters.  A tilted ellipse can be specified.  This is made to work with MPFIT

CALLING SEQUENCE:
	result=EQ_ELLIPSE(y,param)
	
INPUTS:
	y	FLTARR [n_y] of y values
	param	FLTARR [4] or [5] of the parameters (xo,yo,a,b,phi)

OUTPUTS:
	result:	FLTARR [n_y] of the x values of the ellipse

PROCEDURE:
	This function re-organizes the equation (x-xo)^2/a^2+(y-yo)^2/b^2=1 to
	solve for x w/r/t y and the parameters a,b,xo,yo.  For a
	rotated ellipse, the quadradic curve is used

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 1/10
	6/29/12		M.L. Reinke - fixed bug in fitting function when using a titled ellipse

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_ellipse.pro)</STRONG><P>
<HR>
 
<A NAME="GAUSSIAN_FITS">
<H2>GAUSSIAN_FITS</H2></A>
<A HREF="#EQ_ELLIPSE">[Previous Routine]</A>
<A HREF="#HIREXR_WRITE_RAYTRC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	GAUSSIAN_FITS

PURPOSE:
	This function calculates the gaussian line profile for the sum of 
	an arbitrary number of gaussians plus an optional DC offset.  The format
	is made to be used with MPFIT

CALLING_SEQUENCE:
	result=GAUSSIAN_FITS(x,p)

INPUTS:
	x	FLTARR	[n_x] of the points for which to calculate the spectra
	p	FLTARR 	[n_gauss*3+nb] where nb will determine the order of the baseline fit

OUTPUTS:
	result:	FLTARR  [n_x] of the sum of all the gaussians at each point

PROCEDURE:
	Gaussians are specified as a*exp(-(x-b)^2/(2*c^2)).  If the parameter values of p
	are a double precision array, then the result is returned as a double.
	
	IF n_elements(p) MOD 3 = 0 then the last three are assume to be a quadraditc baseline
	IF n_elements(p) MOD 3 = 1 then the last three are assume to be a constant baseline
	IF n_elements(p) MOD 3 = 2 then the last three are assume to be a linear baseline

MOFICATION HISTORY:
	Written by 	A. Ince-Cushman 2007
	1/10		M.L. Reinke - modified to auto detect for DP or SP
	5/13/11		M.L. Reinke - modified to allow for higher order baseline terms in the fits
				      currently hard coded for use with the zjk fits
	4/17/12		M.L. Reinke - noticed that n_elements(p) was called multiple times and 
				      replaced with a single call to be more efficient

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXR_WRITE_RAYTRC">
<H2>HIREXR_WRITE_RAYTRC</H2></A>
<A HREF="#GAUSSIAN_FITS">[Previous Routine]</A>
<A HREF="#HIREXSR_ADDNEW_ANALYSIS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXR_WRITE_RAYTRC

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_ADDNEW_ANALYSIS">
<H2>HIREXSR_ADDNEW_ANALYSIS</H2></A>
<A HREF="#HIREXR_WRITE_RAYTRC">[Previous Routine]</A>
<A HREF="#HIREXSR_AR_EXIST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_ADDNEW_ANALYSIS

PURPOSE:
	This procedure adds a new numbered analysis tree (\SPECTROSCOPY::TOP.HIREXSR.ANALYSIS#)
	for use in parallel runs of THACO

CALLING SEQUENCE
	shot	LONG	shot number

OPTIONAL INPUTS:
	tht	INT	THACO tree number DEFAULT: the next available number

KEYWORD PARAMETERS:
	/force 	this will force an overwrite of a THACO tree that already exists

OPTIONAL OUTPUTS:
	chk	INT	indicating result of process:
			  0 - THT existed andnothing done
			 -1 THT existed and overwritten
			  1 THT did not exist and was added 

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 8/19/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AR_EXIST">
<H2>HIREXSR_AR_EXIST</H2></A>
<A HREF="#HIREXSR_ADDNEW_ANALYSIS">[Previous Routine]</A>
<A HREF="#HIREXSR_AUTOBIN">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AR_EXIST
PURPOSE:
	This procedure checks if the argon signal is high enough to
	justify running analysis codes. Checks how many ms the argon
	is on B_side_lower or H_bottom when it is above a certain
	number of standard devs about the mean

CALLING SEQUENCE
	CHECK = HIREXSR_AR_LOW(shot, time_thres = time_thresh,
	lev_thresh = lev_thresh, volt_thresh=volt_thresh)

INPUTS:
	shot        LONG  shot number
       time_thresh LONG  minimum number of ms for valve to be open (default - 35)
	lev_thresh  LONG  minimum % to continue on (default - 30%)
       volt_thresh LONG  minimum voltage to consider open (default -2)

OUPUTS:
       Returns true(1) or false(0)


MODIFICATION HISTORY:
	Written by: 	Y. Podpaly  12/15/2010]
       Modified YP 12/21/2010 name changed to HIREXSR_AR_EXIST and
       threshold check changed

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_shot_analysis_tools.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AUTOBIN">
<H2>HIREXSR_AUTOBIN</H2></A>
<A HREF="#HIREXSR_AR_EXIST">[Previous Routine]</A>
<A HREF="#HIREXSR_AUTOCHMAP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AUTOBIN

PURPOSE:
	This procedure streamlines making spatially/temporally uniform
	CHMAP and TMAPs and writes them to the tree

MODIFICATION HISOTRY:
	Written by:	M.L. Reinke - 11/2012
       1/14/13		M.L. Reinke - added the tch=-1 and (hardcoded) chmax optional inputs into the
				      HIREXSR_WRITE_BINNING CALL
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AUTOCHMAP">
<H2>HIREXSR_AUTOCHMAP</H2></A>
<A HREF="#HIREXSR_AUTOBIN">[Previous Routine]</A>
<A HREF="#HIREXSR_AUTOTMAP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AUTOCHMAP

PURPOSE:
	This function proceduces a channel map by assuming a fixed number of channels per submodule that evenly
	use the area offset by a given amount from the submodule boundaries.

CALLING SEQUENCE:
	result=HIREXSR_AUTOCHMAP(nsub,noff)
	
INPUTS:
	nsub	INT 	number of channels per sub module
	noff	INT	number of pixels to offset the nsub channels from the submodule boundaries
	
OPTIONAL INPUTS:
	nx	INT	image size in the spatial direction DEFAULT: 3*487
	ny	INT	image size in the spectral direction DEFAULT: 195
	submod	INT	number of total submodules in the spatial direction DEFAULT: 24

OUTPUTS:
	result:	INTARR	[nx,ny] of the chmap to be used in HIREXSR_BIN_SPEC.  Values will be -1 for pixels
			that are not used and 0->chmax for pixels that correspond to various channels

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 4/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AUTOTMAP">
<H2>HIREXSR_AUTOTMAP</H2></A>
<A HREF="#HIREXSR_AUTOCHMAP">[Previous Routine]</A>
<A HREF="#HIREXSR_AUTO_TMAP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AUTOTMAP

PURPOSE:
	This function creates a time binning map by binning together a fixed number of frames 
	for the whole time base.

CALLING SEQUENCE:
	result=HIREXSR_AUTOTMAP(nt,nframe)

INPUTS:
	nt	INT	number of raw images collected
	nframe	INT	number of frames to bin together to form a data frame

OPTIONAL INPUTS:
	tr	FLTARR	[2] of the lower and upper time points to truncate the map to [sec]
	shot	LONG	of the shot number to check the time base for

OUTPUTS:
	result	INTARR	[nt] of the data frame each raw image corresponds to.  This is used
			as an input in HIREXSR_BIN_IMAGE and HIREXSR_BIN_TIME

MODFICIATION HISTORY:
	Written by:	M.L. Reinke 4/10
	4/27/11		M.L. Reinke - added the ability to truncate the autotmap between tr[0] and tr[1] for a given shot

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AUTO_TMAP">
<H2>HIREXSR_AUTO_TMAP</H2></A>
<A HREF="#HIREXSR_AUTOTMAP">[Previous Routine]</A>
<A HREF="#HIREXSR_AVESPEC2TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AUTO_TMAP
PURPOSE:
	This procedure returns a reasonable tmap and good channel
	description. It is an automated first cut approach to this
	process, so it does not do any data analysis. The initial good
	array must be a real one, so that the code can grab a basic
	'channels on' guess. 

CALLING SEQUENCE
	HIREXSR_AUTO_TMAP, shot, tmap, good, time = time, multi=multi

INPUTS:
	shot        LONG  shot number
       tmap        INT[] array for the time maps


OPTIONAL INPUTS:
       time    FLOAT[] 2 element array for beginning and ending time
                       of the shot defaults (0.5-1.7)
       multi   INT     how many adjacent times to bin together
       good    LONG[] array for the good channels MUST be a real
                          good array from a previous shot (default = 1)
       ipthresh FLOAT minimum acceptable current for disruption checking

      
KEYWORD PARAMETERS:
	h	/h will use the default MAX_ALLOWED_CHANNELS=32 rather than 96

OUPUTS:
      
       NONE

LIMITATIONS:
    - Currently requires an initial good channel guess
    - Does NOT handle hydrogen-like module yet

MODIFICATION HISTORY:
	Written by: 	Y. Podpaly  01/10/2011
	1/17/10:	M.L. Reinke - modified data check to use GETNCI to run quicker.  Added the /h keyword
       1/20/11         Y. Podpaly - added disruption check to auto tmap
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_shot_analysis_tools.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AVESPEC2TREE">
<H2>HIREXSR_AVESPEC2TREE</H2></A>
<A HREF="#HIREXSR_AUTO_TMAP">[Previous Routine]</A>
<A HREF="#HIREXSR_AVESPEC_ARR2PTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AVESPEC2TREE

PURPOSE:
	This procedure loads raw HIREXSR images and applies the TMAP and CHMAP
	to form averaged spectra for use in FITSPEC2TREE

CALLING SEQUENCE:
	HIREXSR_AVESPEC2TREE,shot
	
INPUTS:
	shot	LONG	shot number

OPTIONAL INPUTS:
	nave	INT	number of lambda points over which to average DEFAULT: # of chmap[*,0,0] pts
	tht	INT	THACO tree # DEFAULT:0 (just ANALYSIS tree)

KEYWORD PARMATERS:
	h	/h will run the the code for the H-like module rather then for He-like
	double	/double will run the code in double precisions
	debug	/debug stops before the end of the code (and the HEAP cleanup)
	wf	/wf will load white-field stored in tree else wf=1.0 is assumed 

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 11/10
	8/19/11		M.L. Reinke - adapted to use THT optional input and set the default from 20 to read CHMAP
				      added the functionality of writing a logname and systime stamp into a comment node
				      
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AVESPEC_ARR2PTR">
<H2>HIREXSR_AVESPEC_ARR2PTR</H2></A>
<A HREF="#HIREXSR_AVESPEC2TREE">[Previous Routine]</A>
<A HREF="#HIREXSR_AVESPEC_PTR2ARR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AVESPEC_ARR2PTR
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AVESPEC_PTR2ARR">
<H2>HIREXSR_AVESPEC_PTR2ARR</H2></A>
<A HREF="#HIREXSR_AVESPEC_ARR2PTR">[Previous Routine]</A>
<A HREF="#HIREXSR_AVE_SPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AVESPEC_PTR2ARR
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_AVE_SPEC">
<H2>HIREXSR_AVE_SPEC</H2></A>
<A HREF="#HIREXSR_AVESPEC_PTR2ARR">[Previous Routine]</A>
<A HREF="#HIREXSR_BIN_BOUNDS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_AVE_SPEC

PURPOSE:
	This function is used to average raw spectra over a given number of points to increase SNR and reduce
	the number of points prior to the nonlinear gaussian fit.  This increases speed without a reduction in accuracy.

CALLING SEQUENCE:
	result=HIREXSR_AVE_SPEC(spec,nave)
	
INPUTS:
	spec		PTRARR	[chmax,ntime] where each [i,j] is a pointer reference to an [n,4] array (output of HIREXSR_BIN_SPEC)
	nave		INT	number of points to average over

OPTIONAL INPUTS:
	avespec		PTRARR	[chmax,ntime] of a previous call to HIREXSR_AVE_SPEC to be used to update isolated spectra
	fix		INTARR	[chmax,ntime] of 1's or 0's indicating which spectra need to be reaveraged

OUTPUTS:
	result		PTRARR	[chmax,ntime] where each [i,j] is a pointer to an [m,4] array w/ m=n/nave.

OPTIONAL OUTPUTS:
	maxave		INT	of the maximum number of points in any of the [i,j] spectral pointers and
				is used when writing the AVESPEC to the tree

PROCEDURE:
	For each spectra the spectral brightness is averaged, the wavelength is a weighted averaged of the lambda values
	and the noise is added in quadrature and divided by the # of averaging points.  If n/nave is not a whole number then
	the final point will be averaged over a number < nave.  For the best results on future steps where the moments
	are taken using a Newton-Cotes integration it's best to average over the # of rows used to form the spectra which 
	eliminates near degenercy of wavelengths in some regions of the image.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/10
	9/12/10		M.L. Reinke - fixed problem where the uncertainty was being averaged incorrectly
	9/21/10		M.L. Reinke - modifed the lambda weighted average calculation to avoid NaN when zero photons

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_BIN_BOUNDS">
<H2>HIREXSR_BIN_BOUNDS</H2></A>
<A HREF="#HIREXSR_AVE_SPEC">[Previous Routine]</A>
<A HREF="#HIREXSR_BIN_IMAGE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_BIN_BOUNDS

PURPOSE:
	This function calculates the row boundaries of the bins describe by an input channel map

CALLING SEQUENCE:
	result=HIREXSR_BIN_BOUNDS(chmap,chmax)
	
INPUTS:
	chmap	INTARR	[nx,ny,nmaps] where elements specificy the channel number that the pixel belongs to
			Can make it time evolving (nmaps > 1) and make the number of channels change with time
	chmax	INT	max number of channels

OUTPUTS:
	result	INTARR	[2,chmax,nmaps] of the upper [0,*,*] and lower [1,*,*] bounds of a channel

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 4/8/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_BIN_IMAGE">
<H2>HIREXSR_BIN_IMAGE</H2></A>
<A HREF="#HIREXSR_BIN_BOUNDS">[Previous Routine]</A>
<A HREF="#HIREXSR_BIN_INST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_BIN_IMAGE

PURPOSE:
	This function applies time binning to the ptrarr array of raw data, creating a new ptrarr of binned images (data frames)

CALLING SEQUENCE:
	result=HIREXSR_BIN_IMAGE(raw,tmap)

INPUTS:
	raw	PTRARR	[n_time] of pointers to the raw images
	tmap	FLTARR	[n_time] of the data frames

OUTPUTS:
	result	PTRARR	[n_time] of pointers to the binned data frames.  

PROCEDURE:
	Like with HIREXSR_BIN_TIME, the length of the output is a fixed length but the data values will change.
	If there is a valid data frame then *result[i]=FLTARR instead of -1.  Using tmap will be a more efficient
	way to see how many elements of output will be images.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 4/8/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_BIN_INST">
<H2>HIREXSR_BIN_INST</H2></A>
<A HREF="#HIREXSR_BIN_IMAGE">[Previous Routine]</A>
<A HREF="#HIREXSR_BIN_POS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_BIN_INST

PURPOSE:
	This function forms instrumental data based on the CHMAP and DLAM used to form the moments.

CALLING SEQUENCE:
	result=HIREXSR_BIN_INST(inst,dlam,chmap,lambda,chmax)

INPUTS:
	inst		FLTARR	[nx,ny] of the instrumental for each point on the detector
	dlam		FLTARR	[2] of the lower [0] and upper[1] wavelength values used to form the moment
	chmap		INTARR	[nx,ny,nmaps]	that describes the binning used to form the spectra (see HIREXSR_BIN_SPEC)
	chmax		INT	of the maximum number of spatial channels allowed by the software
	lambda		FLTARR	[nx,ny] of the wavelength values at each pixel
;
OUTPUTS:
	result		FLTARR	[chmax,nmaps] of the inst vector for each channel.  If no pixels selected for a channel
				then [i,j] is filled with -1

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 9/4/11 (adapted from HIREXSR_BIN_POS)

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_BIN_POS">
<H2>HIREXSR_BIN_POS</H2></A>
<A HREF="#HIREXSR_BIN_INST">[Previous Routine]</A>
<A HREF="#HIREXSR_BIN_SPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_BIN_POS

PURPOSE:
	This function forms POS vectors based on the CHMAP and DLAM used to form the moments.
	It can also bin the etendue as well.

CALLING SEQUENCE:
	result=HIREXSR_BIN_POS(pos,dlam,chmap,lambda,chmax)

INPUTS:
	pos		FLTARR	[4,nx,ny] of the POS vector for each point on the detector
	dlam		FLTARR	[2] of the lower [0] and upper[1] wavelength values used to form the moment
	chmap		INTARR	[nx,ny,nmaps]	that describes the binning used to form the spectra (see HIREXSR_BIN_SPEC)
	chmax		INT	of the maximum number of spatial channels allowed by the software
	lambda		FLTARR	[nx,ny] of the wavelength values at each pixel

OPTIONAL INPUTS:
	u		FLTARR	[nx,ny,nmaps] of the etendue values at each pixel
	const		FLTARR	[nx,ny] of the calibration constant to turn #photons into brightness

OUTPUTS:
	result		FLTARR	[4,chmax,nmaps] of the POS vector for each channel.  If no pixels selected for a channel
				then [*,i,j] is filled with -1

OPTIONAL OUTPUTS:
	newu		FLTARR	[chmax,nmaps] of the etendue values for each each channel.  If no pixels selected for that
				channel then [i,j]=-1
	newc		FLTARR 	[chmax,nmaps] of the constant brightness constant (used to recover #photons from brightness)

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 8/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_BIN_SPEC">
<H2>HIREXSR_BIN_SPEC</H2></A>
<A HREF="#HIREXSR_BIN_POS">[Previous Routine]</A>
<A HREF="#HIREXSR_BIN_TIME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_BIN_SPEC

PURPOSE:
	This function takes a set of data frames and uses a channel mapping to create a set of
	(cnts,lambda) points that define a spectral channel.

CALLING SEQUENCE
	result=HIREXSR_BIN_SPEC(cnts,tau,chmap,tch,lambda)
	
INPUTS:
	cnts	PTRARR	[n_time] where each element calls a FLTARR [nx,ny] or a -1 (output of HIREXSR_BIN_IMAGE)
	tau	FLTARR	[n_time] where each element is a time point or -1 (output of HIREXSR_BIN_TIME)
	chmap	INTARR	[nx,ny,nmaps] where elements specificy the channel number that the pixel belongs to
			Can make it time evolving (nmaps > 1) and make the number of channels change with time
	tch	FLTARR	[nmaps] of the time points of when to change the chmap
	lambda	FLTARR	[nx,ny] of the wavelength values for each pixel
	tmap	INTARR	[n_time] indicating which frames are included in each time point

OPTIONAL INPUTS:
	nchbins	INT	max number of of channels DEFAULT: 96	
	const	FLTARR	[nx,ny] of the multiplicative constant to turn data from counts to spectral brightness [ph/s/m^2/Ang]

OUTPUTS:
	result:	PTRARR	[nchbins,n_time] of pointers to the FLTARR [npts,3] or -1 values that define the (specbr,lambda,sigma) data for each
			channel at each point in time.  Both specbr and sigma are in units of [ph/s/m^2/Ang] if the optional input CONST is used properly.
	
PROCEDURE:
	As with other binning programs, the size of the pointer array is fixed at some maxium number of space and time points.
	Where there is no data for that channel there will be -1 value.  The time-evolving channel mapping allows for each time point
	to have a variable number of channels and each channel to be made up of a variable number of pixels.

	The sigma is simply the sqrt(cnts)*const.  Doing it explicitely saves time when browsing through the data in the widget.  Also
	when HIREXSR_AVE_SPEC is used, it won't be that sigma = sqrt(cnts).

MODFICATION HISTORY:
	Written by:	M.L. Reinke 4/10
	4/9/10		M.L. Reinke - make each ptr [npts,3] with [*,2]=uncertainty
	8/9/10		M.L. Reinke - added the use of the CONST optional input
	3/30/11		M.L. Reinke - added the use of TMAP input to adjust spectra brightness when binning
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_BIN_TIME">
<H2>HIREXSR_BIN_TIME</H2></A>
<A HREF="#HIREXSR_BIN_SPEC">[Previous Routine]</A>
<A HREF="#HIREXSR_CALC_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_BIN_TIME

PURPOSE:
	This function calculates a new time base given a mapping of collected frames to data frames

CALLING SEQUENCE:
	result=HIREXSR_BIN_TIME(t,tmap)

INPUTS:
	t	FLTARR	[n_time] of the time points at which the raw images were collected
	tmap	INTARR	[n_time] of what data frame to assign each raw image to (-1 if frame is not to be used)

OUTPUTS:
	result:	FLTARR 	[n_time] of the time values of the data frames.

PROCEDURE:
	If there is any binning specified by TMAP [tmap NE indgen(n_time)] then values of the output (tau) will be equal to -1.
	This allows the values of tau to be modified to reflect dynamic binning adjustments w/o modifying the size of the array.
	You can find the number of data bins by using the length of where(tau NE -1).

MODIFICATION HISTORY:
	Written by:	ML Reinke 4/7/10
		
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CALC_DATA">
<H2>HIREXSR_CALC_DATA</H2></A>
<A HREF="#HIREXSR_BIN_TIME">[Previous Routine]</A>
<A HREF="#HIREXSR_CALC_MOMENTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CALC_DATA

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CALC_MOMENTS">
<H2>HIREXSR_CALC_MOMENTS</H2></A>
<A HREF="#HIREXSR_CALC_DATA">[Previous Routine]</A>
<A HREF="#HIREXSR_CALC_PROFILES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CALC_MOMENTS

PURPOSE:
	This is a lower level function with calculates the spectral moments and their uncertainties from
	the spectral brightness and wavelength data.  This should be run on the output of HIREXSR_LINE_SUBTRACT.

CALLING SEQUENCE:
	HIREXSR_CALC_MOMENTS,specbr,lam,lam_o,sig,mom,err,scale,bfrac

INPUTS:
	specbr	FLTARR	[n] of spectral brightness data 
	lam	FLTARR	[n] of the wavelength values
	lam_o	FLOAT	wavelength about which to take the 1st and 2nd moments (rest wavelength)
	sig	FLTARR	[n] of the uncertainties in the spectral brightness

KEYWORD PARAMETERS:
	/double 	is linked through to INT_TABULATED and will force the output to be DBLARR [3] instead of FLTARR [3]
	/trap_int	uses the function TRAP_INT to perform the numerical integration
	/gauss		uses the GAUSSFIT function (nterms=4) to fit line and calculate the moments
	/mpfit		uses MPFIT (constrained, a[0] and a[4] > 0)  to fit line and calculate the moments

OUTPUTS:
	mom	FLTARR	[3] of the 0th, 1st and 2nd moments
	err	FLTARR	[3] of the uncertainty in those moments
	pmom	FLTARR	[3] of the #phot, mu and w^2 of the distribution
	perr	FLTARR	[3] of the uncertainty in those values (via Hutch)
	scale	FLT	of the constant between MOM[0] and PMOM[0] w/o background removed
	bfrac	FLT	fraction of the # of background photons to background+signal photons		

OPTIONAL OUTPUTS:
	afit	FLTARR 	[4] of the single guassian + DC offset fitting parameters if /gauss or /mpfit is used
	asig	FLTARR 	[4] of the uncertainties in the afit parameters

PROCEDURE:
	The methods for calculating the moments and errors are detailed in the XCIS equations paper.
	
	The various mathematical techniques have their benifits and drawbacks.  In an exact sense, the numerical moment
	from INT_TABULATED or TRAP_INT is correct moment since the instrument function and line-integral make the
	spectral line non-gaussian.  But, at low signal-to-background, the noise associated with taking moments
	dramatically increases making the data useless.  Thus the best thing to do would be do estimate using 
	HIREXSR_MOMENTS_COMPARE to see for a given width and number of #photons where the cutoff is.  Then feedback on this
	in HIREXSR_SPEC2MOMENTS.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 7/10
	9/14/10		M.L. Reinke - finally got the better moment/error calculation equations impliments
	12/7/10		M.L. Reinke - large overhaul to include multiple techniques to find the mom, err, pmom and perr
	12/8/10		M.L. Reinke - fixed the INT_TAB and TRAP_INT methods of calculating moment error.  1st moment error looks reasonable now
				      added, the afit and asig optional output
	12/9/10		M.L. Reinke - fixed a bug when using GAUSSFIT or MPFIT to find the moments that caused a crash when sig=0
	1/5/11		M.L. Reinke - fixed a case where a crash would occur if median(sig)=0.  This case is not treated like total(specbr)=0,
				      and thrown out as a bad frame
	5/13/11		M.L. Reinke - adjusted the MPFIT and GAUSSFIT options to remove the baseline (should be removed by HIREXSR_LINE_SUBTRACT)
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_moments.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CALC_PROFILES">
<H2>HIREXSR_CALC_PROFILES</H2></A>
<A HREF="#HIREXSR_CALC_MOMENTS">[Previous Routine]</A>
<A HREF="#HIREXSR_CALC_RESID">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CALC_PROFILES

MODIFICATION HISTORY:
	9/4/11		M.L. Reinke - added the ability to use the iwidth,ishift terms in the moment pointer and store the subcheck
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_profiles.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CALC_RESID">
<H2>HIREXSR_CALC_RESID</H2></A>
<A HREF="#HIREXSR_CALC_PROFILES">[Previous Routine]</A>
<A HREF="#HIREXSR_CALC_RHOTANG">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CALC_RESID

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CALC_RHOTANG">
<H2>HIREXSR_CALC_RHOTANG</H2></A>
<A HREF="#HIREXSR_CALC_RESID">[Previous Routine]</A>
<A HREF="#HIREXSR_CHANGE_CRYSTAL_BETA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CALC_RHOTANG

PURPOSE:
	This function calculates the rho of closests approach for an array of POS vectors
	which can be used for plotting line-integrated moments/fit coefficients.  This uses
	EFIT_RZ2RHO which outputs "rho" as normalized poloidal flux.

CALLING SEQUENCE:
	result=HIREXSR_CALC_RHOTANG(shot,pos,tpos,tau)

OPTIONAL INPUTS:
	tree:		STRING	of the EFIT tree to use for calculating tangency radii [DEFAULT: 'analysis']

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 9/24/10
	6-13-11:	ML Reinke - added the tree optional input for use with EFIT_RZ2XXX codes in GENPOS_POS2RMIDTANG

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_moments.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CHANGE_CRYSTAL_BETA">
<H2>HIREXSR_CHANGE_CRYSTAL_BETA</H2></A>
<A HREF="#HIREXSR_CALC_RHOTANG">[Previous Routine]</A>
<A HREF="#HIREXSR_CHANGE_CRYSTAL_DECL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CHANGE_CRYSTAL_BETA

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CHANGE_CRYSTAL_DECL">
<H2>HIREXSR_CHANGE_CRYSTAL_DECL</H2></A>
<A HREF="#HIREXSR_CHANGE_CRYSTAL_BETA">[Previous Routine]</A>
<A HREF="#HIREXSR_CHECK_ANALYSIS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CHANGE_CRYSTAL_DECL

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CHECK_ANALYSIS">
<H2>HIREXSR_CHECK_ANALYSIS</H2></A>
<A HREF="#HIREXSR_CHANGE_CRYSTAL_DECL">[Previous Routine]</A>
<A HREF="#HIREXSR_CHECK_CALIB">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CHECK_ANALYSIS

PURPOSE:
	This procedure checks and sees what THACO ANALYSIS# nodes
	have been populated, by whom, when and for what purpose

CALLING SEQUENCE:
	HIREXSR_CHECK_ANALYSIS,shot,user,time,note
	
INPUTS:
	shot	LONG	shot number

OPTIONAL INPUTS:
	max	INT	maximum THACHO# to check DEFAULT: 10

KEYWORD PARAMETERS:
	quiet	/quiet will supress COMMENT node data being printed to the terminal

OUTPUTS:
	user	STRARR	[max+2] of the username of the author
	time	STRARR	[max+2] of the systime() stamp when the analysis was done
	note	STRARR	[max+2] of note input by the author (quality, purpose...etc)
	thts	INTARR	[max+2] of the tht#	

OPTIONAL OUTPUTS:
	tstatus	INTARR	[max+1] indicating the existance of a tree at THACO#

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 8/19/11
	M.L. Reinke	11/19/2012 - added the automatic check of THT=99 (real-time) and included thts ooutputs

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CHECK_CALIB">
<H2>HIREXSR_CHECK_CALIB</H2></A>
<A HREF="#HIREXSR_CHECK_ANALYSIS">[Previous Routine]</A>
<A HREF="#HIREXSR_CHECK_SIZE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CHECK_CALIB

PURPOSE:
	This procedure looks into the tree to see what shot/times the
	wavelength/spatial calibration was based on for the given shot

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 11/19/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CHECK_SIZE">
<H2>HIREXSR_CHECK_SIZE</H2></A>
<A HREF="#HIREXSR_CHECK_CALIB">[Previous Routine]</A>
<A HREF="#HIREXSR_CLONE_ANALYSIS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
 HIREXSR_CHECK_SIZE
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_shot_analysis_tools.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CLONE_ANALYSIS">
<H2>HIREXSR_CLONE_ANALYSIS</H2></A>
<A HREF="#HIREXSR_CHECK_SIZE">[Previous Routine]</A>
<A HREF="#HIREXSR_COEFS2LAM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CLONE_ANALYSIS
	
PURPOSE:
	This function will clone an analysis run from an existing THACO# and copy
	(for a given line) the analysis to a new THACO#

CALLING SEQUENCE:
	result=HIREXSR_CLONE_ANALYSIS(shot,line,thta,thtb)

INPUTS:
	shot	LONG	shot number
	line	INT	line # for the analysis	
	thta	INT	THACO# to copy analysis from
	thtb	INT	THACO# to copy analysis to - set to an unassigned variable chose the next available#

KEYWORD PARAMETERS:
	nobin	/nobin does not copy any of the binning and AVESPEC
	nomom	/nomom does not copy any of the fitting/moment results
	nopro	/nopro does not copy any of the inversion results
	quiet	/quiet supresses text updates to the terminal
	force	/force will force delete an existing THACO# node and rewrite with new data

OUTPUTS:
	result	INT 	indicating the result of the analysis
			-2 : invalid THACO# to copy from (thta)
			-1 : THACO# to copy to (thtb) already exists
			 1 : copy of thta -> thtb completed

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 8/19/11
	11/20/12	M.L. Reinke - added /nobin and moved fitting  to be specified by /nomom

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COEFS2LAM">
<H2>HIREXSR_COEFS2LAM</H2></A>
<A HREF="#HIREXSR_CLONE_ANALYSIS">[Previous Routine]</A>
<A HREF="#HIREXSR_COEFS_ARR2PTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COEFS2LAM

PURPOSE:
	This function takes the elliptic curve coefficients and line centers and generates
	a 2D map of wavelength values

CALLING SEQUENCE:
	result=HIREXSR_COEFS2LAM(coefs,lam_o)

INPUTS:
	coefs:	FLTARR	[5,n_lines] of the elliptic curve coefficients
	lam_o:	FLTARR	[n_lines] of the line centers 

OPTIONAL INPUTS:
	order:	INT	order of the polynomial fit to calculate wavelength over the row DEFAULT: 1
	nx:	INT	number of pixels in the non-wavelenth direction DEFAULT: 487
	ny:	INT	number of pixesl in the wavelength direction DEFAULT: 195

KEYWORD PARAMETERS:
	plot:	/plot will plot the results of the polynomial fit
	debug:	/debug will stop the code before the RETURN

OUTPUS:
	result:	FLTARR 	[nx,ny] of the wavelength values at each pixel [units of lam_o]

PROCEDURE:
	This uses the data loaded from HIREXSR_LOAD_COEFS and the function EQ_ELLIPSE
	to generate the data.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 3/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COEFS_ARR2PTR">
<H2>HIREXSR_COEFS_ARR2PTR</H2></A>
<A HREF="#HIREXSR_COEFS2LAM">[Previous Routine]</A>
<A HREF="#HIREXSR_COEFS_PTR2ARR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COEFS_ARR2PTR
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COEFS_PTR2ARR">
<H2>HIREXSR_COEFS_PTR2ARR</H2></A>
<A HREF="#HIREXSR_COEFS_ARR2PTR">[Previous Routine]</A>
<A HREF="#HIREXSR_CONSTRAINED_INFO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COEFS_PTR2ARR
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_CONSTRAINED_INFO">
<H2>HIREXSR_CONSTRAINED_INFO</H2></A>
<A HREF="#HIREXSR_COEFS_PTR2ARR">[Previous Routine]</A>
<A HREF="#HIREXSR_COPY_BINNING">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_CONSTRAINED_INFO

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COPY_BINNING">
<H2>HIREXSR_COPY_BINNING</H2></A>
<A HREF="#HIREXSR_CONSTRAINED_INFO">[Previous Routine]</A>
<A HREF="#HIREXSR_COPY_CALIB">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COPY_BINNING

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COPY_CALIB">
<H2>HIREXSR_COPY_CALIB</H2></A>
<A HREF="#HIREXSR_COPY_BINNING">[Previous Routine]</A>
<A HREF="#HIREXSR_COPY_COMMENT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COPY_CALIB
	
MODIFICATION HISTORY:
	9/4/11		M.L. Reinke - added INST to be copied from target shot if available

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COPY_COMMENT">
<H2>HIREXSR_COPY_COMMENT</H2></A>
<A HREF="#HIREXSR_COPY_CALIB">[Previous Routine]</A>
<A HREF="#HIREXSR_COPY_INFO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COPY_COMMENT

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COPY_INFO">
<H2>HIREXSR_COPY_INFO</H2></A>
<A HREF="#HIREXSR_COPY_COMMENT">[Previous Routine]</A>
<A HREF="#HIREXSR_COPY_SETUP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COPY_INFO

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_COPY_SETUP">
<H2>HIREXSR_COPY_SETUP</H2></A>
<A HREF="#HIREXSR_COPY_INFO">[Previous Routine]</A>
<A HREF="#HIREXSR_EXTRACT_CHECK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_COPY_SETUP

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_EXTRACT_CHECK">
<H2>HIREXSR_EXTRACT_CHECK</H2></A>
<A HREF="#HIREXSR_COPY_SETUP">[Previous Routine]</A>
<A HREF="#HIREXSR_FILL_RESID">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_EXTRACT_CHECK

MODIFICATION HISTORY:
	9/4/11		M.L. Reinke - added ability to extract the subcheck data from the moment ptr
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FILL_RESID">
<H2>HIREXSR_FILL_RESID</H2></A>
<A HREF="#HIREXSR_EXTRACT_CHECK">[Previous Routine]</A>
<A HREF="#HIREXSR_FIND_DEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FILL_RESID

PURPOSE:
	This is a higher level function which fills in the residual in the spec PTRARR once all the fits are completed.

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIND_DEC">
<H2>HIREXSR_FIND_DEC</H2></A>
<A HREF="#HIREXSR_FILL_RESID">[Previous Routine]</A>
<A HREF="#HIREXSR_FITSPEC2TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
 HIREXSR_FIND_DEC
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_shot_analysis_tools.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FITSPEC2TREE">
<H2>HIREXSR_FITSPEC2TREE</H2></A>
<A HREF="#HIREXSR_FIND_DEC">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_CA_WN3">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FITSPEC2TREE

PURPOSE:
	This procedure runs the spectral fitting codes to remove neighboring lines
	and then calculates the moment profiles to be used in the inversions

CALLING SEQUENCE:
	HIREXSR_FITSPEC2TREE,shot,line

INPUTS:
	shot	LONG	shot number
	line	INT	line # for the analysis 0->6 are Ar w,x,z,lya1,Mo 4d, Ar J, Ca w

OPTIONAL INPUTS:
	nback	INT	0,1,2 of the order of the polynomial to use in fitting the background (currently only works for line=2)
	tree	STRING	of the EFIT tree to use for calculating the tangency radii DEFAULT: 'ANALYSIS'
	tht	INT	of the THACO tree # DEFAULT:0 (just \SPECTROSCOPY::TOP.HIREXSR.ANALYSIS)

KEYWORD PARAMETERS:
	nofit	/nofit will skip the HIREXSR_FIT_SPECTRA step and load from tree (assuming it's been done before)
		in order to save time when recalculating moments or POS vectors
	verb	/verb will be sent to HIREXSR_FIT_SPECTRA
	debug	/debug stops before the end of the code (and the HEAP cleanup)

MODIFICATION HISTORY:	
	Written by:	M.L. Reinke - 11/10
	8/19/11		M.L. Reinke - adapted to use THT optional input
	8/25/12		M.L. Reinke - adjusted CASE statement selection of h & z, added line=7-9 for high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_CA_WN3">
<H2>HIREXSR_FIT_CA_WN3</H2></A>
<A HREF="#HIREXSR_FITSPEC2TREE">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_H">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_CA_WN3

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_H">
<H2>HIREXSR_FIT_H</H2></A>
<A HREF="#HIREXSR_FIT_CA_WN3">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_HE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_H

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_HE">
<H2>HIREXSR_FIT_HE</H2></A>
<A HREF="#HIREXSR_FIT_H">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_HE_CA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_HE

PURPOSE:
	This function is used to perform multigaussian fitting for the He-like Ar spectra in pixel space for use with W_HIREXSR_CALIB

CALLING SEQUENCE:
	result=HIREXSR_FIT_HE(spec)

MODFICATION HISTORY
	Written by	M.L. Reinke (adapted from HE_RAW by A. Ince-Cushman) - 2/10
	9/9/10		M.L. Reinke - modified to have break on as a default and use a break vector
	12/17/10	M.L. Reinke - added the j satellite to the fit, fully constrained by the k fit, added another high-n w satellite constrained by n=4,n=3

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_HE_CA">
<H2>HIREXSR_FIT_HE_CA</H2></A>
<A HREF="#HIREXSR_FIT_HE">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_H_CA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_HE_CA

PURPOSE:
	This function is used to perform multigaussian fitting for the He-like Ca spectra in pixel space for use with W_HIREXSR_CALIB

CALLING SEQUENCE:
	result=HIREXSR_FIT_HE_CA(spec)

MODFICATION HISTORY
	Written by	Y. Podpaly (adapted from HIREXSR_FIT_HE) - 8/10
	9/16/10		M.L. Reinke - increased range to 9 pixels	
	1/14/10		M.L. Reinke - tweaked the the /focus fitting parameters based on data from 1101014
	12/3/12		M.L. Reinke - changed name to HE_CA to allow for H_CA naming scheme
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_H_CA">
<H2>HIREXSR_FIT_H_CA</H2></A>
<A HREF="#HIREXSR_FIT_HE_CA">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_IMAGE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_H_CA

PURPOSE:
	This function is used to perform multigaussian fitting for the H-like Ca spectra in pixel space for use with W_HIREXSR_CALIB

CALLING SEQUENCE:
	result=HIREXSR_FIT_H_CA(spec)

MODFICATION HISTORY
	Written by	M.L. Reinke  (adapted from HIREXSR_FIT_HE_CA) - 12/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_IMAGE">
<H2>HIREXSR_FIT_IMAGE</H2></A>
<A HREF="#HIREXSR_FIT_H_CA">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_LYA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_IMAGE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_LYA">
<H2>HIREXSR_FIT_LYA</H2></A>
<A HREF="#HIREXSR_FIT_IMAGE">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_SPECTRA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_LYA

PURPOSE:
	This function performs a multi-gaussian fit on the H-like Ar Lyman-a spectrum.  Currently
	this is done using a 7 gaussian fit for the Lya1, Lya2, Mo4d and 4 satellite "groups".

CALLING SEQUENCE:
	result=HIREXSR_FIT_LYA(spec,lam)

INPUTS:
	spec	FLTARR [n] of the spectral brightness at each wavelength
	lam	FLTARR [n] of the wavelengths [Angstroms]

OPTIONAL INPUTS:
	sig	FLTARR [n] of the uncertainty in the spec data DEFAULT: sqrt(spec)
	limit	FLOAT	of a lower limit on the signal or signal to noise ratio required to proceed with fitting DEFAULT: 0
	win	INT	of the window number to plot the estimate and fit+residual DEFAULT: (no plot)

KEYWORD PARAMETERS:
	/verb sets verbose mode and outputs messages to the terminal

OUTPUTS:
	result	FLTARR	[3*nlines+1] of the gaussian fit coefficients a*exp(-(x-b)^2/(2*c^2)) along with the baseline as the last element

OPTIONAL OUTPUTS:
	label	STRARR 	[nlines] of the line labels for the corresponding fit coefficients
	

PROCEDURE:
	This function calls GAUSSIAN_FITS using MPFITFUN to perfom the fit.
	Rest wavelengths are called using HIREXSR_LOAD_WAVELENGTHS
	The following restrictions are used to constrain the fit
		- all intensities are >= 0
		- the #1, #2 and #3 satellites are tied to the lya2 line
		- the #4 satellite is restricted to 1 mA shift from the seeded position (based on a shifted lya1)
		- widths of lya1 and lya2 lines are restricted to 0.5 -> 1.25 the seeded width of the lya1
		- widths of satellite lines are restricted to 0.5 -> 1.5 the seeded width of the lya1
		- width of the mo4d line is restricted to 0.2 -> 0.9 of the seeded lya1
		- if Mo 4d line is brighter than Ar lya1 then lya2 position is restricted

	Two checks are made to ensure proper signal and seeding before MPFITFUN is called.
		1a) if limit is > 0 then total(spec-mean(spec)) > limit
		1b) if limit is < 0 and sig is given then max(spec/sig) < |limit|
		2) the seed lambda for the lya1-line must be such that velocity < 350 km/s 

	If 1a or 1b is not satisfied result=-2 is return and if 2 is not satisfied then result=-3 is returned.

MODIFICATION HISTORY;
	Written by	M.L. Reinke (adapted from HIREXSR_FIT_WN3) 8/18/10
	8/30/10		M.L. Reinke - added the n_lines optional output so that HIREXSR_FIT_SPECTRA can form a valid baseline only coefs vector
	6/14/11		M.L. Reinke - added a conditional statement that constrains Lya2 when Mo line is bright and reduced max Lya1,2 width to 1.25*seed
					subtraced baseline from seeding heights, and reduced seed and limit of Mo line width.
	9/2/11		M.L. Reinke - increased the height of lyas2 and tied lyas1 to the lya2 position
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_SPECTRA">
<H2>HIREXSR_FIT_SPECTRA</H2></A>
<A HREF="#HIREXSR_FIT_LYA">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_TJ">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_SPECTRA

PURPOSE:
	This is a higher level function which performs the multigaussian fits on a spec or avespec PTRARR
	
CALLING SEQUENCE:
	result=HIREXSR_FIT_SPECTRA(spec)

INPUTS:
	spec	PTRARR	[chmax,ntime] of pointers to the spectral data (see HIREXSR_AVESPEC_ARR2PTR)
	line	INT	of the index to the line of interest (0 - w, 1 - x, 2 - z, 3 - lya1, 4 - mo4d, 5 -J)

OPTIONAL INPUTS:
	limit	FLOAT	value sent to HIREXSR_FIT_###
	wl	FLTARR	[2] of the wavelength bounds over which to perform fit (see PROCEDURE for DEFAULTS)
	fits	PTRARR	[chmanx,ntime] of the previous call to HIREXSR_FIT_SPECTRA.  To be used to update fits.
	fix	INTARR	[chmax,ntime] of 1's (yes) or 0's (no) whether to perform the fit.  This can be used to save time after rebinning a few channels.
	nback	INT	of the polynomial order for the background [DEFAULT: 0] (currently only linked into ZJK fitting) 

KEYWORD PARAMETERS:
	/plot sends a win=1 do the HIREXSR_FIT_### program to display plots
	/verb and /double are sent to HIREXSR_FIT_###

OUTPUTS:
	result	PTRARR	[chmax,ntime] where if a spectra exists the then [i,j] pointer is filled with the output of HIREXSR_FIT_###
			If ispec[0]=-1 THEN [i,j] is set to -1 if no spectra exists.
	
OPTIONAL OUTPUTS:
	label 	STRARR 	[nlines] of the line labels for the corresponding fit coefficients
	using /resid will fill in the residual after a successful fit in the [*,3] elements of the spec PTRARR

PROCEDURE:
	The DEFAULTS for the wl and limit are set seperately for each line
		line = 0	'w'	wl=[3.944,3.9607]	limit=-3.0
		line = 1	'x'	wl=[3.960,3.9760]	limit=-3.0
		line = 2	'z'	wl=[3.977,4.0000]	limit=-3.0
		line = 3	'lya1'	wl=[3.725,4.747]	limit=-3.0
		line = 4	'mo4d'	wl=[3.725,3.747]	limit=-3.0
		line = 5	'J'	wl=[3.725,3.747]	limit=-3.0
		line = 6	'w'(Ca)	wl=[3.170,3.185]	limit=-3.0
		line = 7	'lya1'	wl=[3.725,4.747] 	limit=-3.0	(high-Te layout)
		line = 8	'mo4d'	wl=[3.725,3.747]	limit=-3.0	(high-Te layout)

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 7/10
	8/18/10		M.L. Reinke - added the ability to work on H-like lines (line=3,4)
	8/27/10		M.L. Reinke - modified the filling of label to do it only once after a successful fit
	8/30/10		M.L. Reinke - on the failure of a fit for too few photons, COEFS is filled with the baseline offset
	9/14/10		M.L. Reinke - increased all SNR failures to -3.0 after revising the AVESPEC uncertainty calculation
	5/13/11		M.L. Reinke - added the nback optional input for use in HIREXSR_FIT_XXX
	8/25/12		M.L. Reinke - added line=7 and line=8 for the high-Te layout	

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_TJ">
<H2>HIREXSR_FIT_TJ</H2></A>
<A HREF="#HIREXSR_FIT_SPECTRA">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_WN3">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_TJ

PURPOSE:
	This function performs a multi-gaussian fit on the H-like Ar TJ satellite spectrum.  Currently
	this is done using a 7 gaussian fit for the multiple satellite lines

CALLING SEQUENCE:
	result=HIREXSR_FIT_TJ(spec,lam)

INPUTS:
	spec	FLTARR [n] of the spectral brightness at each wavelength
	lam	FLTARR [n] of the wavelengths [Angstroms]

OPTIONAL INPUTS:
	sig	FLTARR [n] of the uncertainty in the spec data DEFAULT: sqrt(spec)
	limit	FLOAT	of a lower limit on the signal or signal to noise ratio required to proceed with fitting DEFAULT: 0
	win	INT	of the window number to plot the estimate and fit+residual DEFAULT: (no plot)

KEYWORD PARAMETERS:
	/verb sets verbose mode and outputs messages to the terminal

OUTPUTS:
	result	FLTARR	[3*nlines+1] of the gaussian fit coefficients a*exp(-(x-b)^2/(2*c^2)) along with the baseline as the last element

OPTIONAL OUTPUTS:
	label	STRARR 	[nlines] of the line labels for the corresponding fit coefficients
	

PROCEDURE:
	This function calls GAUSSIAN_FITS using MPFITFUN to perfom the fit.
	Rest wavelengths are called using HIREXSR_LOAD_WAVELENGTHS
	The following restrictions are used to constrain the fit
		- all intensities are >= 0

	Two checks are made to ensure proper signal and seeding before MPFITFUN is called.
		1a) if limit is > 0 then total(spec-mean(spec)) > limit
		1b) if limit is < 0 and sig is given then max(spec/sig) < |limit|
		2) the seed lambda for the lya1-line must be such that velocity < 350 km/s 

	If 1a or 1b is not satisfied result=-2 is return and if 2 is not satisfied then result=-3 is returned.

MODIFICATION HISTORY;
	Written by	M.L. Reinke (adapted from HIREXSR_FIT_LYA) 8/9/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_WN3">
<H2>HIREXSR_FIT_WN3</H2></A>
<A HREF="#HIREXSR_FIT_TJ">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_XY">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_WN3

PURPOSE:
	This function performs a multi-gaussian fit on the He-like Ar w n>=3 spectrum.  Currently
	this is done using a 3 gaussian fit for the w and n=3 and n=4 satellite lines.

CALLING SEQUENCE:
	result=HIREXSR_FIT_WN3(spec,lam)

INPUTS:
	spec	FLTARR [n] of the spectral brightness at each wavelength
	lam	FLTARR [n] of the wavelengths [Angstroms]

OPTIONAL INPUTS:
	sig	FLTARR [n] of the uncertainty in the spec data DEFAULT: sqrt(spec)
	limit	FLOAT	of a lower limit on the signal or signal to noise ratio required to proceed with fitting DEFAULT: 0
	win	INT	of the window number to plot the estimate and fit+residual DEFAULT: (no plot)

KEYWORD PARAMETERS:
	/verb sets verbose mode and outputs messages to the terminal

OUTPUTS:
	result	FLTARR	[3*nlines+1] of the gaussian fit coefficients a*exp(-(x-b)^2/(2*c^2)) along with the baseline as the last element

OPTIONAL OUTPUTS:
	label	STRARR 	[nlines] of the line labels for the corresponding fit coefficients
	

PROCEDURE:
	This function calls GAUSSIAN_FITS using MPFITFUN to perfom the fit.
	Rest wavelengths are called using HIREXSR_LOAD_WAVELENGTHS
	The following restrictions are used to constrain the fit
		- all intensities are >= 0
		- widths of all lines are restricted to 0.5 -> 1.5 the seeded width of the w-line

	Two checks are made to ensure proper signal and seeding before MPFITFUN is called.
		1a) if limit is > 0 then total(spec-mean(spec)) > limit
		1b) if limit is < 0 and sig is given then max(spec/sig) < |limit|
		2) the seed lambda for the w-line must be such that velocity < 350 km/s 

	If 1a or 1b is not satisfied result=-2 is return and if 2 is not satisfied then result=-3 is returned.

MODIFICATION HISTORY;
	Written by	M.L. Reinke (adapted from HIREXSR_FIT_HE) 3/10
	8/10		M.L. Reinke - added the SNR check before fitting
	8/27/10		M.L. Reinke - modifided the SNR limit check to look only around the w-line and do a basline subtraction
	8/30/10		M.L. Reinke - added the n_lines optional output so that HIREXSR_FIT_SPECTRA can form a valid baseline only coefs vector
	9/14/10		M.L. Reinke - added a RETURN=-4 if trying to seed off the edge of the spectral region
	12/17/10	M.L. Reinke - added the n=5 line to the fit, and changed the n=4,n=3 constraints on the fit.  Adjusted the w1 seed -3.0e-4
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_XY">
<H2>HIREXSR_FIT_XY</H2></A>
<A HREF="#HIREXSR_FIT_WN3">[Previous Routine]</A>
<A HREF="#HIREXSR_FIT_ZJK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_XY

PURPOSE:
	This function performs a multi-gaussian fit on the He-like Ar x+y spectrum.  Currently
	this is done using a 6 gaussian fit for the n,x,st,y and two n=3/4 satellite groups.

CALLING SEQUENCE:
	result=HIREXSR_FIT_XY(spec,lam)

INPUTS:
	spec	FLTARR [n] of the spectral brightness at each wavelength
	lam	FLTARR [n] of the wavelengths [Angstroms]

OPTIONAL INPUTS:
	sig	FLTARR [n] of the uncertainty in the spec data DEFAULT: sqrt(spec)
	limit	FLOAT	of a lower limit on the signal or signal to noise ratio required to proceed with fitting DEFAULT: 0
	win	INT	of the window number to plot the estimate and fit+residual DEFAULT: (no plot)

KEYWORD PARAMETERS:
	/verb sets verbose mode and outputs messages to the terminal

OUTPUTS:
	result	FLTARR	[3*nlines+1] of the gaussian fit coefficients a*exp(-(x-b)^2/(2*c^2)) along with the baseline as the last element

OPTIONAL OUTPUTS:
	label	STRARR 	[nlines] of the line labels for the corresponding fit coefficients
	

PROCEDURE:
	This function calls GAUSSIAN_FITS using MPFITFUN to perfom the fit.
	Rest wavelengths are called using HIREXSR_LOAD_WAVELENGTHS
	The following restrictions are used to constrain the fit
		- all intensities are >= 0
		- widths of all lines are restricted to 0.5 -> 1.5 the seeded width of the y-line
		- shift and width of the st line is fixed to that of the y-line

	Two checks are made to ensure proper signal and seeding before MPFITFUN is called.
		1a) if limit is > 0 then total(spec-mean(spec)) > limit
		1b) if limit is < 0 and sig is given then max(spec/sig) < |limit|
		2) the seed lambda for the w-line must be such that velocity < 350 km/s 

	If 1a or 1b is not satisfied result=-2 is return and if 2 is not satisfied then result=-3 is returned.

MODIFICATION HISTORY;
	Written by	M.L. Reinke (adapted from HIREXSR_FIT_HE) 3/10
	8/10		M.L. Reinke - added the SNR check before fitting
	8/30/10		M.L. Reinke - added the n_lines optional output so that HIREXSR_FIT_SPECTRA can form a valid baseline only coefs vector
	9/14/10		M.L. Reinke - added a RETURN=-4 if trying to seed off the edge of the spectral region

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_FIT_ZJK">
<H2>HIREXSR_FIT_ZJK</H2></A>
<A HREF="#HIREXSR_FIT_XY">[Previous Routine]</A>
<A HREF="#HIREXSR_GET_LINT_PROFILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_FIT_ZJK

PURPOSE:
	This function performs a multi-gaussian fit on the He-like Ar qra+zjk spectrum.  Currently
	this is done using a 5 gaussian fit for the q,r,a,k and z lines.  The j line is degenerate w/ z
	to within the HIREXSR resolution.

CALLING SEQUENCE:
	result=HIREXSR_FIT_ZJK(spec,lam)

INPUTS:
	spec	FLTARR [n] of the spectral brightness at each wavelength
	lam	FLTARR [n] of the wavelengths [Angstroms]

OPTIONAL INPUTS:
	sig	FLTARR [n] of the uncertainty in the spec data DEFAULT: sqrt(spec)
	limit	FLOAT	of a lower limit on the signal or signal to noise ratio required to proceed with fitting DEFAULT: 0
	win	INT	of the window number to plot the estimate and fit+residual DEFAULT: (no plot)
	nback	INT	of the polynomial order to use for the background

KEYWORD PARAMETERS:
	/verb sets verbose mode and outputs messages to the terminal

OUTPUTS:
	result	FLTARR	[3*nlines+1] of the gaussian fit coefficients a*exp(-(x-b)^2/(2*c^2)) along with the baseline as the last element

OPTIONAL OUTPUTS:
	label	STRARR 	[nlines] of the line labels for the corresponding fit coefficients
	

PROCEDURE:
	This function calls GAUSSIAN_FITS using MPFITFUN to perfom the fit.
	Rest wavelengths are called using HIREXSR_LOAD_WAVELENGTHS
	The following restrictions are used to constrain the fit
		- all intensities are >= 0
		- width of the r and a line is fixed to that of the q-line

	Two checks are made to ensure proper signal and seeding before MPFITFUN is called.
		1a) if limit is > 0 then total(spec-mean(spec)) > limit
		1b) if limit is < 0 and sig is given then max(spec/sig) < |limit|
		2) the seed lambda for the w-line must be such that velocity < 350 km/s 

	If 1a or 1b is not satisfied result=-2 is return and if 2 is not satisfied then result=-3 is returned.

MODIFICATION HISTORY;
	Written by	M.L. Reinke (adapted from HIREXSR_FIT_HE) 3/10
	8/10		M.L. Reinke - added the SNR check before fitting
	8/27/10		M.L. Reinke - modifided the SNR limit check to look only around the z-line and do a basline subtraction
	8/30/10		M.L. Reinke - added the n_lines optional output so that HIREXSR_FIT_SPECTRA can form a valid baseline only coefs vector
	9/14/10		M.L. Reinke - added a RETURN=-4 if trying to seed off the edge of the spectral region
	5/13/11		M.L. Reinke - adjusted fitting constraints for qra and kj to prevent them from wandering around 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_GET_LINT_PROFILE">
<H2>HIREXSR_GET_LINT_PROFILE</H2></A>
<A HREF="#HIREXSR_FIT_ZJK">[Previous Routine]</A>
<A HREF="#HIREXSR_GET_PROFILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
 HIREXSR_GET_LINT_PROFILE
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_GET_PROFILE">
<H2>HIREXSR_GET_PROFILE</H2></A>
<A HREF="#HIREXSR_GET_LINT_PROFILE">[Previous Routine]</A>
<A HREF="#HIREXSR_INVERT2TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_GET_PROFILE
PURPOSE:
	This function returns the inverted profile from the tree and
	transforms it into r/a space

CALLING SEQUENCE
	INVERSION = HIREXSR_GET_PROFILE(shot)

INPUTS:
	shot        LONG  shot number

OUPUTS:
       Returns struct of inversion or -1
NOTES:
	quiet keyword has not been implemented yet


MODIFICATION HISTORY:
	Written by: 	Y. Podpaly  02/03/2011
                       Y.P 05/25/2011 to deal with m=1
			Y.P 06/06/2011 to add moly, lya1
                       Y.P 08/30/2011 adding dc_shift and adding shot
                       to outputted struct
			Y.P. 08/30 added tht capability
			Y.P 09/14 dc_shift tied to omega
			Y.P 09/16 override command added to remove safety
			Y.P. 1/16 added time keyword
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_INVERT2TREE">
<H2>HIREXSR_INVERT2TREE</H2></A>
<A HREF="#HIREXSR_GET_PROFILE">[Previous Routine]</A>
<A HREF="#HIREXSR_INVERT_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_INVERT2TREE

PURPOSE:
	This procedure loads the moments calculated using FITSPEC2TREE, calculates the spatial and velocity
	weighting matrices and then does the inversion to find emiss, rotation and temperature profiles.

CALLING SEQUENCE:
	HIREXSR_INVERT2TREE,shot,line

INPUTS:
	shot	LONG	shot number
	line	INT	line # for the analysis 0->6 are Ar w,x,z,lya1,Mo 4d, Ar J, Ca w

OPTIONAL INPUTS:
	tht	INT	of the THACO tree # DEFAULT:0 (just \SPECTROSCOPY::TOP.HIREXSR.ANALYSIS)
	good	INTARR	of the moment channels to use for inversion DEFAULT : see HIREXSR_LOAD_MOMENTPTR
	rmax	FLOAT	of the maximum psinorm for inversion DEFAULT: line specific
	nr	INT	of the number of (evenly spaced) psinorm points to use DEFAULT: line specific
	rhovec	FLTARR	of the psinorm points to use for the inversion DEFAULT: uses HIREXSER_MAKE_RHOVEC

KEYWORD PARAMETERS:
	sine	/sine with run the inversion calculating m=1 terms (up/down asymmetry) in all profiles (use only w/ He-like lines)
	treevox	/treevox will load voxels from the tree
	nosub	/nosub will be sent to HIREXSR_CALC_PROFILES and can be used to avoid issues of a bad velocity calibration on Ti profiles

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 11/10
	1/17/10		M.L. Reinke - added the line specific rhomax and nrho
	11/20/12	M.L. Reinke - added the GOOD optional input
    
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_INVERT_DATA">
<H2>HIREXSR_INVERT_DATA</H2></A>
<A HREF="#HIREXSR_INVERT2TREE">[Previous Routine]</A>
<A HREF="#HIREXSR_INVERT_MOMENTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_INVERT_DATA

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_INVERT_MOMENTS">
<H2>HIREXSR_INVERT_MOMENTS</H2></A>
<A HREF="#HIREXSR_INVERT_DATA">[Previous Routine]</A>
<A HREF="#HIREXSR_IS2IV">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_INVERT_MOMENTS


MODIFICATION HISTORY:
	4/4/11		M.L. Reinke - included the m=1 terms in the inversions but haven't included noise propigation
	4/6/11		M.L. Reinke - included the m=1 error propigation
	5/12/11		M.L. Reinke - modified to work with newer version of GENPOS_PROFILE_INVERT that accepts inv_matrix as an optional input
	9/2/11		M.L. Reinke - added the ability to insert a non-uniform instrumental Ti [keV] to subtract off prior to inversion
				      can see the inst_ti_vec and sub_vec as optional outputs
	9/4/11		M.L. Reinke - modified handling of instrumentals to work with INST nodes in tree
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_profiles.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_IS2IV">
<H2>HIREXSR_IS2IV</H2></A>
<A HREF="#HIREXSR_INVERT_MOMENTS">[Previous Routine]</A>
<A HREF="#HIREXSR_IS_ANALYSIS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_IS2IV

PURPOSE:
	This function converts a line shift in [Ang] to a velocity in [km/s] 

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke - 9/5/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_IS_ANALYSIS">
<H2>HIREXSR_IS_ANALYSIS</H2></A>
<A HREF="#HIREXSR_IS2IV">[Previous Routine]</A>
<A HREF="#HIREXSR_IS_PLASMA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_IS_ANALYSIS

PURPOSE:
	This function is used to check for the presence of ANALYSIS# trees by checking
	for a populated MORDER node in the ANALYSIS#.HELIKE.MORDER

CALLING SEQUENCE:
	result=HIREXSR_IS_ANALYSIS(shot,tht)

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 8/19/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_IS_PLASMA">
<H2>HIREXSR_IS_PLASMA</H2></A>
<A HREF="#HIREXSR_IS_ANALYSIS">[Previous Routine]</A>
<A HREF="#HIREXSR_ITI2IW">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_IS_PLASMA
PURPOSE:
	This procedure checks if a shot is a plasma

CALLING SEQUENCE
	CHECK = HIREXSR_IS_PLASMA(shot, threshold = threshold)

INPUTS:
	shot        LONG  shot number
       threshold   FLOAT mininum plasma current to exceed
	
OUPUTS:
       Returns true(1) or false(0)


MODIFICATION HISTORY:
	Written by: 	Y. Podpaly  12/15/2010

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_shot_analysis_tools.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_ITI2IW">
<H2>HIREXSR_ITI2IW</H2></A>
<A HREF="#HIREXSR_IS_PLASMA">[Previous Routine]</A>
<A HREF="#HIREXSR_IV2IS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_ITI2IW

PURPOSE:
	This function converts a temperature [keV] to a line width [Ang]

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke - 9/4/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_IV2IS">
<H2>HIREXSR_IV2IS</H2></A>
<A HREF="#HIREXSR_ITI2IW">[Previous Routine]</A>
<A HREF="#HIREXSR_IW2ITI">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_IV2IS

PURPOSE:
	This function converts a velocity in [km/s] into a line shift in [Ang]

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke - 9/5/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_IW2ITI">
<H2>HIREXSR_IW2ITI</H2></A>
<A HREF="#HIREXSR_IV2IS">[Previous Routine]</A>
<A HREF="#HIREXSR_LINE_SUBTRACT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_IW2ITI

PURPOSE:
	This function converts a line width [Ang] to temperature [keV]

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke - 9/4/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LINE_SUBTRACT">
<H2>HIREXSR_LINE_SUBTRACT</H2></A>
<A HREF="#HIREXSR_IW2ITI">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_ANALYSIS_COMMENT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LINE_SUBTRACT

PURPOSE:
	This function removes neighboring lines using coeficients from multigaussian fits leaving the line
	of interest for use in moment generation

CALLING SEQUENCE:
	result=HIREXSR_LINE_SUBTRACT(lam,specbr,coefs,labels,line)

INPUTS:
	LAM	FLTARR	[n] of the wavelength values
	SPECBR	FLTARR	[n] of the spectral brightness at each value of lam
	COEFS	FLTARR	[3*n_lines+nb] of the fit coefficients (nb specifies the order of the background)
	LABELS	STRARR	[n_lines] of the labels for each line
	LINE	INT	of the line indentification (w:0, x:1, z:2, lya1:3, mo4d: 4)

OUTPUTS:
	result	FLTARR	[n] of the spectral brightness at each lam with various lines removed

OPTIONAL OUTPUTS:
	back	FLTARR	[n] of the background subtraction done at each lam

PROCEDURE:
	LINE=0  - wn3 and wn4 are removed
	LINE=1	- n, st and y are removed
	LINE=2	- k and a are removed
	LINE=3 	- lyas1, lyas2,lya2 are removed
	LINE=4	- lya2, lyas3, lyas4 are removed
	LINE=5
	LINE=6	- wn3 and wn4 are removed

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 7/10
	8/18/10		M.L. Reinke - added the subtraction setup for line=3,4
	9/27/10		M.L. Reinke - added the back optional output
	12/17/10	M.L. Reinke - added the subtraction for the n=5 on w and the j on z
	12/20/10	M.L. Reinke - added an exisistence check on the n=5, and j lines so it won't crash
				      if it doesn't find the fits for these lines
	5/13/11		M.L. Reinke - added the ability to subtract the  n=0,1 or 2 order polynomial background 
	8/9/11		M.L. Reinke - added the ability to use line=5 (TJ) in moment analysis
	8/25/12		M.L. Reinke - added the line=7,8 configurations  high-Te layout
	12/10/12	M.L. Reinke - added the lyas3 to the subtraction for line=3,7 (lya1)

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_moments.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_ANALYSIS_COMMENT">
<H2>HIREXSR_LOAD_ANALYSIS_COMMENT</H2></A>
<A HREF="#HIREXSR_LINE_SUBTRACT">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_AVESPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_ANALYSIS_COMMENT

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_AVESPEC">
<H2>HIREXSR_LOAD_AVESPEC</H2></A>
<A HREF="#HIREXSR_LOAD_ANALYSIS_COMMENT">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_BINNING">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_AVESPEC

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_BINNING">
<H2>HIREXSR_LOAD_BINNING</H2></A>
<A HREF="#HIREXSR_LOAD_AVESPEC">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_BREAK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_BINNING

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_BREAK">
<H2>HIREXSR_LOAD_BREAK</H2></A>
<A HREF="#HIREXSR_LOAD_BINNING">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_CALIBFITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_BREAK

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_CALIBFITS">
<H2>HIREXSR_LOAD_CALIBFITS</H2></A>
<A HREF="#HIREXSR_LOAD_BREAK">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_CALIB_INST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_CALIBFITS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_CALIB_INST">
<H2>HIREXSR_LOAD_CALIB_INST</H2></A>
<A HREF="#HIREXSR_LOAD_CALIBFITS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_CHECK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_CALIB_INST

PURPOSE:
	This procedure loads the instrumental shift and width [Ang] calculated for
	each pixel on a given detector module

WRITTEN BY:
	M.L. Reinke - 9/4/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_CHECK">
<H2>HIREXSR_LOAD_CHECK</H2></A>
<A HREF="#HIREXSR_LOAD_CALIB_INST">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_CONST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_CHECK

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	9/4/11		M.L. Reinke - added the ability to load subcheck data
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_CONST">
<H2>HIREXSR_LOAD_CONST</H2></A>
<A HREF="#HIREXSR_LOAD_CHECK">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_DETALIGN">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_CONST

MODIFICATION HISTORY:
	8/10/11		M.L. Reinke - noticed that const did NOT include the dt, included this now
	11/5/11		M.L. Reinke - added the /wf keyword.  Default will be to use wf=1.0, use /wf to force loading from tree
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_DETALIGN">
<H2>HIREXSR_LOAD_DETALIGN</H2></A>
<A HREF="#HIREXSR_LOAD_CONST">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_DT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_DETALIGN

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_DT">
<H2>HIREXSR_LOAD_DT</H2></A>
<A HREF="#HIREXSR_LOAD_DETALIGN">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_ECOEFS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_DT

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_ECOEFS">
<H2>HIREXSR_LOAD_ECOEFS</H2></A>
<A HREF="#HIREXSR_LOAD_DT">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_ELLIPSE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_ECOEFS

PURPOSE:
	This procedure loads the elliptical fit coefficients from a locked mode calibration 
	and the corresponding center wavelengths.  These can be used to generate a wavelength map

CALLING SEQUENCE:
	HIREXSR_LOAD_ECOEFS,shot,module,coefs,lam_o

INPUTS:
	shot:	LONG	shot number
	module	FLOAT	module number (1-4)

OUTPUTS:
	coefs:	FLTARR	[5,n_lines] of the elliptic curve coefficients
	lam_o:	FLTARR	[n_lines] of the line centers 


MODIFICATION HISTORY:
	Written by:	M.L. Reinke 3/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_ELLIPSE">
<H2>HIREXSR_LOAD_ELLIPSE</H2></A>
<A HREF="#HIREXSR_LOAD_ECOEFS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_ETENDUE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_ELLIPSE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_ETENDUE">
<H2>HIREXSR_LOAD_ETENDUE</H2></A>
<A HREF="#HIREXSR_LOAD_ELLIPSE">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_FITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME: 
	HIREXSR_LOAD_ETENDUE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_FITS">
<H2>HIREXSR_LOAD_FITS</H2></A>
<A HREF="#HIREXSR_LOAD_ETENDUE">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_IMAGE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_FITS

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_IMAGE">
<H2>HIREXSR_LOAD_IMAGE</H2></A>
<A HREF="#HIREXSR_LOAD_FITS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_INFO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_IMAGE
	
PURPOSE:
	This procedure loads the raw image file from the tree

CALLING SEQUENCE:
	HIREXSR_LOAD_IMAGE,shot,module,image,t

INPUTS:
	shot:	LONG	shot number
	module	FLOAT	module number (1-4)

KEYWORD PARAMETERS:
	noimage	/noimage will not load the image, allowing just the time scale to be loaded

OUTPUTS:
	image	FLTARR	[487,195,n_frame] of the PILATUS camera images
	t	FLTARR	[n_frame] of the time points

OPTIONAL OUTPUTS:
	break	FLTARR	of break points where the spectral units should be found (adjust in W_HIREXSR_CALIB)

MODFICATION HISTORY:
	Written by:	M.L. Reinke 1/10
	3/25/11		M.L. Reinke - added the /noimage keyword
	9/4/11		M.L. Reinke - modified the loading of the time vector to use HIREXSR_GET_TIMES rather then use the dimension of
				      of the raw data.  Should speed up load times.

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_INFO">
<H2>HIREXSR_LOAD_INFO</H2></A>
<A HREF="#HIREXSR_LOAD_IMAGE">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_INFO2TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_INFO

PURPOSE:
	This function loads the INFO file for each of the HIREXSR modules

CALLING SEQUENCE:
	result=HIREXSR_LOAD_INFO(det)

INPUTS:
	module	INT 	detector module number (1-4)

OPTIONAL INPUTS:
	shot:	LONG	shot number of the tree to load with /tree is invoked

KEYWORD PARAMETERS:
	ca:	/ca (and not /tree) will load the info file for viewing He-like Ca
	tree:	/tree will load the info from the tre usinG HRIEXSR_READ_TREEINFO

OUTPUTS:
	result:	STRUC	INFO structure for the module (see GENPOS_SPHERICAL INFO)

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 1/10
	4/7/10:		M.L. Reinke - added optional inputs to allow this function to call data from the tree

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_INFO2TREE">
<H2>HIREXSR_LOAD_INFO2TREE</H2></A>
<A HREF="#HIREXSR_LOAD_INFO">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_INST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_INFO2TREE

PURPOSE:
	This procedure loads data from an spherical INFO file and writes it to the tree'

CALLING SEQUENCE:
	HIREXSR_LOAD_INFO2TREE,shot,module

INPUTS:
	shot:	LONG	shot number
	module	FLOAT	module number (1-4)

OPTIONAL INPUTS:
	info:	STRUC	info structure DEFAULT: HIREXSR_LOAD_INFO(module)
	
KEYWORD PARAMETERS:
	ca:	/ca will load the INFO file to look at He-like Ca

OUTPUTS:
	Data written to the \SPECTROSCOPY::TOP.HIREXSR.INFO.MOD# nodes

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke 3/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_INST">
<H2>HIREXSR_LOAD_INST</H2></A>
<A HREF="#HIREXSR_LOAD_INFO2TREE">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_INVGOOD">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_INST

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 9/4/11
	4/24/12		M.L. Reinke - added THT optional input
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_INVGOOD">
<H2>HIREXSR_LOAD_INVGOOD</H2></A>
<A HREF="#HIREXSR_LOAD_INST">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_LAMBDA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_INVGOOD

PURPOSE:
	This function loads the GOOD vector used to invert a specic
	time point for a given SHOT/LINE/THT in order to copy it to
	another shot

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 11/20/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_LAMBDA">
<H2>HIREXSR_LOAD_LAMBDA</H2></A>
<A HREF="#HIREXSR_LOAD_INVGOOD">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_LINE_POS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_LAMBDA

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_LINE_POS">
<H2>HIREXSR_LOAD_LINE_POS</H2></A>
<A HREF="#HIREXSR_LOAD_LAMBDA">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_LINTPTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_LINE_POS

MODIFICATION HISTORY:
	4/17/12		M.L. Reinke - adopted from HIREXSR_LOAD_LINTPTR
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_LINTPTR">
<H2>HIREXSR_LOAD_LINTPTR</H2></A>
<A HREF="#HIREXSR_LOAD_LINE_POS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_MLINTPTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_LINTPTR

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_MLINTPTR">
<H2>HIREXSR_LOAD_MLINTPTR</H2></A>
<A HREF="#HIREXSR_LOAD_LINTPTR">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_MOMENTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_MLINTPTR

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	9/18/11		M.L. Reinke - added a check on presence of valid EFIT before filling pointer
	11/12		M.L. Reinke - added the poloidal velocity [*,6,7]
	12/6/12		M.L. Reinke - added the brightness [*,8,9]
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_MOMENTS">
<H2>HIREXSR_LOAD_MOMENTS</H2></A>
<A HREF="#HIREXSR_LOAD_MLINTPTR">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_POS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_MOMENTS


MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_POS">
<H2>HIREXSR_LOAD_POS</H2></A>
<A HREF="#HIREXSR_LOAD_MOMENTS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_PROCONFIG">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_POS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_PROCONFIG">
<H2>HIREXSR_LOAD_PROCONFIG</H2></A>
<A HREF="#HIREXSR_LOAD_POS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_PROFILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_PROCONFIG

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_PROFILE">
<H2>HIREXSR_LOAD_PROFILE</H2></A>
<A HREF="#HIREXSR_LOAD_PROCONFIG">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_RAYTRC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_PROFILE

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_RAYTRC">
<H2>HIREXSR_LOAD_RAYTRC</H2></A>
<A HREF="#HIREXSR_LOAD_PROFILE">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_RHOGRID">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_RAYTRC

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_RHOGRID">
<H2>HIREXSR_LOAD_RHOGRID</H2></A>
<A HREF="#HIREXSR_LOAD_RAYTRC">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_TRANS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_RHOGRID

PURPOSE:
	This function loads the PSINORM grid used in a previous shot
	in order to use it in analyzing another shot

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 11/20/12

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_TRANS">
<H2>HIREXSR_LOAD_TRANS</H2></A>
<A HREF="#HIREXSR_LOAD_RHOGRID">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_VOXEL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_TRANS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_VOXEL">
<H2>HIREXSR_LOAD_VOXEL</H2></A>
<A HREF="#HIREXSR_LOAD_TRANS">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_WAVELENGTHS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_VOXEL

MODIFICATION HISTORY:
	4/2/11		M.L. Reinke - modified to check and if present, load the m1s voxel matrix stored w/ the radial only voxel matrix
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees
	8/22/11		M.L. Reinke - fixed a bug that when NOT use /ptr the m1svelvoxel wouldn't get filled
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_WAVELENGTHS">
<H2>HIREXSR_LOAD_WAVELENGTHS</H2></A>
<A HREF="#HIREXSR_LOAD_VOXEL">[Previous Routine]</A>
<A HREF="#HIREXSR_LOAD_WHITE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_WAVELENGTHS
PURPOSE:
	This procedure load the wavelength table from the tree

CALLING SEQUENCE
	HIREXSR_LOAD_WAVELENGTHS,shot,lam_o,z,label

INPUTS:
	shot	LONG	shot number
	
OUPUTS:
	lam_o	FLTARR	[n_lines] rest wavelength of major transition [Ang]
	z	INTARR	[n_lines] atomic number of element
	label	STRARR	[n_lines] indexing label used to identify transition (usually Gabriel notation)

RESTRICTIONS:
	Literature searches have been done for lines in this table to provide the most accurate
	EXPERIMENTALLY measured rest wavelengths

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke 6/8/2010

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_LOAD_WHITE">
<H2>HIREXSR_LOAD_WHITE</H2></A>
<A HREF="#HIREXSR_LOAD_WAVELENGTHS">[Previous Routine]</A>
<A HREF="#HIREXSR_MAKE_RHOVEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_LOAD_WHITE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_MAKE_RHOVEC">
<H2>HIREXSR_MAKE_RHOVEC</H2></A>
<A HREF="#HIREXSR_LOAD_WHITE">[Previous Routine]</A>
<A HREF="#HIREXSR_MOMENTS_COMPARE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_MAKE_RHOVEC

PURPOSE:
	

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_profiles.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_MOMENTS_COMPARE">
<H2>HIREXSR_MOMENTS_COMPARE</H2></A>
<A HREF="#HIREXSR_MAKE_RHOVEC">[Previous Routine]</A>
<A HREF="#HIREXSR_MOMENT_CONV">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_MOMENTS_COMPARE

PURPOSE:
	This procedure is used to generate noisy single gaussians to emulate experimental spectral lines so
	that the different technqiues of HIREXSR_CALC_MOMENTS can be compared.

MODIFICATION HISTORY:
	Written by	M.L. Reinke - 12/7/2010

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_moments.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_MOMENT_CONV">
<H2>HIREXSR_MOMENT_CONV</H2></A>
<A HREF="#HIREXSR_MOMENTS_COMPARE">[Previous Routine]</A>
<A HREF="#HIREXSR_POS2VOXEL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_MOMENT_CONV

PURPOSE:
	This function calculates the spectral moments for a range of wavelength ranges in order to show
	that the moments have converged and that error hasn't begun to creap in.

CALLING SEQUENCE
	result=HIREXSR_MOMENT_CONV(ispec,icoefs,labels,lam_o,line,dlam)

INPUTS:
	ispec	FLTARR	[n,4] element of a spec or avespec PTRARR that holds the spectral information
	icoefs	FLTARR	[3*nlines+1] element of a coef PTRARR that holds the fit coefficients
	labels	STRARR	[nlines] of the line labels
	lam_o	FLOAT	the rest wavelength
	line	INT	of the line index (0 - w, 1 - x, 2 - z, 3 - lya1, 4 - mo4d, 6 - w (Ca))
	dlam	FLTARR	[m] of the various ranges (lam_o-dlam to lam_o+dlam) to take the moments 
			    [units are 10^3 of those in lam_o and ispec[*,1]]

KEYWORD PARAMETERS:
	/double calculates the moments in double precision and is passed to HIREXSR_CALC_MOMENTS

OUTPUTS:
	result	FLTARR	[m,3,4] where [*,*,0] are the moments and [*,*,1] are the errors and [*,*,2],[*,*,3] are the profile
			moments and errors

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 7/10
	9/14/20		M.L. Reinke - added the use of profile moments

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_moments.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_POS2VOXEL">
<H2>HIREXSR_POS2VOXEL</H2></A>
<A HREF="#HIREXSR_MOMENT_CONV">[Previous Routine]</A>
<A HREF="#HIREXSR_PROFILE_ARR2PTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_POS2VOXEL

PURPOSE:
	This function creates the voxel PTRARR

MODIFICATION HISTORY:
	6/13/11 - added the ability to specific EFIT tree
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_profiles.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_PROFILE_ARR2PTR">
<H2>HIREXSR_PROFILE_ARR2PTR</H2></A>
<A HREF="#HIREXSR_POS2VOXEL">[Previous Routine]</A>
<A HREF="#HIREXSR_PROFILE_PTR2ARR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_PROFILE_ARR2PTR

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_PROFILE_PTR2ARR">
<H2>HIREXSR_PROFILE_PTR2ARR</H2></A>
<A HREF="#HIREXSR_PROFILE_ARR2PTR">[Previous Routine]</A>
<A HREF="#HIREXSR_PTR_IMAGE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_PROFILE_PTR2ARR

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_PTR_IMAGE">
<H2>HIREXSR_PTR_IMAGE</H2></A>
<A HREF="#HIREXSR_PROFILE_PTR2ARR">[Previous Routine]</A>
<A HREF="#HIREXSR_READ_BETA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_PTR_IMAGE

PURPOSE:
	This procedure loads each frame of the HIREXSR data into an element of a PTRARR 
	and calculates the wavelength map.  For the 3 module system, the images are combined
	into one image.

CALLING SEQUENCE:
	HIREXSR_PTR_IMAGE,shot,cnts,lambda,t

INPUTS:
	shot:	LONG	shot number

OPTIONAL INPUTS:
	morder:	INTARR	[3] ([1] if /h) of the order to assemble the images DEFAULT: [1,2,3] or [4] when /h

KEYWORD PARAMETERS:
	h	/h will load a single module with the default being module 4
	noimage	/noimage will avoid skip loading the image data and cnts will be an empty pointer.
		This is useful in FITSPEC2TREE when the POS/CONST/U/INST data is useful but no the raw data
	wf	/wf will load white-field stored in tree else wf=1.0 is assumed 
OUTPUTS:
	cnts:	PTRARR	[n_time] of pointers for each frame
	lambda:	FLTARR	[3*nx,ny] of the wavelength values [Ang] ([nx,ny] for /h)
	t:	FLTARR	[n_time] of the time points [sec]

OPTIONAL OUTPUTS:
	pos	FLTARR	[4,3*nx,ny] of the pos vectors for each pixel ([nx,ny] for /h)
	u	FLTARR	[4,3*nx,ny] of the etendue for each pixel ([nx,ny] for /h)
	const	FLTARR	[4,3*nx,ny] of the brightness constant for each pixel ([nx,ny] for /h)
	iwidth  FLTARR	[4,3*nx,ny] of the instrumental width [Ang] for each pixel ([nx,ny] for /h) DEFAULTS=0.0 if not stored
	ishift	FLTARR	[4,3*nx,ny] of the instrumental shift [Ang] for each pixel ([nx,ny] for /h) DEFAULTS=0.0 if not stored

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke 4/5/2010
	8/17/10		M.L. Reinke - modified to allowing loading of u, pos and const when using /h
	9/4/11		M.L. Reinke - modified to allow loading of instrumental data & updated documentation for optional outputs	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_READ_BETA">
<H2>HIREXSR_READ_BETA</H2></A>
<A HREF="#HIREXSR_PTR_IMAGE">[Previous Routine]</A>
<A HREF="#HIREXSR_READ_TREEINFO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
 HIREXSR_READ_BETA
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_shot_analysis_tools.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_READ_TREEINFO">
<H2>HIREXSR_READ_TREEINFO</H2></A>
<A HREF="#HIREXSR_READ_BETA">[Previous Routine]</A>
<A HREF="#HIREXSR_REBIN_AFTERKILL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_READ_TREEINFO

PURPOSE:
	This function reads INFO file data from the HIREXSR tree

CALLING SEQUENCE
	result=HIREXSR_READ_TREEINFO(shot,moldule)

INPUTS:
	shot:	LONG	shot number
	module	FLOAT	module number (1-4)

OUTPUTS:
	result:	STRUC	same as the output of HIREXSR_LOAD_INFO

MODIFICATION HISTORY:
	Written by:	M.L. Reinke 3/10

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_REBIN_AFTERKILL">
<H2>HIREXSR_REBIN_AFTERKILL</H2></A>
<A HREF="#HIREXSR_READ_TREEINFO">[Previous Routine]</A>
<A HREF="#HIREXSR_REMOVE_ANALYSIS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_REBIN_AFTERKILL

PURPOSE:
	This procedure is used to rebin the spectra using a modified CHMAP such as after a small number of pixels
	have been labeled bad using HIREXSR_ZOOM_KILL in W_HIREXSR_HE_MOMENTS

CALLING SEQUENCE:
	HIREXSR_REBIN_AFTERKILL,cnts,tau,chmap,tch,lambda,spec,newmap

INPUTS:
	cnts		PTRARR	[n_time] where each element calls a FLTARR [nx,ny] or a -1 (output of HIREXSR_BIN_IMAGE)
	tau		FLTARR	[n_time] where each element is a time point or -1 (output of HIREXSR_BIN_TIME)
	chmap		INTARR	[nx,ny,nmaps] where elements specificy the channel number that the pixel belongs to
				Can make it time evolving (nmaps > 1) and make the number of channels change with time
	tch		FLTARR	[nmaps] of the time points of when to change the chmap
	lambda		FLTARR	[nx,ny] of the wavelength values for each pixel
	tmap	INTARR	[n_time] indicating which frames are included in each time point
	spec		PTRARR	[chmax,ntime] of the binned spectra, output from HIREXSR_BIN_SPEC that is to be updated
	newmap		INTARR	[nx,ny,nmaps] of the new CHMAP 

OPTIONAL INPUTS:
	const		FLTARR 	[nx,ny] of the multiplicative constant to turn data from counts to spectral brightness [ph/s/m^2/Ang]

OPTIONAL OUTPUTS:
	fix		INTARR 	[chmax,ntime] of 1's or 0's indicating the spectra has changed and requires updating

PROCEDURE:
	This procedure looks for changes in the length of the # of points in a specific channel so removing one pixel and adding another
	will NOT result in that spectrum being updated.


MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 9/12/10
	3/30/11		M.L. Reinke - added the use of TMAP input

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_REMOVE_ANALYSIS">
<H2>HIREXSR_REMOVE_ANALYSIS</H2></A>
<A HREF="#HIREXSR_REBIN_AFTERKILL">[Previous Routine]</A>
<A HREF="#HIREXSR_RHO_ARR2PTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_REMOVE_ANALYSIS

PURPOSE:
	This procedure deletes a numbered analysis tree (\SPECTROSCOPY::TOP.HIREXSR.ANALYSIS#).
	The code will stop and require a .c input from the user to cofirm deletion.

CALLING SEQUENCE:
	HIREXSR_REMOVE_ANALYSIS,shot,tht

INPUTS:
	shot	LONG	shot number
	tht	INT	THACO tree number

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 8/19/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_RHO_ARR2PTR">
<H2>HIREXSR_RHO_ARR2PTR</H2></A>
<A HREF="#HIREXSR_REMOVE_ANALYSIS">[Previous Routine]</A>
<A HREF="#HIREXSR_RHO_PTR2ARR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_RHO_ARR2PTR

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_RHO_PTR2ARR">
<H2>HIREXSR_RHO_PTR2ARR</H2></A>
<A HREF="#HIREXSR_RHO_ARR2PTR">[Previous Routine]</A>
<A HREF="#HIREXSR_RUN_THACO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_RHO_PTR2ARR

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_RUN_THACO">
<H2>HIREXSR_RUN_THACO</H2></A>
<A HREF="#HIREXSR_RHO_PTR2ARR">[Previous Routine]</A>
<A HREF="#HIREXSR_SPEC2MOMENTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_RUN_THACO

PURPOSE:
	This is a high level procedure as a fire & forget way to run THACO for a given shot
	it just runs AVESPEC/FITSPEC/INVERT in one call
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_SPEC2MOMENTS">
<H2>HIREXSR_SPEC2MOMENTS</H2></A>
<A HREF="#HIREXSR_RUN_THACO">[Previous Routine]</A>
<A HREF="#HIREXSR_TREE_ACTIONS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_SPEC2MOMENTS

PURPOSE:
	This is a higher level function with takes in a spec PTRARR and a coefs PTRARR  and generates the
	temporal and spatial moment profiles.

CALLING SEQUENCE:
	result=HIREXSR_SPEC2MOMENTS(spec,coefs,labels,lam_o,line,chmax,time)

INPUTS:
	spec	PTRARR	[chmax,ntime] of pointers to the spectral data (see HIREXSR_AVESPEC_ARR2PTR)
	coefs	PTRARR	[chmax,ntime] of pointers to the fit coefficient data (see HIREXSR_COEFS_ARR2PTR)
	labels	STRARR	[nlines] of the line labels
	lam_o	FLOAT	of the rest wavelength of the line of interest
	line	INT	of the index of the line of interest (0 - w, 1 - x, 2 - z, 3 - lya1, 4 - mo4d, 5 - J)
	
OPTIONAL INPUTS:
	dlam	FLOAT	of the wavelength interval over which the moment is calculated (lam_o-dlam,lam_o+dlam)
	mom	FLTARR	[chmax,ntime,3,4] of the moments from a previous call to HIREXSR_SPEC2MOMENTS
	fix	INTARR	[chmax,ntime] of 1's (yes) and 0's (no) to update the moments

KEYWORD_PARAMETERS:
	/double calculates the moments in double preceision and is sent to HIREXSR_CALC_MOMENTS

OUTPUTS:
	result	FLTARR	[chmax,ntime,3,4] where [*,*,i,0] are the ith moments and [*,*,i,1] are the uncertainty in those moments
			[*,*,i,2] are the "profile" moments and [*,*,i,3] are their errors. If there is no spectral data for a given (ch,time)
			THEN [ch,time,*,*] is set to -1

OPTIONAL OUTPUTS:
	bfrac	FLTARR	[chmax,ntime] of the fraction of background to signal+background photons for use in noise analysis
	scale	FLTARR	[chmax,ntime] of the constant between MOM[0] and PMOM[0] w/o background removed
	fitcase	INTARR	[chmax,ntime] indicating the technique used to calculate the moments (0 - INT_TAB, 3 - MPFIT) 
	
PROCEDURE:
	For each (ch,time) point, a check is made to see if there is a valid spectral array (ispec[0] NE -1).
	If there is a valid fit (n(icoefs) GT 0) then HIREXSR_LINE_SUBTRACT is called.  Then HIREXSR_CALC_MOMENTS
	is called to calculate the moment over the (lam_o-dlam, lam_o+dlam) interval.

MODFICATION HISTORY:
	Written by:	M.L.Reinke - 7/10
	9/12/10		M.L.Reinke - added the mom,fix optional inputs so that the function can be used to updated a selection of moments.
				     fixed a bug that would allow COEFS < 0 (fails) to be sent to moment calculation routines
	9/14/10		M.L.Reinke - modified mom
	8/25/12		M.L. Reinke - added the line=7,8 configurations  high-Te layout
	12/10/12	M.L. Reinke - changed default line=7 dlam=3.6 since it is for higher-T plasmas
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_moments.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_TREE_ACTIONS">
<H2>HIREXSR_TREE_ACTIONS</H2></A>
<A HREF="#HIREXSR_SPEC2MOMENTS">[Previous Routine]</A>
<A HREF="#HIREXSR_UPDATE_TREE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_TREE_ACTIONS

Written by:
	Written by:	M.L. Reinke - 10/10
	1/17/11 	M.L. Reinke - added functionality for lya1 and mo4d	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_tree_utilities.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_UPDATE_TREE">
<H2>HIREXSR_UPDATE_TREE</H2></A>
<A HREF="#HIREXSR_TREE_ACTIONS">[Previous Routine]</A>
<A HREF="#HIREXSR_UPDATE_VOXEL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_UPDATE_TREE

PURPOSE:
	This procedure adds the HIREXSR tree to a shot which THACO has previously not been deployed

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_UPDATE_VOXEL">
<H2>HIREXSR_UPDATE_VOXEL</H2></A>
<A HREF="#HIREXSR_UPDATE_TREE">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_ANALYSIS_COMMENT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_UPDATE_VOXEL

PURPOSE:
	This procedure can be used to update specific voxel weightings

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_calc_profiles.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_ANALYSIS_COMMENT">
<H2>HIREXSR_WRITE_ANALYSIS_COMMENT</H2></A>
<A HREF="#HIREXSR_UPDATE_VOXEL">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_AVESPEC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_ANALYSIS_COMMENT

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_AVESPEC">
<H2>HIREXSR_WRITE_AVESPEC</H2></A>
<A HREF="#HIREXSR_WRITE_ANALYSIS_COMMENT">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_BINNING">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_AVESPEC

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_BINNING">
<H2>HIREXSR_WRITE_BINNING</H2></A>
<A HREF="#HIREXSR_WRITE_AVESPEC">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_BREAK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_BINNING

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_BREAK">
<H2>HIREXSR_WRITE_BREAK</H2></A>
<A HREF="#HIREXSR_WRITE_BINNING">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_CALIBFITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_BREAK

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_CALIBFITS">
<H2>HIREXSR_WRITE_CALIBFITS</H2></A>
<A HREF="#HIREXSR_WRITE_BREAK">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_CALIB_INST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_CALIBFITS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_CALIB_INST">
<H2>HIREXSR_WRITE_CALIB_INST</H2></A>
<A HREF="#HIREXSR_WRITE_CALIBFITS">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_CHECK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_CALIB_INST

PURPOSE:
	This procedure writes the instrumental shift and width [Ang] calculated for
	each pixel on a given detector module.  Tree nodes are created for the given shot if not present

WRITTEN BY:
	M.L. Reinke - 9/4/11

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_CHECK">
<H2>HIREXSR_WRITE_CHECK</H2></A>
<A HREF="#HIREXSR_WRITE_CALIB_INST">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_DETALIGN">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_CHECK

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	9/4/11		M.L. Reinke - added the ability to store subcheck data
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_DETALIGN">
<H2>HIREXSR_WRITE_DETALIGN</H2></A>
<A HREF="#HIREXSR_WRITE_CHECK">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_ELLIPSE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_DETALIGN

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_ELLIPSE">
<H2>HIREXSR_WRITE_ELLIPSE</H2></A>
<A HREF="#HIREXSR_WRITE_DETALIGN">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_ETENDUE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_ELLIPSE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_ETENDUE">
<H2>HIREXSR_WRITE_ETENDUE</H2></A>
<A HREF="#HIREXSR_WRITE_ELLIPSE">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_FITS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_ETENDUE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_FITS">
<H2>HIREXSR_WRITE_FITS</H2></A>
<A HREF="#HIREXSR_WRITE_ETENDUE">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_INST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_FITS

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_INST">
<H2>HIREXSR_WRITE_INST</H2></A>
<A HREF="#HIREXSR_WRITE_FITS">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_LAMBDA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_INST

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 9/4/11
	4/24/12		M.L. Reinke - added THT optional input
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout	

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_LAMBDA">
<H2>HIREXSR_WRITE_LAMBDA</H2></A>
<A HREF="#HIREXSR_WRITE_INST">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_MOMENTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_LAMBDA

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_MOMENTS">
<H2>HIREXSR_WRITE_MOMENTS</H2></A>
<A HREF="#HIREXSR_WRITE_LAMBDA">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_MORDER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_MOMENTS

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_MORDER">
<H2>HIREXSR_WRITE_MORDER</H2></A>
<A HREF="#HIREXSR_WRITE_MOMENTS">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_POS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_MORDER

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_POS">
<H2>HIREXSR_WRITE_POS</H2></A>
<A HREF="#HIREXSR_WRITE_MORDER">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_PROCONFIG">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_POS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_PROCONFIG">
<H2>HIREXSR_WRITE_PROCONFIG</H2></A>
<A HREF="#HIREXSR_WRITE_POS">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_PROFILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_PROCONFIG

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_PROFILE">
<H2>HIREXSR_WRITE_PROFILE</H2></A>
<A HREF="#HIREXSR_WRITE_PROCONFIG">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_TRANS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_PROFILE

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_TRANS">
<H2>HIREXSR_WRITE_TRANS</H2></A>
<A HREF="#HIREXSR_WRITE_PROFILE">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_VOXEL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_TRANS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_VOXEL">
<H2>HIREXSR_WRITE_VOXEL</H2></A>
<A HREF="#HIREXSR_WRITE_TRANS">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_WAVELENGTHS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_VOXEL


MODIFICATION HISTORY:
	4/2/11		M.L. Reinke - modified to store the m1s voxel matrix with the radial only voxel matrix
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_WAVELENGTHS">
<H2>HIREXSR_WRITE_WAVELENGTHS</H2></A>
<A HREF="#HIREXSR_WRITE_VOXEL">[Previous Routine]</A>
<A HREF="#HIREXSR_WRITE_WHITE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_WAVELENGTHS
PURPOSE:
	This procedure writes the wavelength table to the tree from a IDL save file

CALLING SEQUENCE
	HIREXSR_WRITE_WAVELENGTHS,shot

INPUTS:
	shot	LONG	shot number

KEYWORD PARAMETERS:
	convert		/convert overwrites the DAT file with data from the CSV file
	
OUPUTS:
	Data is written to \SPECTROSCOPY::TOP.HIREXSR.CALIB:LAM_O node in the tree

RESTRICTIONS:
	This currently loads the lam_o,z,label arrays from /usr/local/cmod/idl/HIREXSR/hirexsr_wavelengths.dat
	or converts ~/HIREXSR/hirexsr_wavelengths.csv to ~/HIREXSR/hirexsr_wavelengths.dat and writes those values to the tree.
	The distributed .dat file should then be updated.

MODIFICATION HISTORY:
	Written by: 	M.L. Reinke 6/8/2010
	12/20/10:	M.L. Reinke - changed the CSV and DAT path away from /home/mlreinke/...

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_WRITE_WHITE">
<H2>HIREXSR_WRITE_WHITE</H2></A>
<A HREF="#HIREXSR_WRITE_WAVELENGTHS">[Previous Routine]</A>
<A HREF="#HIXERSR_LOAD_MOMENTPTR,SHOT,LINE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_WRITE_WHITE

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIXERSR_LOAD_MOMENTPTR,SHOT,LINE">
<H2>HIXERSR_LOAD_MOMENTPTR,SHOT,LINE</H2></A>
<A HREF="#HIREXSR_WRITE_WHITE">[Previous Routine]</A>
<A HREF="#HIXEXSR_VOXEL_ARR2PTR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIXERSR_LOAD_MOMENTPTR,shot,line

OUTPUTS:
	momptr		PTRARR [ntime] which has the inputs to the inversion code in format that's used in HIREXSER_CALC_PROFILES
			arr=[[reform(mom[tmp,i,*])],$		;0:2 are the 0th, 1st and 2nd moments
			     [reform(err[tmp,i,*])],$		;3:5 are the 0th, 1st and 2nd moment errors
		             [igood],$				;6 is the good vector
			     [icheck],$				;7:9 is the moment check
			     [reform(pmom[tmp,i,*])],$		;10-12 is the profile moment
			     [reform(perr[tmp,i,*])],$		;13-15 is profile moment error
			     [rhotang[tmp,i]],$			;16 is the rhotang
			     [bfrac[tmp,i]],$			;17 is the background fraction
			     [scale[tmp,i]],$			;18 is the MOM0=scale*NPHOT constant
			     [iw],$				;19 is the instrumental width [Ang]
			     [is],$				;20 is the instrumental shift [Ang]
			     [isubcheck]]			;21-23 are the sub vectors (inst_v_vec, inst_ti_vec, sub_vec)	

MODIFICATION HISTORY:
	8/19/11		M.L. Reinke - added optional input THT to work with numbered analysis trees	
	8/25/11		M.L. Reinke - fixed a rather important bug in loading BRFAC & SCALE.  It only used the 0th time slice data for all points :(
	9/4/11		M.L. Reinke - added even more crap to the momptr, now has width/shift instrumentals [19,20] and subvec checks [21-23]
	8/25/12		M.L. Reinke - added the line=7,8 paths for  high-Te layout
	11/20/12	M.L. Reinke - removed keyword NEW and added GOOD optional input
	11/27/12	M.L. Reinke - added the keyowrd CLEAR to toggle CHECK/SUBCHECK loading
	12/6/12		M.L. Reinke - added the dlam optional output
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIXEXSR_VOXEL_ARR2PTR">
<H2>HIXEXSR_VOXEL_ARR2PTR</H2></A>
<A HREF="#HIXERSR_LOAD_MOMENTPTR,SHOT,LINE">[Previous Routine]</A>
<A HREF="#HIXEXSR_VOXEL_PTR2ARR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIXEXSR_VOXEL_ARR2PTR

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="HIXEXSR_VOXEL_PTR2ARR">
<H2>HIXEXSR_VOXEL_PTR2ARR</H2></A>
<A HREF="#HIXEXSR_VOXEL_ARR2PTR">[Previous Routine]</A>
<A HREF="#LINLSQ_FIT_ELLIPSE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIXEXSR_VOXEL_PTR2ARR

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="LINLSQ_FIT_ELLIPSE">
<H2>LINLSQ_FIT_ELLIPSE</H2></A>
<A HREF="#HIXEXSR_VOXEL_PTR2ARR">[Previous Routine]</A>
<A HREF="#
MULTI_INTERPOL PROJECTS NE_TSC (WITH R_TSC, T_TSC) ONTO THE R_MAJOR, TIMES GRID
">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	LINLSQ_FIT_ELLIPSE

PURPOSE:
	This function uses a linear least squares fit to find the quadradic curve coefficients.
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_ellipse.pro)</STRONG><P>
<HR>
 
<A NAME="
MULTI_INTERPOL PROJECTS NE_TSC (WITH R_TSC, T_TSC) ONTO THE R_MAJOR, TIMES GRID
">
<H2>
MULTI_INTERPOL PROJECTS NE_TSC (WITH R_TSC, T_TSC) ONTO THE R_MAJOR, TIMES GRID
</H2></A>
<A HREF="#LINLSQ_FIT_ELLIPSE">[Previous Routine]</A>
<A HREF="#NONLIN_FIT_ELLIPSE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	multi_interpol projects ne_tsc (with r_tsc, t_tsc) onto the r_major, times grid
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_load_data.pro)</STRONG><P>
<HR>
 
<A NAME="NONLIN_FIT_ELLIPSE">
<H2>NONLIN_FIT_ELLIPSE</H2></A>
<A HREF="#
MULTI_INTERPOL PROJECTS NE_TSC (WITH R_TSC, T_TSC) ONTO THE R_MAJOR, TIMES GRID
">[Previous Routine]</A>
<A HREF="#OPTIMIZE_BINNING">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	NONLIN_FIT_ELLIPSE

PURPOSE:
	This function performs a non-linear least squares fit of an ellipse to a set of (x,y) points.
	It calles EQ_ELLIPSE which fits to the form (x*sin(phi)-xo)^2/a^2+(y*cos(phi)-yo)^2/b^2=1

CALLING SEQUENCE:
	result=NONLIN_FIT_ELLIPSE(xpt,ypt,xerr)

INPUTS:
	xpt	FLTARR	[n] of the x values
	ypt	FLTARR	[n] of the y values
	xerr	FLTARR	[n] of the uncertainty in the x point (usually from the spectral fit)
	
OPTIONAL INPUTS:
	good	INTARR 	[n] of 1's or 0's where the	

KEYWORD PARAMETERS
	/tilt will allow the ellipse to be tilted so that the major/minor axes are not aligned with the x/y axes.

PROCEDURE:
	The values of xpt and xerr are checked to make sure they are both finite.  If not then those points
	are set to GOOD=0.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - 3/10
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_fit_ellipse.pro)</STRONG><P>
<HR>
 
<A NAME="OPTIMIZE_BINNING">
<H2>OPTIMIZE_BINNING</H2></A>
<A HREF="#NONLIN_FIT_ELLIPSE">[Previous Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	OPTIMIZE_BINNING

PURPOSE:
	This procedure is used to create single or two gaussian spectra that are distributed on an ellipse
	for demonstration of binning techniques

CALLING SEQUENCE:
	OPTIMIZE_BINNING

OPTIONAL INPUTS:
	nrow	INT	number of rows to define bin [DEFAULT=1]
	nphot	INT	number of photons in the main spectral line [DEFAULT=1000]
	nback	INT	number of DC offset counts in each pixel [DEFAULT=50]
	nbin	INT	number of measurements to bin in wavelength [DEFAULT=1 (no binning)]
	ngauss	INT	number of gaussians to include (1 or 2 for now) [DEFAULT=1]
	r0	INT	lower bound of rows (r0 < rows < r0+nrow) [DEFAULT=242] (stay within 1 < 487 to be a PILATUS)
	ti	FLT	ion temperature [eV] DEFAULT=1.5e3
	v	FLT	flow velocity [m/s] DEFAULT=10.0e3
	
KEYWORD PARAMETERS:
	plot	/plot	will display a plot of the data and the fits

OUTPUTS:
	dv	FLT	difference between the fit and defined velocity [m/s]
	verr	FLT	uncertainty in the velocity [m/s]

PROCEDURE:

MODIFICATION HISTORY:
	Written by:	M.L. Reinke (2010)
	4/20/12		M.L. Reinke - added second gaussian capability 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/HIREXSR/hirexsr_bin_spectra.pro)</STRONG><P>
<HR>
 
</body>
</html>
