<!-- This file was generated by mk_html_help.pro -->
<html>
 
<head>
<TITLE>GENIE - GENRAD</TITLE>
</head>
 
<body>
<H1>GENIE - GENRAD</H1>
<P>
This page was created by the IDL library routine 
<CODE>mk_html_help</CODE>.  For more information on 
this routine, refer to the IDL Online Help Navigator 
or type: <P>
<PRE>     ? mk_html_help</PRE><P>
at the IDL command line prompt.<P>
<STRONG>Last modified: </STRONG>Thu Jan 17 09:57:21 2013.<P>
 
<HR>
 
<A NAME="ROUTINELIST">
<H1>List of Routines</H1></A>
<UL>
<LI><A HREF="#ARK2EMISS_LINE">ARK2EMISS_LINE</A>
<LI><A HREF="#AR_XRAY_EMISS">AR_XRAY_EMISS</A>
<LI><A HREF="#CALC_AR_LINE_RATES:">CALC_AR_LINE_RATES:</A>
<LI><A HREF="#CALC_RATIO">CALC_RATIO</A>
<LI><A HREF="#CALC_SPECEMISS">CALC_SPECEMISS</A>
<LI><A HREF="#HIREXSR_THACO_DELTALAM_EMISS">HIREXSR_THACO_DELTALAM_EMISS</A>
<LI><A HREF="#MIST_ARK_INPUT_DATA">MIST_ARK_INPUT_DATA</A>
<LI><A HREF="#PLC">PLC</A>
<LI><A HREF="#PLCPLT">PLCPLT</A>
<LI><A HREF="#READ_ARK_LABELS">READ_ARK_LABELS</A>
<LI><A HREF="#READ_ARK_TABLE">READ_ARK_TABLE</A>
<LI><A HREF="#READ_AR_LINE_RATES">READ_AR_LINE_RATES</A>
<LI><A HREF="#REFORM_ARK_DATA">REFORM_ARK_DATA</A>
<LI><A HREF="#SXR_VUV_MOLYBDENUM">SXR_VUV_MOLYBDENUM</A>
<LI><A HREF="#TCRASH">TCRASH</A>
<LI><A HREF="#XTOMO_CALC_CSPLC">XTOMO_CALC_CSPLC</A>
<LI><A HREF="#XTOMO_GENRAD_BREM_EMISS">XTOMO_GENRAD_BREM_EMISS</A>
<LI><A HREF="#XTOMO_GENRAD_EMISS">XTOMO_GENRAD_EMISS</A>
<LI><A HREF="#XTOMO_GENRAD_PROFILES">XTOMO_GENRAD_PROFILES</A>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<A NAME="ARK2EMISS_LINE">
<H2>ARK2EMISS_LINE</H2></A>
<A HREF="#AR_XRAY_EMISS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	ARK2EMISS_LINE
	
PURPOSE:
	This procedure turns data from MIST and REFORM_ARK_DATA and turns it into an EMISS structure which
	is formatted for GENSPEC_GPV2SPECTRA INPUT.

CALLING SEQUENCE:
	ARK2EMISS_LINE,ar,csden,nel,te,rad,time,emiss,line
	
INPUTS
	ar:	STRUC 	output of REFORM_ARK_DATA for arbitary values
	csden:	FLTARR 	[19,n_rad] of the charge state density profiles where [18,*] is fully stripped and [0,*] is neutral [10^20 /m^3]
	nel:	FLTARR 	[n_rad] of the electron density profile [10^20 /m^3]
	te:	FLTARR 	[n_rad] of the electron temperature profile [keV]
	rad:	FLATRR 	[n_rad] of the major radius points [m]
	time:	FLT	of the time point where the profiles have been determined [sec] (passed directly to output)

KEYWORD PARAMETERS:
	debug:	/debug stops the code before the end

OUTPUTS:
	emiss:	STRUC containing the line emissivity and its spatial/temporal information
		*.emiss	FLTARR [n_rad,n_lines] of the line emissivity [ph/s/m^3]
		*.r	FLTARR of the midplane major radii of emiss
		*.t	FLTARR of the time point [sec]
	line:	STRUC containing information about the line to be calculated
		*.lam_o		FLTARR [n_lines] the rest wavelengtsh of the linse
		*.del_lam	FLT used in the wavelength interval
		*.mass		FLT the mass of ion in AMU

MODIFICATION HISTORY:
	Written by:	ML Reinke 8-15-07

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="AR_XRAY_EMISS">
<H2>AR_XRAY_EMISS</H2></A>
<A HREF="#ARK2EMISS_LINE">[Previous Routine]</A>
<A HREF="#CALC_AR_LINE_RATES:">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	AR_XRAY_EMISS

PURPOSE:
	This function calculates the emissivity profiles for various
	groups of lines observed by the HIREXSR spectrometer

CALLING SEQUENCE:
	result=AR_XRAY_EMISS(csden,dens,temp)
	
INPUTS:
	csden	FLTARR	[19,nrho] of the charge state densities [18,*] (fully stripped)
	dens	FLTARR	[nrho] of the electron density [m^-3]
	temp	FLTARR	[nrho] of the electron temperature [eV]

OPTIONAL INPUTS:
	cserr	FLTARR	[19,nrho] of the uncertainty in csden
	signe	FLTARR	[nrho] of the uncertainty in the electron density [m^-3]
	sigte	FLTARR	[nrho] of the uncertainty in the electron temperature [keV]
	wl_roi	FLTARR	[2,nlines] of the wavelength regions (see PROCEDURE for DEFAULTS)

OUTPUTS:
	result	[nrho,nlines] of the emissivities [ph/s/m^3] integrated over the wavelength ROI's

OPTIONAL OUTPUTS:
	emerr	[nrho,nlines] of the uncertainty in the emissivity [ph/s/m^3]
	csemiss	[19,nrho,nlines] of the emission from each charge state making up the emissivity

PROCEDURE:
	This function calls CALC_GROUP_RATES in read_ark_tables and
	finds the following emissivity profiles:
		w+n>=3	[3.9455,3.9600]
		q+r+a	[3.9780,3.9880]
		k+j+z	[3.9880,4.0000]
		lya1+2	[3.7270,3.7385]

MODIFICATION HISTORY:
	Written by:	M.L. Reinke (2009?)

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad_argon.pro)</STRONG><P>
<HR>
 
<A NAME="CALC_AR_LINE_RATES:">
<H2>CALC_AR_LINE_RATES:</H2></A>
<A HREF="#AR_XRAY_EMISS">[Previous Routine]</A>
<A HREF="#CALC_RATIO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CALC_AR_LINE_RATES:
	
PURPOSE:
	This procedure calculates the various rates for a given line at input Te values by interpolating
	READ_AR_LINE_RATES data.  A /load is forced.
	
CALLING SEQUENCE:
	CALC_AR_LINE_RATES,line,te,q,rates
	
INPUTS:
	line:		STR of the line label - w x y z a b c d e f g h i j k l m n o p q r s t u 	
	te:		FLATRR [n_te] of electron temperature values [keV]

OUTPUTS:
	q:		FLTARR 	[3] of the [rec, exc, ion] charge states, ie Ar+##
	rates:		FLATARR [3,n_te] where
				[0,*] of the <sigma v> from recombination of num_elec-1 [m^3/s]
				[1,*] of the <sigma v> from excitation of num_elec [m^3/s]
				[2,*] of the <sigma v> from ionization of num_elec+1 [m^3/s]

MODIFICIATION HISTORY:
	Written by:	ML Reinke 8/8/07

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="CALC_RATIO">
<H2>CALC_RATIO</H2></A>
<A HREF="#CALC_AR_LINE_RATES:">[Previous Routine]</A>
<A HREF="#CALC_SPECEMISS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	CALC_RATIO

PURPOSE:
	This procedure calculates the ratio of a group (or one) of numerator and demonator lines as a function of Te

CALLING SEQUENCE:
	CALC_RATIO,num_lines,dem_lines,cs,te,ratio

INPUTS
	num_lines:	STRARR of the lines to include in the numerator
	dem_lines:	STRARR of the lines to include in the denominator
	cs:		INT of the common charge state from which to take each lines' rate

OUTPUTS:
	te:		FLTARR of the te values [keV]
	ratio:		FLATRR of the line ratio

MODIFICATION HISTORY:
	Written by:	ML Reinke 8/8/07

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="CALC_SPECEMISS">
<H2>CALC_SPECEMISS</H2></A>
<A HREF="#CALC_RATIO">[Previous Routine]</A>
<A HREF="#HIREXSR_THACO_DELTALAM_EMISS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME: 
	CALC_SPECEMISS

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad.pro)</STRONG><P>
<HR>
 
<A NAME="HIREXSR_THACO_DELTALAM_EMISS">
<H2>HIREXSR_THACO_DELTALAM_EMISS</H2></A>
<A HREF="#CALC_SPECEMISS">[Previous Routine]</A>
<A HREF="#MIST_ARK_INPUT_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	HIREXSR_THACO_DELTALAM_EMISS

PURPOSE:
	This function will invert the brightness specificed by a wavelength interval rather than an specific line which is
	already done by THACO

CALLING SEQUENCE:
	result=HIREXSR_THACO_DELTALAM_EMISS(shot,lr,line,rho)

INPUTS:
	shot	LONG	shot number
	lr	FLTARR	[lam0,lam1] of the wavelength region to sum brightness [Ang]
	line	INT	THACO line number (0=wn3, 1=xy, 2=zjk, 3=lya)
	rho	FLTARR	[nrho] of the radial grid over which to do inversion [r/a]

OPTIONAL INPUTS:
	tr	FLTARR	[t1,t2] of the time interval to truncate, set t1=t2 to force and IPT call
	eps	FLT	of the 2nd deriv smoothing [DEFAULT=1.0]
	eta	FLT	of the edge zero weighting [DEFAULT=100.0]
	good	INTARR	[nch] of 1's and 0's indicating the use of channel in the inversion
	tht	INT	of the THACO tree number to use
	etree	STRING	of the EFIT tree to use for equilibrium [DEFAULT: ANALYSIS]
	jch	INT	of the bin to use for characteristic spectra [DEFAULT ~ on-axis]
	
KEYWORD PARAMETERS:
	sine	/sine will add an m=1 sine component to the inversion

OUTPUTS:
	result	STRUC	containing a wide amount of pre/post-inversion data
		*.em	 FLTARR [nrho,ntime] emissivity profile [X/m^3]
		*.ems	 FLTARR [nrho,ntime] m=1 sine emissivity profile [X/m^3]
		*.rho	 FLTARR [nrho] r/a radial scaling
		*.time	 FLTARR [ntime]	time points [sec]		
		*.emerr	 FLTARR [nrho,ntime] uncertainty in *.em [X/m^3]
		*.emserr FLTARR [nrho,ntime] uncertainty in *.ems [X/m^3]
		*.br	 FLTARR [nch,ntime] brightness profile [X/m^2]
		*.brchk	 FLTARR [nch,ntime] brightness check from derived emissivity [X/m^2]	
		*.brerr	 FLTARR [nch,ntime] uncertainty in *.br [X/m^2]
		*.pos	 FLTARR [4,nch] of the POS vectors
		*.good	 INTARR [nch] of the channels selected for inversion
		*.lam	 FLTARR	[nlam] of the wavelenths for charac.spectra [Ang]
		*.specbr FLTARR	[nlam] of the spectral brightness [X/m^2/Ang]
		*.sig 	 FLTARR	[nlam] of the uncertainty in *.specbr [X/m^2/Ang]

PROCEDURE:


MODIFICATION HISTORY:
	Written by:	M.L. Reinke (4/18/12) adapated from a variety of THACO tools

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad_hirexsr_thaco.pro)</STRONG><P>
<HR>
 
<A NAME="MIST_ARK_INPUT_DATA">
<H2>MIST_ARK_INPUT_DATA</H2></A>
<A HREF="#HIREXSR_THACO_DELTALAM_EMISS">[Previous Routine]</A>
<A HREF="#PLC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	MIST_ARK_INPUT_DATA

PURPOSE:
	This procedure calculates and saves the input data necessary for GENSPEC_GPV2SPECTRA using data from
	READ_ARK_TABLES and MIST.

CALLING SEQUCNE:
	MIST_ARK_INPUT_DATA,shot,time,lr

INPUTS:
	shot:	LON 	shot number
	time:	FLT 	time point [sec]
	lr:	FLTARR [low,high] of the wavelength interval for which to create saveset

OPTIONAL INPUTS:
	te0:	FLT value sent to REFORM_ARK_DATA DEFAULT: 2.0
	frac:	FLT value sent to REFORM_ARK_DATA DEFAULT: 0.925
	path:	STR of the path to save data file DEFAULT: /home/mlreinke/idl/genie/data/mist/mist_ark_data.sav
	tres:	FLT value sent to MIST DEFAULT: 0.1
	
KEYWORD PARAMETERS:
	debug:	/debug stopes the code in various places
	MIST: 	/h_mdoe, /thomson, /hullac, /mverb (/fit and /local are DEFAULTS)

OUTPUTS:
	A saveset at path is created that holds a MIST structure of mist.emiss, mist.vel mist.ti and mist.line
	formatted for GENSPEC_GPV2SPECTRA.  The shot number, time and z are also included.
	
	***all velocity profiles are set to zero***


MODIFICATION HISTORY:
	Written by:	ML Reinke 8/15/07

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="PLC">
<H2>PLC</H2></A>
<A HREF="#MIST_ARK_INPUT_DATA">[Previous Routine]</A>
<A HREF="#PLCPLT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	PLC

PURPOSE:
	This function calculates the radiative plasma loss coefficient [W*m^3] for given element at
	a given temperature.

CALLING SEQUENCE:
	result=PLC(te,z)

INPUTS:
	te:	1D FLTARR of electron temperatures [eV] of length - M
	Z:	1D INTARR of element numbers of lenght - N

KEYWORD_PARAMETERS:
	q:	/q suppresses non-error updates to terminal
	
OUTPUTS:
	result:	1D FLTARR (M x N) of plasma loss coefficients [W*m^3]
		 - z not on file, values are filled with 0
		 - te out of range, values are filled with -1

RESTRICTIONS:
	Although 1 < Z < 92 are available in Post & Jensen, not all have been input into the table
	due to the large amount of spare time that would entail.  Type CHECKZ to view the elements that are
	on file and if you're drink isn't on the menu ask the bartender (mlreinke@mit.edu) to make it for you.

PROCEDURE:
	Values are taken from Post & Jensen, Atomic Data and Nuclear Data Tables Vol(20) pg 397 for
	all data except for Ar, Kr and Mo which are from Fournier's papers (see /home/mlreinke/idl/impurities/data/table_ref)
	for full references.  To get the P&J curves for where Fournier's available use Z=-Z in the input.

RESTRICTIONS:
	This needs MLR_FUNCTIONS to use properly.  Compile using @/home/mlreinke/idl/impurities/cc_ini.bat

MODIFICATION HISTORY:
	Written by:	ML Reinke, Spring 2005
	9-28-05:	ML Reinke - adding proper documentation to work with HELPME
	10-5-05:	ML Reinke - added Mo P&J curve

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/cooling_curves.pro)</STRONG><P>
<HR>
 
<A NAME="PLCPLT">
<H2>PLCPLT</H2></A>
<A HREF="#PLC">[Previous Routine]</A>
<A HREF="#READ_ARK_LABELS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	PLCPLT
	
PURPOSE:
	This procedure provides an easy interface for plotting multiple cooling-curves using
	data from the function PLC

CALLING_SEQUENCE:
	PLCPLT

OPTIONAL INPUTS:
	temp:		temp=[te0,te1] sets the range [always log-log plot]
	zrange:		zrange=[z0,z1] selects a range of Z's and plots all available
	zz:		zz=[z0,z1...zN] selects specific Z's to plot
	max:		max=FLT	value of the plot maximum
	min:		min=FLT value of the plot minimum

KEYWORD_PARAMETERS:
	ps:		/ps to plot to postscript (output to /home/<username>/idl/plots/plcplt.ps)

MODIFICATION HISTORY:
	Written by:	ML Reinke, Spring 2005
	9-28-05:	ML Reinke - adding proper documentation to work with HELPME

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/cooling_curves.pro)</STRONG><P>
<HR>
 
<A NAME="READ_ARK_LABELS">
<H2>READ_ARK_LABELS</H2></A>
<A HREF="#PLCPLT">[Previous Routine]</A>
<A HREF="#READ_ARK_TABLE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_ARK_LABELS

PURPOSE:
	This function reads data from a formatted table generated by M. F. Gu from FAC for matching
	transitions based on NUM_ELEC, LOW and UP to commonly used line labels

CALLING SEQUENCE:
	result=READ_ARK_LABELS()

OPTIONAL INPUTS:
	path:	STR of path to directory where TXT file will be loaded and IDL savesets saved or loaded.
		DEFAULT: /usr/local/cmod/idl/HIREXSR/
	
KEYWORD PARAMETERS:
	save:	/save will save the output structure as an IDL saveset to path+'/ArK_labels.sav'
	load:	/load will load the output structure from path+'/ArK_labels.sav'
	debug:	/debug stops the codes in various places

OUTPUTS:
	result:	STRUC with lots of stuff in it.  The formatting is made to work with other functions, so use it there
		or ask ML Reinke about it.  I don't want to document the full thing.

MODFICIATION HISTORY:
	Written by:	ML Reinke 8/08/07
	12/17/10	M.L. Reinke - changed default path to load from distributed HIREXSR code
	6/28/12		M.L. Reinke - changed path to load from  GENIE's /atomic_physcs/ directory

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="READ_ARK_TABLE">
<H2>READ_ARK_TABLE</H2></A>
<A HREF="#READ_ARK_LABELS">[Previous Routine]</A>
<A HREF="#READ_AR_LINE_RATES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_ARK_TABLE

PURPOSE:
	This function reads data from a formatted table generated by M. F. Gu from FAC for
	modeling line emission from 1s^2-1s2p in He-like argon and 1s-2p in H-like argon
	including nearby satellites.

CALLING SEQUENCE:
	result=READ_ARK_TABLE()

OPTIONAL INPUTS:
	path:	STR of path to directory where TXT file will be loaded and IDL savesets saved or loaded.
		DEFAULT: /usr/local/cmod/idl/HIREXSR/
	
KEYWORD PARAMETERS:
	new:	/new loads ArK_new.txt rather than ArK.txt
	kev:	/kev puts the temperature units in keV instead of Kelvin
	save:	/save will save the output structure as an IDL saveset to path+'/ArK.sav' or +'/ArK_new.sav'
	load:	/load will load the output structure from path+'/ArK.sav' or +'/ArK_new.sav'
	debug:	/debug stops the codes in various places

OUTPUTS:
	result:	STRUC with lots of stuff in it.  The formatting is made to work with other functions, so use it there
		or ask ML Reinke about it.  I don't want to document the full thing.

MODFICIATION HISTORY:
	Written by:	ML Reinke 8/08/07
	12/17/10	M.L. Reinke - changed default path to load from distributed HIREXSR code
	6/28/12		M.L. Reinke - changed path to load from  GENIE's /atomic_physcs/ directory
	
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="READ_AR_LINE_RATES">
<H2>READ_AR_LINE_RATES</H2></A>
<A HREF="#READ_ARK_TABLE">[Previous Routine]</A>
<A HREF="#REFORM_ARK_DATA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	READ_AR_LINE_RATES

PURPOSE:
	This procedure will get the rec, exc and ion rates from the READ_ARK_TABLE data for named transion using READ_ARK_LABELS
	and produce nicely formatted plots if that's your thing.  /new and /kev are forced in READ_ARK_TABLE.

CALLING SEQUENCE:
	READ_AR_LINE_RATES,line,te,rec,exc,ion
	
INPUTS:
	line:		STR of the line label - w x y z a b c d e f g h i j k l m n o p q r s t u 

OPTIONAL INPUTS:
	win:		INT of the window number to plot if /plot is set DEFAULT: 0
	te_range:	FLTTARR [low, high] of the electron temperature range to plot [keV] DEFAULT: [0.0,5.0]

KEYWORD PARAMETERS:
	load:		/load is sent to READ_ARK_TABLE and READ_ARK_LABELS
	plot:		/plot produces a plot all the rates
	debug:		/debug stops the code in various places

OUTPUTS:
	te:		FLTARR of the electron temperatures [keV]	
	rec		FLTARR of the <sigma v> from recombination of num_elec-1 [m^3/s]
	exc		FLTARR of the <sigma v> from excitation of num_elec [m^3/s]
	ion		FLTARR of the <sigma v> from ionization of num_elec+1 [m^3/s]

OPTIONAL OUTPUTS:
	num_elec: 	INT of the number of electrons of the ion where the line emission is coming
	PLOTS:		A nicely formatted plot of the rates is sent to the current graphics device 

MODIFICATION HISTORY:
	Written by:	ML Reinke 8/8/07

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="REFORM_ARK_DATA">
<H2>REFORM_ARK_DATA</H2></A>
<A HREF="#READ_AR_LINE_RATES">[Previous Routine]</A>
<A HREF="#SXR_VUV_MOLYBDENUM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	REFORM_ARK_DATA
	
PURPOSE:
	This function truncates and reformats the data from READ_ARK_TABLE into a usable subset.  Output
	format is made to work with other ARK functions.  The /new and /kev keywors are forced.

CALLING SEQUENCE:
	result=REFORM_ARK_DATA
	
INPUTS:
	del_lam:	FLTARR [low, up] of the wavelength [Ang] region to truncate data set
	
OPTIONAL INPUTS:
	te0:		FLT of the electron temperature [keV] at which to limit line numbers (see PROCEDURE)
	frac:		FLT of the fraction of emission to include (see PROCEDURE)

KEYWORD PARAMETERS:
	load:		/load will be sent to READ_ARK_TABLE
	debug:		/debug stops the code in various places 

OUTPUTS:
	result:		STRUC of the READ_ARK_TABLE reformatted and truncated to a given wavelength range
			The useful parts of the structure are described below
			*.num_elec	FLTARR [n_lines] of the number of electrons from which the line emission is generated
			*.lam		FLTARR [n_lines] of the rest wavelengths [Ang]
			*.temp		FLTARR [n_temp]	of the electron temperatures [keV]
			*.rec		FLTARR [n_temp, n_lines] of the <sigma v> from recombination of num_elec-1 [m^3/s]
			*.exc		FLTARR [n_temp, n_lines] of the <sigma v> from excitation of num_elec [m^3/s]
			*.ion		FLTARR [n_temp, n_lines] of the <sigma v> from ionization of num_elec+1 [m^3/s]

OPTIONAL OUTPUTS:
	ar:		STRUC of the output of READ_ARK_TABLE
	ERRORS:		-1, -2 and -3 will be returned indicating failures in reformatting the tables (see MLR)

PROCEDURE:
	The optional inputs te0 and frac can be used to truncate the number of lines to the ones that contribute the most emission.
	At temperature, te0 the rec, exc and ion rates are added together and the list is sorted and then an integral is formed.
	The lines that contribute up to frac of the <sigma v> are included.  Without having charge state densities this is a little suspect
	but should be useful to get most of the emission while still keeping computation times in later functions short.

MODIFICATION HISTORY:
	Written by:	ML Reinke 8/15/07

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/read_ark_table.pro)</STRONG><P>
<HR>
 
<A NAME="SXR_VUV_MOLYBDENUM">
<H2>SXR_VUV_MOLYBDENUM</H2></A>
<A HREF="#REFORM_ARK_DATA">[Previous Routine]</A>
<A HREF="#TCRASH">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	SXR_VUV_MOLYBDENUM

PURPOSE:
	This procedure calculates the emissivity of various SXR and VUV lines from
	highly ionized molybdenum for given Te, ne and molybdenum charge state
	density profiles

CALLING SEQUENCE:
	SXR_VUV_MOLYBDENUM,dens,te,nelec,molywave,molychg,molyemiss
	
INPUTS:
	dens:		FLTARR	[nq,nr]	of the density profile for each charge state (index is i=q+)[m^-3]
	te:		FLTARR	[nr]	of the electron temperature for each radial location [eV]
	nelec:		FLTARR	[nr]	of the electron density for each radial location [m^-3]

OUTPUTS:
	molywave	FLTARR	[nlines] of the wavelength of the modeled transitions [Ang]
	molychg		INTARR	[nlines] of the charge state for each line (index is i=q+)
	molyemiss	FLTARR	[nlines,nr] of the emissivity for each line at each radial location [ph/s/m^3] 

MODIFICATION HISTORY:
	7/19/11		M.L. Reinke - adapated from LINES_FOR_MOLY which had hardcoded common blocks
				for use with MIST utilities.
	6/8/12		M.L. Reinke - moved moly data from mist director to /usr/local/cmod/idl/atomic_physics/
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/sxr_vuv_molybdenum.pro)</STRONG><P>
<HR>
 
<A NAME="TCRASH">
<H2>TCRASH</H2></A>
<A HREF="#SXR_VUV_MOLYBDENUM">[Previous Routine]</A>
<A HREF="#XTOMO_CALC_CSPLC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	TCRASH
	
PURPOSE:
	This function determines the times of sawteeth crash by looking at a core ECE channel (GPC_T0)

CALLING SEQUENCE:
	result=TCRASH(shot,t1,t2)
	
INPUTS:
	shot	LONG	shot number
	t1	FLOAT	lower time bound [sec]
	t2	FLOAT 	upper time bound [sec]

OPTIONAL INPUTS:
	dt	FLOAT	lower bound on the length of a sawtooth [sec] (DEFAULT: 0.005)
	thr	FLOAT	bound on the Te time derivative [keV/s] (DEFAULT: -1.0)

KEYWORD PARAMETERS:
	plot	/plot displays an IDL plot showing the Te data and the identified crashes

OUTPUTS:
	result	FLTARR	[ncrash] of the times [sec] of the arb. number of sawtooth crashes found

MODIFICATION HISTORY:
	Written by:	M.L. Reinke (2009?) 

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad.pro)</STRONG><P>
<HR>
 
<A NAME="XTOMO_CALC_CSPLC">
<H2>XTOMO_CALC_CSPLC</H2></A>
<A HREF="#TCRASH">[Previous Routine]</A>
<A HREF="#XTOMO_GENRAD_BREM_EMISS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	XTOMO_CALC_CSPLC

PURPOSE:
	This function computes/loads the charge-state resolved photon
	emission coefficients as observed by the C-Mod XTOMO system (50
	micron Be) for different high-Z impurities.

CALLING SEQUENCE:
	result=XTOMO_CALC_CSPLC(z)

INPUTS:
	z	INT atomic number of the element (currently only 18,36)

KEYWORD PARAMETERS:
	load	/load loads an IDL saveset 
	adas	/load loads the data computed using ADAS 
	debug	/debug stops the analysis before the end
	verb	/verb is passed to the PLC creation functions

PROCEDURE:
	The 50 micron Be filter transmission is computed from data using:
		http://henke.lbl.gov/optical_constants/filter2.html
	loaded via READ_XRAY_DATA.

	If /load is not specificed then ADAS_PEC_CSPLC or
	HULLAC_CS_PLC are called to compute from available atomic phyiscs
	data and save the file in ~/atomic_physics/usr/+logname()+/ which
	assumes the user has the atomic_physics Mercurial database
	installed.  Please talk w/ M.L. Reinke before establishing new
	default radiation modeling data.

MODIFICATY HISTORY:
	Written by:	M.L. Reinke - Spring 2009
	6/8/12		M.L. Reinke - modified to use new /usr/local/cmod/idl/atomic_physics/ data 
	6/12/12		M.L. Reinke - fixed error in path to SXR filter data

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad_xraytomo.pro)</STRONG><P>
<HR>
 
<A NAME="XTOMO_GENRAD_BREM_EMISS">
<H2>XTOMO_GENRAD_BREM_EMISS</H2></A>
<A HREF="#XTOMO_CALC_CSPLC">[Previous Routine]</A>
<A HREF="#XTOMO_GENRAD_EMISS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	XTOMO_GENRAD_BREM_EMISS

PURPOSE:
	This function calculate the continuum emissivity seen by the
	x-ray tomography system and line-integrated brightness for selected arrays
	
CALLING SEQUENCE:
	result=XTOMO_GENRAD_BREM_EMISS(shot,t,rmaj,temp,temperr,dens,denserr)

INPUTS:
	shot	LONG	of the shot number
	t	FLOAT	of the time point to use equilibrium reconstruction
	rmaj	FLTARR	[nr] of the outboard midplane major radius [m]
	temp	FLTARR	[nr] electron temperature [keV]
	temperr	FLTARR	[nr] of the unc. in temp [keV]
	dens	FLTARR	[nr] of the electron density [m^-3]
	denserr	FLTARR	[nr] of the unc. in the dens [m^-3]	

OPTIONAL INPUTS:
	n_s	INT	number of points along line of sight to compute integral over DEFAULT set in LINE_BR
	zeff	FLTARR	[nr] of the Zeff profile DEFAULT: 1.0 (constant,pure)
	pos	FLTARR	[4,nch] of the pos DEFAULT shot specific array1, array3 pos arrays from XRAY_TOMO_POS
	
KEYWORD PARAMETERS:
	array5	/array5 will include the 5th (FY12+) array along with
		array1 and array3 when computing the brightness
	debug	/debug will stop the code before the RETURN statement

OUTPUTS:
	result	STRUC	of the computed emissivity and brightness data
		*.rmaj	[nr] duplication of the input major radius scale
		*.emiss	[nr] of the emissivity [W/m^3] on the major radius grid
		*.emerr	[nr] of the uncertainty in the emiss [W/m^3]
		*.pos	[4,nch] of the POS vectors for the selected [DEFAULT: array1, array3]	
		*.br	[nch] of the brightess seen by the XTOMO system due to this emissivity [W/m^2]
		*.brerr	[nch] of the uncertanty in the brightness [W/m^2]

PROCEDURE:
	The Mewe gaunt factor parameterization is used and the Hutchinson formula (W/m^3/eV) w/o 
	recombination edges is used for the continuum.

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009
	6/2012		M.L. Reinke - modified the filter path to use /usr/local/cmod/idl/atomic_physics
				      added the ability to compute brightness for array5
       6/2012          ctyler      - Corrected log_gff to multiply
                                     temp[i] by 1000 to turn KeV to eV
</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad_xraytomo.pro)</STRONG><P>
<HR>
 
<A NAME="XTOMO_GENRAD_EMISS">
<H2>XTOMO_GENRAD_EMISS</H2></A>
<A HREF="#XTOMO_GENRAD_BREM_EMISS">[Previous Routine]</A>
<A HREF="#XTOMO_GENRAD_PROFILES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	XTOMO_GENRAD_EMISS

PURPOSE:
	This function computes the emissivity and brightness profiles seen by the 
	soft x-ray tomography arrays for a specified impurity 

CALLING SEQUENCE:
	result=XTOMO_GENRAD_EMISS(shot,t,rmaj,csden,cserr,temp,temperr,dens,denserr)

INPUTS:
	shot	LONG	of the shot number
	t	FLOAT	of the time point to use equilibrium reconstruction
	rmaj	FLTARR	[nr] of the outboard midplane major radius [m]
	csden	FLTARR	[z+1,nr] of the charge state density profiles [m^-3]
	cserr	FLTARR	[z+1,nr[ of the unc. in csden [m^-3]
	temp	FLTARR	[nr] electron temperature [keV]
	temperr	FLTARR	[nr] of the unc. in temp [keV]
	dens	FLTARR	[nr] of the electron density [m^-3]
	denserr	FLTARR	[nr] of the unc. in the dens [m^-3]	

OPTIONAL INPUTS:
	n_s	INT	number of points along line of sight to compute integral over DEFAULT set in LINE_BR
	pos	FLTARR	[4,nch] of the pos DEFAULT shot specific array1, array3 pos arrays from XRAY_TOMO_POS

KEYWORD PARAMETERS:
	array5	/array5 will include the 5th (FY12+) array along with
		array1 and array3 when computing the brightness
	adas	/adas will use ADAS rates in XTOMO_CALC_CSPLC rather than HULLAC data
	debug	/debug will stop the code before the RETURN statement

OUTPUTS:
	result	STRUC	of the computed emissivity and brightness data
		*.rmaj	[nr] duplication of the input major radius scale
		*.emiss	[nr] of the emissivity [W/m^3] on the major radius grid
		*.emerr	[nr] of the uncertainty in the emiss [W/m^3]
		*.pos	[4,nch] of the POS vectors for the selected [DEFAULT: array1, array3]	
		*.br	[nch] of the brightess seen by the XTOMO system due to this emissivity [W/m^2]
		*.brerr	[nch] of the uncertanty in the brightness [W/m^2]

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009
	6/12/2012	M.L. Reinke - modified the filter path to use /usr/local/cmod/idl/atomic_physics
				      added the ability to compute brightness for array5

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad_xraytomo.pro)</STRONG><P>
<HR>
 
<A NAME="XTOMO_GENRAD_PROFILES">
<H2>XTOMO_GENRAD_PROFILES</H2></A>
<A HREF="#XTOMO_GENRAD_EMISS">[Previous Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
NAME:
	XTOMO_GENRAD_PROFILES

PURPOSE:
	This procedure compares measured and modeled emissivity and
	brightness profiles for the soft x-ray tomography diagnostics

CALLING SEQUENCE:
	XTOMO_GENRAD_PROFILES,shot,t1,t2,csden,cserr,temp,temperr,dens,denserr,rhovec

INPUTS:
	shot	LONG	shot number
	t1	FLOAT	lower time point of averaging window [sec]
	t2	FLOAT	upper time point of averaging window [sec]
	csden	FLTARR	[z+1,nr] of the normalized charge state density profiles
	cserr	FLTARR	[z+1,nr[ of the unc. in csden
	temp	FLTARR	[nr] electron temperature [keV]
	temperr	FLTARR	[nr] of the unc. in temp [keV]
	dens	FLTARR	[nr] of the electron density [m^-3]
	denserr	FLTARR	[nr] of the unc. in the dens [m^-3]
	rhovec	FLTARR	[nr] r/a 

OPTIONAL INPUTS:
	t	FLOAT	of the nearest time point to use rather then averaging over t1 < t < t2
	nz	FLOAT	of the absolute impurity denisty DEFAULT=10^17 m^-3
	zeff	FLOAT	of the zeff NOT including the specified impurity DEFAULT=1.0

OUTPUTS:
	GRAPHICAL to plotwin+1 of the measured and modeled emissivity and brightness profiles

OPTIONAL OUTPUTS:
	out	STRUC		structure containing the measured and modeled XTOMO data
		*.xem		experimental emissivity profile [kW/m^3]
		*.xemerr 	unc. in experimental emissivity [kW/m^3]
		*.em		modeled emissivity profile [kW/m^3]	
		*.emerr		unc. in modeled emissivity [kW/m^3]
		*.rho		normalized minor radius r/a 

MODIFICATION HISTORY:
	Written by:	M.L. Reinke - Spring 2009

</PRE><P>
<STRONG>(See /usr/local/cmod/idl/GENIE/GENRAD/genrad_xraytomo.pro)</STRONG><P>
<HR>
 
</body>
</html>
